;// Version: (2.65) 
;// Version History
;// 

;// 1.6     JJU ADDED: Better support for WTA3
;// 1.6a    JJU ADDED: basic Odyssey 1.0.1 support
;// 
;// 1.6b    JJU ADDED: Ability to setup default parameters for bookeye when using 'scan' button
;// 1.6b
;// 
;// 1.7     JJU ADDED: Consolidated modules folder. One main module folder in \Lib\ folder.
;// 1.7     JJU ADDED: ImageTreatmentPlus has its own editbox now.
;// 1.7     JJU ADDED: Reader module.
;// 1.8     Face lift - Beta 
;//         enhancements: messageyesno before send to ariel, deleting original images after image treatment was performed
;// 1.8b    clip on mouse right button
;// 1.8c    test if DocID has valid characters only based on Ariel requirement (a-z,0-9, - _ ) no dash as last char
;// 1.8d    support for resend article when previously send via email or ftp (hardcoded to send pdf files)
;//         in ftp export contols.lst includes new flag that can eliminate DocID subfolder from output filepath where pdf files are stored on ftp
;// 1.8e    param to turn off ill logo
;//         added Delivery method field
;// 1.8f    do not test format of IP/Email field if delivery method is ILLiad (Buffalo University requirement...)
;// 1.9     all delivery goes through dotnet
;// 1.9b    if Odyssey (or ILLiad) allow empty Email/IP field
;// 1.9c    fixed to check Aliases just if Ariel was selected as delivery method
;//         flag to skip doc id validation (Montana wanted to save to disk -> used ftp because they wanted pdf file to be saved)
;// 1.9d    update button updates all pages in article; delete button does not allow pullsip unles it is only page in batch or last page in batch
;// 1.9e    allowed to load multiple articles into BscanILL when resend mode (process32)
;// 1.9f    hardcoded tiff file format for ILLiad
;//         scan pullslip will restore bookeye/widetek settings as they were prior to scan pullslip
;// 1.9g    hardcoded tiff file format for Ariel and Odyssey
;// 1.9h    test if process11 if BookeyeSettingGet failed or pass (with wideteksome params failed)
;// 1.9i    taken out copying of Ariel shortcuts in process1
;// 1.9j    ADF with scan pull slip button
;//         run process15 only if new page appended
;// 1.9k    ReadINI20 modified to read 'Path2' line from control.lst to fix Jirka's modification that is not compatible when uses Aliases in Ariel
;//          this verion needs 'Path' label in control.lst with only folder name (without exe name) to the Ariel path
;// 1.9l    ADF mode has two scan buttons now - scan one and scan multi (need ne graphics in 'lib' folder)
;// 1.9m    Fix ButtonProcess89 -hide when Widetek scanner
;//         Rapid files does not need to be in \lib\%F6\Modules -> just in \lib\modules
;// 1.9n    force tiff image format when Rescan or Insert
;// 1.9o    support for Twain
;// 1.9p    F11 - scan from disk does not scan one image after selecting source directory - serves just to select directory, then regular scan buttons needs to be used
;// 1.9q    Scan Auto mode supported (scan user + rotate)
;//         Setup launches Jirka's setup.exe
;//         Force quick scan mode in process1
;//         buttons: Setup, Scanner Setup, Brightness/Contrast for ADF; Setup, Scanner Setup for Bookeye
;// 1.9r    setup exe modified to 'Bscan ILL Setup.exe'
;// 1.9s    added condition if directory exists when deleting directory in process108
;// 1.9t	PDF creation done by Keith's dll not OCR engine
;// 1.9u    supports 120 chars in docID - when save on disk to support long file name that is stored in DocID variable
;//         fixed also when using Image treatment
;// 1.9v    supports 4 different turbo scan modes
;// 1.9w    turbo mode for widetek as well (fixed conditions for ADF not to show turbo buttons)
;//         reset area when new session and scan pull slip
;// 1.9u    fixed process92 - do not always turn off autobrightness when reset status - do it just if fast scan is on
;// 1.9x    fixed problem with case sensitive ILLiad value
;// 1.9y    adding switch for IRIS and PDF creator
;// 1.9z    300DPI setting taken out of script except Scan Pull Slip process
;// 1.9zz   adding condition not to insert page if current page is pull slip - setting of flags/values would be incorrect
;// 2.0     lzw added into multi image tiff creation for gray/color
;// 2.1     button pressed support (requires 3 new graphics for buttons)
;// 2.2     ILLiad database support for pull slip reading - needs C:\BSCANILL\Lib\ILLExportBridge.dll and special scripting in pull slip reading bsa
;//         F5: Send Article(s) label modified in editbox17
;//         Independent image support
;//         auto edit ifeld modification log update (eliminating Update button)
;// 2.3     beep if ILLDatabase enabled but TN not found
;//         fixed Scan one and Scan Multi functionality (Scan One is driven by foot pedal flag, Multi scan is always Wait for Bookeye and Widetek)
;// 2.4     'independent button' graphic implemented
;// 2.5     OnBookeyeTimeout process implemented
;//	    clip just if bigger mouse zone selected to avoid clip on click
;//         fixed independent image flags when resending articles
;//         test for unsaved images before release, do not allow to modify another image before saving previously modified image
;//         Multi scan and Single scan button graphics
;// 2.6     save color setting into BOOKEYE section when using color buttons on screen
;//         image not saved flag tested before image treatment as well
;//         if Bookeye/Widetek - ignore foot pedal setting - single scan is no pedal, multi scan is wait mode.
;//         resend article: always force pull slip flag on first page of article
;//         reset area button - gray out support
;// 2.7     reset back auto brightness value after first scan in turbo mode
;//         use auto focus just for first scanned page in turbo mode and for pull slip reading - set it off for rest of images in turbo scan mode
;//         set auto page size during launch
;// 2.8     force goto last page if scanning
;// 2.9     use 'autofocus=skip' for next scans in turbo mode
;//         fixed going to last page when scanning
;// 2.10    Plustek and Minolta implementation
;// 2.11    Patron's edit field length changed from 20->50
;//         fixed space support with auto update
;// 2.12    implemented global BookeyeWaitMode to handle setting independent images during wait mode time
;// 2.13    Lookup TN button
;//         'Reset Scan Area' button label modification 
;//         fixed EditOnOpen problem (listbox items were broken)
;// 2.14    if focus not on last page when scanning pull slip - go to last page before scanning
;//         when bookeye batch scan wait mode turned on - disable necessary buttons until Bookeye timeouts
;//         retrieving params and num of clips from Image Treatment to update 'Exception size page flag' and distinguish how many clips within current page have been made in Image Treatment window
;//         independent image button replaced with page size exception button
;//         Lookup Transaction Number tooltip added - needs new exe
;// 2.15    Forcing auto page size when scanning pull slip with Plustek version
;// 2.16    Rotate 270 when scanning with Plustek
;// 2.17    Execute process97 (auto update) just if some pages scanned
;// 2.18    Fixed problem of ignoring processes when grayed out buttons in multi scan mode
;// 2.19    Multi Image TIFF + PDF Import
;// 2.20    Fixed process# in radio of Editbox8 - import process
;// 2.21    Fixed problem when Function key was interrupting multi scan or scan on button process (needs new exe)
;// 2.22    set auto feeder mode ScanFeeder=3 for ADF and use MultiScanAutoFeedMode command to avoid problems with Multi Scan with flatbed.
;// 2.23    launch speed up fixed when Bookeye not connected
;// 2.24    lzw compression applies for gray and color just if Ariel 4.0 and higher
;// 2.25    Fixed problem of Rotate270 when resend article when Plustek
;// 2.26    Show Advanced scanner setup if Plustek when scanner setup or contrast/brightness button pressed
;// 2.27    idle when twain multi scanning before showing preview twain GUI dialog (config command ScanMultiWaitTwainIdle)
;//         new button multi scan rotated for twain-Plustek
;// 2.28    forcing landscape letter size when scanning pull slip with Plustek
;//         allowed to delete pull slip anywhere in batch if it is only page of article
;//         import with 25%limit (min 200 imports)
;//         fixed import of multi image tiff - after import finished application started to multi scan with scanner
;// 2.29    fixed bug of refreshing buttons
;//         rotate 270 for scan single, rescan, insert, multi scan if scanning with Plustek
;// 2.30    force AutoBrightness(Off) when scanning pull slip with Bookeye or Widetek. AutoBrightness produces dark specs in background sometimes which breaks pull slip reading.
;// 2.31    IP address validation using LocateIP command to test alpha address as well
;// 2.32    G4 compression set as default when first time launch
;// 2.33    implementing of reading of both TN and ILL number (requires update of Reader.bsa, RapidILL.bsa, zones.ini, Bscan ILL dlls)

;// 2.33	Jirka - erased Process74 as it is not used anywhere
;// 2.33	Jirka - changed export application from "cepp1.exe /s" to "ra.exe /r" - Cepp1.exe is not needed anymore

;// 2.33    New Session button clears ILL# and TN# fields now 	    
;// 2.34    always read TN unless it is turn off in control.lst in MAIN section with UpdateILLiad=No
;// 2.35    if save on disk do not backup large images into multi image tiff (threshold = 50MB file size)
;// 2.36    fixed save on disk export 
;// 2.37    fixed import of multi image tiff
;// 2.38    KIC import implemented
;//         adding jpeg support for Resend Articles (needs new exe too)
;// 2.39    Rebel support (process98 renamed to process102)
;// 2.40    Goto End before KIC import
;//         restrict importing to tif and jpg files when KIC import
;// 2.41    jpeg supported in KIC import (needs new exe)
;// 2.42    #96=0 moved in process15 
;// 2.43    BE4 support
;// 2.44    fixed script bug in process99
;// 2.45    BE4's scan pull slip button implemented (needs new exe)
;// 2.46    'Bookedge a300' and 'Bookedge STD/LED' scanner type implemented
;// 2.47    forcing 'Flat' removed for pull slips because of BE4
;// 2.48    Set B&W, Gray, Color buttons added for Bookedge STD/LED(iVina)
;// 2.49    Support for searchable PDFs
;//         fixed color mode buttons for Bookedge STD/LED(iVina)
;// 2.50    Set B&W, Gray, Color buttons added for Bookedge a300 (Plustek)
;//         execute new config14 when Bookedge scan mode with STD/LED (iVina) scanner to enable different twain settings for this mode to turn off  scanner auto rotation
;// 2.51    support for 'Multi' param in LocateIP
;// 2.52    disable editfield buttons while multiscan wait mode (reported BE4 issue)
;//         show Set color button just if color bookeye/widetek unit
;// 2.53    PDF support for Odyssey, ILLiad delivery added (needs new BscanILL dlls)
;//         ADF support - scanning pull slip then trigger multiscan
;// 2.54    force scanfeeder=0 in config10 for bookedge otherwise empty feeder is indicated when scanning pullslip
;//         OnEnter execute afterchar process to confirm values if alphanumeric IP is red and field is mark for review - still must
;//         fix problem of not hawing focus on editfield so user must click with mouse field first then hit enter otherwise focus stays on button and nutton is pressed on enter
;//         added if condition in process15 to fix situation when red flag is shown for review alphanumeric values (when #87==2)
;// 2.55    Default to tif file format if old dll is used.
;// 2.56    added support to force BE4 timeout on button (pressing on 'scan on button/pedal' when in wait mode, turns off the wait mode)
;// 2.57    got rid of default bookeye settings support via control.lst file
;//         updating [BOOKEYE] section of bsa with compresion type whne using on screen color mode buttons
;//         forcing color mode and compression settings before each scan, rescan, scan-insert to avoid uncompressed bitonal images that cause trouble when import to Odyssey. Stiil issue when user changes color in BE2 panel.
;// 2.58    fixed process104
;//         in case customer needd to resend articles with problems (per 2.57 - uncompressed images) - we need to uncomment lines in process16 
;//         in 4 locations that are written just after lines where we convert lzw.
;// 2.59 (01/30/2012) - length of :01 - arielIP/email field extended from 50 to 70
;// 2.60 (01/31/2012) - do not try to work with Ariel.log file if Path in Ariel section of control.lst is not filled in - Ariel not used (Windows7 gave error becasue of user rights)
;// 2.61 (04/25/2012) - printing support, we do not support FitToPage, RotateToFit, etc for color/gray...
;// 2.62 (07/02/2012) - temp folder for pdf extraction in process7 moved under C:\Bscan folder to avoid issues with user rights
;// 2.64 (10/17/2012) - do not allow printing when scan on pedal mode
;// 2.65 (10/24/2012) - set auto page size for Widetek pull slip scanning

;// ------------------------------------------------------------------------------------------------------------
;// To do
;// 
;// - check different scanner modes and different windows settings for design layout.
;// - Ability to specify which folder to export images to through setup window.
;// - Ability to specify how many days to keep articles on server through setup window.
;// - When sending email or email+ftp we need to know if it was sent correctly or not and update the report.
;// - Add support for resending when sending through email or email+ftp
;// - Add Remote ftp support.
;// - Update setup window to all the latest features.
;// - Add whiteout function.
;// - Add reporting agent
;// - Add unified logging mechanism.
;// - Add 'Scan Pullslip' button for ADF scanner and have a seperate "Scan" button for normal scans.
;// - Add 'Send to File' feature. Save images to a multi-page pdf, tiff and to a folder where the user can then email it manually.
;// - Add ability to delete an entire article
;// - Make patron field optional.
;// - Bring back notes and desc field as optional fields.
;// 
;
;
;
;
;
;
;
;

[PARAMS]
Logo=No
DefaultPdfImportFolder=C:\Import

[BSCAN]
Product=BSCAN ILL
Version=1.7
BSCANEntranceProcess=1
Scanner=FB6080E
BookeyeAddress=
BookeyeStandBy=
InternetReceiveTimeOut=60000
S2NWaitMode=global

;;ScreenLock=Size,Position,X
ControlProductTitle=BSCAN ILL
FaceLift=v,SY
ResetFaceliftConfigs=No
;ThumbnailWindow=No
FaceliftViewFlagVar=%:17
;RebelScanner=Yes
BookeyeTouchScreenLogo=ILL


[PROCESS79]      ;delete page
If=%#23==0
If7=%NP>0
#32=0
If=%1:74==1                
; control sheet is to be deleted - delete only if it is only page in batch
If8=%NP==1
#32=1
Else8=
If9=%PN==%LP
#32=1
Else9=
; is current page pull slip - as only page in its article?
UpdateView=No
PN=PN+1
If88=%1:74==1
;next page is control sheet so current control sheet is only page of current article - you can delete it
#32=1
Else88=
#32=2
EndIf88=
PN=PN-1
UpdateView=Yes
EndIf9=
EndIf8=
Else=
#32=1
EndIf=

If0=%#32==1
If=%1:74==1 
;delete red marks if deleting pullsip
#81=0
#82=0
#83=0
EndIf=

Ifa=%PN==%#51
#51=-1
Elsea=
Ifb=%#51>=0
Ifc=%PN<%#51
;deleting image prior to modified one -> decrement index of modified image
#51=#51-1
EndIfc=
EndIfb=
EndIfa=

Command=DeleteOne

If=%NP==0
;// Clear IP/Email exception
#81=0
                        
;// Clear ILL#-DocID exception
#82=0

;// Clear TN exception
#83=0

:00=
:01=
:02=
:04=
:05=
:30=
EndIf=

Else0=
If=%#32==2
MessageOk=Pullslip Can be Deleted Just as Only Page in Article!
EndIf=
EndIf0=

EndIf7=
EndIf=

         
[PROCESS82] ;clip
;BarRead=Region(%R0,%R1,%R2,%R3),TYPES(CODE39),DIRECTION(LeftToRight,BottomToTop),SPEED(0,6,0,0,0,0),TOLERANCE(3),TIMEOUT(500)
;MessageOk=%BC-(%R0,%R1,%R2,%R3) 
;OCRShowZones=Yes
;SetRegion=65,38,1200,950
;BarRead=Region(65,38,1200,950),TYPES(CODE39),DIRECTION(LeftToRight,BottomToTop),SPEED(0,6,0,0,0,0),TOLERANCE(3),TIMEOUT(500)
;MessageOk=%BC
;OCRClearRegistration1=Yes
;ActiveOcrFonts2=C:\BSCANILL\Lib\TSRI\TSRI-Reg-FormA.bsf
;OCR=%R0,%R1,%R2,%R3,SEARCH,Reportregistration,C

;#80=%PB(%R0,%R1,%R2,%R3)
;MessageOK=%R0,%R1,%R2,%R3
Ifa=%NP>0

#20=0
Ifh=%#51<0
#20=1
Elseh=
If9=%#51==%PN
#20=1
EndIf9=
EndIfh=

Ifb=%#20==1
#91=%R0
#92=%R1
#93=%R2
#94=%R3

#91=#93-#91
#92=#94-#92
If=%#91>100
If=%#92>100
Clip=%R0,%R1,%R2,%R3
#51=%PN
EndIf=
EndIf=

Elseb=
#51=#51+1
MessageOK=Modified page %#51 has not been saved yet! Please save or restore it before modifying this page!
#51=#51-1
EndIfb=
EndIfa=

;Call=Process15

;F6=TSRI
;Call=Process21,%F0\Lib\%F6\%F6.bsa 



[PROCESS83]
If=%PN==%#51
#51=-1
EndIf=
RestoreCurrentImage=Yes

[PROCESS150]
:54=%#23
#23=0
Command=Process11
;OnInterval=1,Process11


[CONFIG1] ;Main

;* Window settings
;
BE4CommandScanPullslipButton=Process150

ControlWindow=0,179,383,400,22,0
;ControlWindowStats1=5,5,
;ControlMenu=off
ControlMenu=DefaultControlMenu
ControlTitle=ILL
ViewWindows=1,1,383,0,SX-383,SY-34
ViewDefaults=0,0,2,3,0
ViewGlobal=zoom,scrolling,rendering
ViewTitle=%FP %C4.%C3.%C2.%C1
;ViewTitle=%FP %C4.%C3.%C2.%C1 %MWx%MHmm %DRdpi %FS bytes
ViewSides=1

KeyProcess97=Enter

;* Mouse settings
;
OnMouseRightButtonUp=Process82
;OnMouseLeftButtonUp=Pan

;OCRTrainWindow=Open
;* Key settings
;

OnCloseBookeyeSetup=Process95
OnCloseAdvancedControls=Process95
ScanTimeOutBookeye=Process99

;KeyScanSettingsBookeye=F12

;KeyProcess11=F1
;KeyProcess12=F2
;KeyProcess15=F3

;// ///////////////////////
;// MODULE: ImageTreatment
;    KeyProcess37=F4
;// End
;// ///////////////////////

;KeyProcess14=F5

;// //////////////////////
;// MODULE: ResendArticle
;    KeyProcess32=F6
;// End
;// //////////////////////

;KeyProcess27=F7
;KeyExitBscan=F8

;KeyPan=F9

; to allow multi line editfields

KeyProcess51=F3
KeyProcess89=F2
KeyProcess11=F1
KeyProcess14=F5

KeyProcess58=F6
KeyProcess59=F7
KeyProcess63=F8

KeyProcess33=F11

KeyProcess70=F9

KeyProcess46=F12

KeyProcess83=F4

;* Button settings
;

ConfigFaceLiftOffset=0,0

ButtonProcess12=@c:\bscanill\Lib\icons\new\images\newsession.gif,0,29,191,29
ButtonProcess11=@c:\bscanill\Lib\icons\new\images\scanpullslip.gif,191,29,191,29
ButtonProcess48=@c:\bscanill\Lib\icons\new\images\setcolor.gif,284,116,98,29
ButtonProcess49=@c:\bscanill\Lib\icons\new\images\setgray.gif,191,116,93,29
ButtonProcess50=@c:\bscanill\Lib\icons\new\images\SetBW-long-pressed.gif,0,116,191,29
ButtonProcess51=@c:\bscanill\Lib\icons\new\images\singlescan.gif,0,58,191,29


ButtonProcess67=@c:\bscanill\Lib\icons\new\images\toolbar_main.gif,0,0,382,29
ButtonProcess75=@c:\bscanill\Lib\icons\new\images\toolbar_ip.gif,0,203+29,382,29

ButtonRotate90=@c:\bscanill\Lib\icons\new\images\rotate90cw.gif,0,232+29,191,29
ButtonRotate270=@c:\bscanill\Lib\icons\new\images\rotate90ccw.gif,191,232+29,191,29
;ButtonDeleteOne=@C:\BSCANILL\Lib\icons\new\images\deletepage.gif,0,203,191,29
ButtonProcess79=@c:\bscanill\Lib\icons\new\images\deletepage.gif,0,261+29,191,29
ButtonProcess38=@c:\bscanill\Lib\icons\new\images\rescanpage.gif,191,261+29,191,29
ButtonProcess58=@c:\bscanill\Lib\icons\new\images\smallrotatecw.gif,0,290+29,93,29
ButtonProcess59=@c:\bscanill\Lib\icons\new\images\smallrotateccw.gif,93,290+29,98,29
ButtonProcess63=@c:\bscanill\Lib\icons\new\images\savechanges.gif,191,290+29,191,29
ButtonProcess64=@c:\bscanill\Lib\icons\new\images\insertpage.gif,191,319+29,191,29
OnMouseLeftButtonUp=
ButtonProcess37=
ButtonProcess54=@c:\bscanill\Lib\icons\new\images\imagetreatment.gif,0,319+29,191,29
ButtonProcess76=@c:\bscanill\Lib\icons\new\images\toolbar_botip.gif,0,377+29,382,11




;// /////////////////////////////////
;// MODULE: ResendArticle
ButtonProcess32=@c:\bscanill\Lib\icons\new\images\resendarticle.gif,191,174+29,191,29
;// End
;// /////////////////////////////////

ButtonProcess27=@c:\bscanill\Lib\icons\new\images\setuplong.gif,191,116+29,191,29

ButtonProcess14=@c:\bscanill\Lib\icons\new\images\sendarticle_short.gif,0,174+29,191,29

ButtonProcess44=@c:\bscanill\Lib\icons\new\images\printimage.gif,0,348+29,191,29
ButtonProcess46=@c:\bscanill\Lib\icons\new\images\exitsmall.gif,191,348+29,191,29

ButtonProcess81=@c:\bscanill\Lib\icons\new\images\multiscanrotated.gif,0,87,191,29


;* Scanner settings
;
ScanSettingsName=Startup (CONFIG1)
ScanResolution=300


;if Flatbed or Minolta -> ScanFeeder=0
;if ADF except Minolta-> ScanFeeder=1  (just ADF no flatbed used)
;if ADF except Minolta in Auto feeder mode ADF/flatbed-> ScanFeeder=3

ScanFeeder=0
MultiScanAutoFeedMode=1

ScanTimeout=30000
;ScanPaperSize=Portrait,Auto
ScanPaperSize=Portrait,Letter - 8.5 x 11 in
;ScanPaperSize=Landscape,Letter - 8.5 x 11 in
;ScanPaperSize=Portrait,Letter - 8.5 x 11 in
ScanManualStart=No
ScanSides=1

;OcrTrainWindow=Open

;* Misc. settings
;
;Export=Process15
BSCANExitProcess=2
ScanProcesses=8
Help=c:\progra~1\intern~1\iexplore.exe %IP\HELP\%HC.htm
ScanBlank=0

EditBox2=Close
EditBox1=OpenLive
EditBox17=OpenLive

ScanBitsPerPixel=1

AfterConfig=Process6
OnNewImage=Process39
ButtonProcess80=@c:\bscanill\Lib\icons\new\images\toolbar_ariel.gif,0,145+29,382,29
ButtonProcess89=@c:\bscanill\Lib\icons\new\images\multiscan.gif,191,58,191,29
ButtonProcess98=
MoreScanSettings=YES
ButtonProcess90=
ButtonProcess91=
ButtonProcess92=
ButtonProcess93=@c:\bscanill\Lib\icons\new\images\scanner_setup.gif,0,116+29,191,29
ButtonProcess96=@c:\bscanill\Lib\icons\new\images\pagesize.gif,191,87,191,29,,Allows the current page size to be changed without affecting other page sizes
ScanBrightness=50
ScanAutoBrightness=No
ScanContrast=50
ScanMultiWaitTwainIdle=4000
FaceLiftCommandFrameWidth=390


[CONFIG10] ;Scan pull slip - twain
ScanSettingsName=Pull_Slip (CONFIG10)
ScanPaperSize=Landscape,Letter - 8.5 x 11 in
MoreScanSettings=YES
ScanProcesses=8
AfterConfig=Process6
FaceLiftCommandFrameWidth=390
ScanResolution=300
ScanBitsPerPixel=1
ScanFeeder=0
ScanSides=1

[CONFIG14] ;Bookedge STD/LED scan mode - twain
ScanSettingsName=Bookedge (CONFIG14)
ScanPaperSize=Landscape,Letter - 8.5 x 11 in
MoreScanSettings=YES
ScanProcesses=8
;;AfterConfig=Process6
FaceLiftCommandFrameWidth=390
EditBox14=OpenLive
ScanTimeout=30000,Process103

[PROCESS103] ;timeout process in bookedge mode to restore config1
#52=0
Command=Config1


[PROCESS104] ;force color and compression setting (to avoid bookeye relaunch) issue
:27=
S9=
ReadINI=BOOKEYE,colormode,S9
If1=%-.-S9!=
:27=Colormode(%S9)
EndIf1=

S9=
ReadINI=BOOKEYE,tiff_compr,S9
If1=%-.-S9!=
If2=%-.-S9==none
If=%-.-:27==
:27=Compression(uncompressed)
Else=
:27=%0-.-:27,Compression(uncompressed)
EndIf=
EndIf2=
If3=%1S9==g
If=%-.-:27==
:27=Compression(G4)
Else=
:27=%0-.-:27,Compression(G4)
EndIf=
EndIf3=
If4=%1S9==G
If=%-.-:27==
:27=Compression(G4)
Else=
:27=%0-.-:27,Compression(G4)
EndIf=
EndIf4=
EndIf1=

If5=%-.-:27!=
BookeyeSetting1=%:27
EndIf5=


[PROCESS93] ; ADF scanner setup
If=%8F8!=Bookedge
Command1=ScanSettings
Else=
Command2=ScanImageControls
If=%1PF==F
Command3=ScanSettings
EndIf=
EndIf=


[PROCESS81] ;display contrast/brightness dialog
If0=%F8!=Rebel
If=%#23==0
If=%#02==1
If1=%F7!=ADF
Command1=ScanSettingsBookeye
Else1=
If2=%8F8!=Bookedge
Command2=ScanBrightnessControl
Else2=
If3=%NP>0
;;Command3=ScanImageControls
;when Plustek this process is used for Multi Scan Rotated (rotate every other)

;run multi scan
;Command=Process89
#56=0
#52=1
If=%F8==Bookedge STD/LED
Command=Config14
Else=
EditBox14=OpenLive
EndIf=
Else3=
MessageOK=Please scan a pullslip first!
EndIf3=
EndIf2=
EndIf1=
EndIf=
EndIf=

Else0=
#96=UserInput,Set Brightness:,3,SX/2-100,SY/2-35,200,70
If=%#96<0
#96=0
EndIf=
If=%#96>256
#96=256
EndIf=
RebelSetBrightness=%#96
EndIf0=


[EDITBOX14] ;Multi scan rotated
EditTitle=Multi scan
EditWindow=SX-200/2,SY-240/2,200,240
EditOnTopFaceLift=Yes

Stats1=30,17,Scanning first:
;; afterchar points to junk process - no action...
Field1=Radio,30,50,100,101,:29,,15,AfterChange=Process37,ValidValue(Left side,Right side)
Field2=Button,30,165,:99,Cancel,4,AfterChange=Process10
Field3=Button,95,165,:99,OK,4,AfterChange=Process34

EditOnClose=Process89


[PROCESS10]
#52=1
EditBox14=Close


[PROCESS34]
#52=2
EditBox14=Close


;----------------------------------------------
[CONFIG2] IP Menu

;* Window settings
;
FaceLiftCommandFrameWidth=390
ControlWindow=0,179,383,195,22,0
ControlWindowStats1=5,5,
ControlMenu=off
ControlTitle=ILL
ViewWindows=1,1,383,0,SX-383,SY-31
ViewDefaults=0,0,2,3,0
ViewGlobal=zoom,scrolling,rendering
ViewTitle=%FP %C4.%C3.%C2.%C1
;ViewTitle=%FP %C4.%C3.%C2.%C1 %MWx%MHmm %DRdpi %FS bytes
ViewSides=1

;* Mouse settings
;
OnMouseRightButtonUp=Process47
;// ///////////////////////////////////
;// MODULE: ImageTreatment
    OnMouseLeftButtonUp=
;// End
;// ///////////////////////////////////

;* Key settings
;
;KeyProcess11=F1
;KeyProcess12=F2
;KeyProcess15=F3

;// ///////////////////////
;// MODULE: ImageTreatment
;    KeyProcess37=F4
;// End
;// ///////////////////////

;KeyProcess14=F5

;// //////////////////////
;// MODULE: ResendArticle
;    KeyProcess32=F6
;// End
;// //////////////////////

;KeyProcess27=F7
;KeyExitBscan=F8

KeyPan=F9

;* Button settings
;

ButtonRotate90=@C:\BSCANILL\Lib\icons\IPMenu\rotate90cw.jpg,0,0,191,29
ButtonRotate270=@C:\BSCANILL\Lib\icons\IPMenu\rotate90ccw.jpg,191,0,191,29
;ButtonDeleteOne=@C:\BSCANILL\Lib\icons\IPMenu\delsingle.jpg,0,29,191,29
ButtonProcess79=@C:\BSCANILL\Lib\icons\IPMenu\delsingle.jpg,0,29,191,29
ButtonProcess38=@C:\BSCANILL\Lib\icons\IPMenu\rescansingle.jpg,191,29,191,29
ButtonProcess58=@C:\BSCANILL\Lib\icons\IPMenu\rotate1cw.jpg,0,58,93,29
ButtonProcess59=@C:\BSCANILL\Lib\icons\IPMenu\rotate1ccw.jpg,93,58,98,29
ButtonProcess63=@C:\BSCANILL\Lib\icons\IPMenu\savechanges.jpg,191,58,191,29

;// //////////////////////////////////////
;// MODULE: ImageTreatment
ButtonProcess37=
;// End
;// //////////////////////////////////////

;// //////////////////////////////////////
;// MODULE: ImageTreatmentPLUS
ButtonProcess54=@C:\BSCANILL\Lib\icons\IPMenu\imagetreatment.jpg,0,87,191,29
;// End
;// //////////////////////////////////////


ButtonProcess64=@C:\BSCANILL\Lib\icons\IPMenu\insert.jpg,191,87,191,29
ButtonProcess53=@C:\BSCANILL\Lib\icons\IPMenu\mainmenu.jpg,0,116,382,29




OnNewImage=Process39
EditBox2=Close
EditBox1=OpenLive
EditBox17=OpenLive





[CONFIG8] While processing
FaceLiftCommandFrameWidth=390
ControlWindow=0,0,SX,SY-31,22,0
ControlMenu=DefaultControlMenu
ViewWindows=1,1,3,72,SX,34

KeyPan=F9
ButtonProcess46=[F12] Exit BSCAN ILL
;ButtonProcess15=Register Page
KeyProcess46=F12

EditBox1=Close
EditBox17=Close
EditBox2=Close
;EditBox3=OpenLive
;KeyProcess4=Enter


[CONFIG9] Log in Configuration
FaceLiftCommandFrameWidth=390
ControlWindow=0,0,SX,SY-31,22,0
ControlWindowStats1=1,1,
ControlMenu=DefaultControlMenu
ControlTitle=
ViewWindows=1,1,3,72,SX,34

ConfigFaceLiftOffset=0,0

;KeyPan=F9
;ButtonProcess46=[F12] Exit BSCAN ILL
ButtonProcess46=@C:\BSCANILL\Lib\icons\new\images\exit.gif,0,29,382,29

;ButtonProcess15=Register Page
KeyProcess46=F12

EditBox1=Close
EditBox17=Close

EditBox2=Close

EditBox3=OpenLive
;KeyProcess4=Enter

AfterConfig=Process3



[PROCESS94] ;set color buttons
            If=%F7!=ADF
            If=%8F8!=Bookedge
            If=%F8!=Minolta
              If=%#02==1
                If0=%F8!=Rebel
                  BookeyeSettingGet=S9,Color               
                  If=%1PF==P

                    If=%-.-S9==truecolor
                      ;WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,58+%#72,93,29
                      ;WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,58+%#72,98,29
                      ;WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor-pressed.gif,0,87+%#72,93,29
                      WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,87+%#72,93,29
                      WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,87+%#72,98,29
                      WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor-pressed.gif,191,87+%#72,93,29                   
                    Else=
                      If=%-.-S9==grayscale
                        ;WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,58+%#72,93,29
                        ;WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray-pressed.gif,93,58+%#72,98,29
                        ;WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,0,87+%#72,93,29                 
                        WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,87+%#72,93,29
                        WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray-pressed.gif,93,87+%#72,98,29

		        If11=%#54==1
                          WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,191,87+%#72,93,29                                      
                        Else11=
                          WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcoloroff.gif,191,87+%#72,93,29              
                        EndIf11= 
                      Else=                     
                        ;WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw-pressed.gif,0,58+%#72,93,29                     
                        ;WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,58+%#72,98,29
                        ;WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,0,87+%#72,93,29                   
                        WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw-pressed.gif,0,87+%#72,93,29
                        WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,87+%#72,98,29
                        If11=%#54==1
                          WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,191,87+%#72,93,29                                        
                        Else11=
                          WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcoloroff.gif,191,87+%#72,93,29
                        EndIf11=
			
			;;Message to warn If bitonal+uncompressed!!!
			BookeyeSettingGet=S9,Compression               
                        If55=%1PF==P                                                  
                          If56=%-.-S9==none
                            MessageOK11=Warning! Uncompressed B&W color mode selected!
                          EndIf56=
                        EndIf55=
                      EndIf=
                    EndIf=
                  Else=
                      ;WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,58+%#72,93,29
                      ;WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,58+%#72,98,29
                      ;WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,0,87+%#72,93,29
                      WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,87+%#72,93,29
                      WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,87+%#72,98,29
                      WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,191,87+%#72,93,29
                  EndIf=
                Else0=
                        WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw-pressed.gif,0,87+%#72,93,29
                        WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,87+%#72,98,29
                        WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,191,87+%#72,93,29
                EndIf0=
              Else=
                     WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbwoff.gif,0,87+%#72,93,29
                     WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgrayoff.gif,93,87+%#72,98,29
                     WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcoloroff.gif,191,87+%#72,93,29              
              EndIf=
            EndIf=
  	    EndIf=
  	    
  	    Else=
  	      ;If=%F8==Bookedge STD/LED
  	      If=%8F8==Bookedge
  	        S9=
  	        ReadINI=CONFIG1,ScanBitsPerPixel,S9
  	        If=%S9==24
                    WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\SetBW-long.gif,0,116,191,29
                    WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,191,116,93,29
                    WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor-pressed.gif,284,116,98,29  	        
  	        Else=
  	          If=%S9==8
                    WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\SetBW-long.gif,0,116,191,29
                    WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray-pressed.gif,191,116,93,29
                    WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,284,116,98,29
  	          Else=
                    WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\SetBW-long-pressed.gif,0,116,191,29
                    WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,191,116,93,29
                    WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,284,116,98,29
                  EndIf=
                EndIf=
              Else=
                WriteINI=CONFIG1,ButtonProcess48,
                WriteINI=CONFIG1,ButtonProcess49,
                WriteINI=CONFIG1,ButtonProcess50,              
  	      EndIf=
  	    EndIf=
  	    
  	    
[PROCESS95]     
;MessageOK=process95-BD-%SL!     
Call=Process94
ExecuteFaceliftButtonReload=yes
Command=Config1


[PROCESS97] ;auto update process
; this command below will freeze any updates of images and editfields in facelift
If=%NP>0
OnNewImage=off
SuspendFaceLiftUpdate=All

;        If1=%:00!=
;            If2=%:01!=
;                If3=%:02!=  
         
                    #32=0
                    
                    :33=%PN
                    
                    :35=%0-.-:00
                    :36=%0-.-:01
                    
                    ;ILL Number
                    ;:37=%0-.-:02
                    :37=%0-.-:04
                    
                    ;TN
                    :34=%0-.-:05
                    
                    If=%-.-:30!=                       
                      If=%0-.-:30==Email
                        If=%-.-:04!=
                          :02=%:04
                        EndIf=
                      EndIf=
                            
                      If=%0-.-:30==Email+Ftp
                        If=%-.-:04!=
                          :02=%:04
                        EndIf=
                      EndIf=

                      If=%0-.-:30==Ariel
                        If=%-.-:04!=
                          :02=%:04
                        EndIf=
                      EndIf=   

                      If=%0-.-:30==Odyssey
                        If=%-.-:05!=
                          :02=%:05
                        EndIf=
                      EndIf=    
              
                      If=%0-.-:30==ILLiad
                        If=%-.-:05!=
                          :02=%:05
                        EndIf=
                      EndIf= 

                      If=%0-.-:30==Save on Disk
                        If=%-.-:04!=
                          :02=%:04
                        EndIf=
                      EndIf=                                            
                    EndIf=   
                                     
                    :31=%0-.-:02                                        
                    :38=%0-.-:30
                    
                    If=%-.-:74!=1
                      ; no control sheet on current page - find it
                      UpdateView=No
                      While=%#32==0
                        If=%1:74!=1
                          If=%PN>0
                            PN=PN-1
                          Else=
                            #32=2
                          EndIf=
                        Else=                          
                          #32=1 
                        EndIf=  
                      EndWhile=                      
                    EndIf=
                                             
                    If=%1:74==1                    
                        :00=%0-.-:35
                        :01=%0-.-:36
                        :04=%0-.-:37
                        :05=%0-.-:34
                        :02=%0-.-:31
                        :30=%0-.-:38                    
                    
                        ; is ILL Number OK?
                        :04=%-.-:04
                        
                        #82=0    
                        #83=0                    
                        #07=%LN(:04)
                          
                        #05=0
                        While=%#05<%#07
                            #06=0
                            If=%(#05).1:04>=0
                            If=%(#05).1:04<=9
                              #06=1
                            EndIf=
                            EndIf= 
                            
                            If=%#06==0
                              If=%(#05).1:04>=A
                              If=%(#05).1:04<=Z
                                #06=1
                              EndIf=
                              EndIf=
                            EndIf=
                            
                            If=%#06==0
                              If=%(#05).1:04>=a
                              If=%(#05).1:04<=z
                                #06=1
                              EndIf=
                              EndIf=
                            EndIf=             
                            
                            If=%#06==0
                              If=A%(#05).1:04==A_
                                #06=1
                              EndIf=
                            EndIf=
                            If=%#06==0
                              If=A%(#05).1:04==A-
                                #06=1
                              EndIf=
                            EndIf=                                                                     
                          
                            Ifd=%#06==1
                              #05=#05+1
                            Elsed=
                              ;bad char
                              #05=%#07 
                              #82=1                                                            
                            EndIfd=
                            
                        EndWhile=
                          
                        ;test if dash is not as last character - ariel would not like it (based on LindaHall info)
                        #07=#07-1
                        If=A%(#07).1:04==A-
                                #82=1
                        EndIf=
                        
                        ; is TN OK?
                        :05=%-.-:05
                        ;#82=0                        
                        #07=%LN(:05)
                          
                        #05=0
                        While=%#05<%#07
                            #06=0
                            If=%(#05).1:05>=0
                            If=%(#05).1:05<=9
                              #06=1
                            EndIf=
                            EndIf= 
                            
                            If=%#06==0
                              If=%(#05).1:05>=A
                              If=%(#05).1:05<=Z
                                #06=1
                              EndIf=
                              EndIf=
                            EndIf=
                            
                            If=%#06==0
                              If=%(#05).1:05>=a
                              If=%(#05).1:05<=z
                                #06=1
                              EndIf=
                              EndIf=
                            EndIf=             
                            
                            If=%#06==0
                              If=A%(#05).1:05==A_
                                #06=1
                              EndIf=
                            EndIf=
                            If=%#06==0
                              If=A%(#05).1:05==A-
                                #06=1
                              EndIf=
                            EndIf=                                                                     
                          
                            Ifd=%#06==1
                              #05=#05+1
                            Elsed=
                              ;bad char
                              #05=%#07 
                              ;#82=1
                              #82=#82+2
                            EndIfd=
                            
                        EndWhile=
                          
                        ;test if dash is not as last character - ariel would not like it (based on LindaHall info)
                        #07=#07-1
                        If=A%(#07).1:05==A-
                                ;#82=1
                                #82=#82+2
                        EndIf=                        
                        
                        ;Ifgh=%#82==1
                        Ifgh=%#82>0
                          ;MessageOK=Please specify a valid DocID!                       
                          If=%#82==1
                            MessageOK=Please specify valid ILL Number!
                          EndIf=
                          If=%#82==2
                            #82=0
                            #83=1
                            MessageOK=Please specify valid TN!
                          EndIf=
                          If=%#82==3
                            #82=1
                            #83=1
                            MessageOK=Please specify valid ILL Number and TN!
                          EndIf=                          
                        Elsegh=                    
                          :39a=                                                                              
                          UpdateLogEntry1=Yes
                          
                          ; update next pages in article
                          UpdateView=No
                          #32=0
                          If=%PN<%LP
                           PN=PN+1
                           While=%#32==0
                            If=%1:74!=1
                              :00=%0-.-:35
                              :01=%0-.-:36
                              :04=%0-.-:37
                              :05=%0-.-:34
                              :02=%0-.-:31
                              :30=%0-.-:38     
                              UpdateLogEntry1=Yes
                              
                              If=%PN<%LP
                                PN=PN+1
                              Else=
                                #32=1
                              EndIf=
                            Else=                          
                              #32=1 
                            EndIf=  
                           EndWhile=                            
                          
                          EndIf=
                          
                          ;// Clear IP/Email exception
                          #81=0
                        
                          ;// Clear ILL#-DocID exception
                          #82=0
                          
                          ;// Clear TN exception
                          #83=0
                        
                          ;;;;;;;;;;;;;;;;;;;;;MessageOK=Information Updated!
                        EndIfgh=
                    Else=
                      ;  MessageOK=Please navigate to the appropriate pullslip for the given article in order to update the information.
                      MessageOK=Cannot find pullslip for current article!
                    EndIf=
                    
                    PN=%:33
                    UpdateView=Yes
                    
                    :00=%0-.-:35
                    :01=%0-.-:36
                    :04=%0-.-:37
                    :05=%0-.-:34
                    :02=%0-.-:31
                    :30=%0-.-:38        
                    UpdateEditboxes=Yes             
    
;                Else3=
;                    MessageOK1=Please fill in DocID!
;                EndIf3=
;            Else2=
;                MessageOK2=Please fill in Ariel IP!
;            EndIf2=
;        Else1=
;            MessageOK3=Please fill in Patron Name!
;        EndIf1=
SuspendFaceLiftUpdate=DelayedNo       
OnNewImage=on        
EndIf=


[PROCESS96] ; set independent clip flag
If=%#17==0
#17=8
If=%F7==ADF
WriteINI=CONFIG1,ButtonProcess96,@%F0\Lib\icons\new\images\pagesize-pressed.gif,191,87,191,29,,Allows the current page size to be changed without affecting other page sizes
Else=
WriteINI=CONFIG1,ButtonProcess96,@%F0\Lib\icons\new\images\pagesize-pressed.gif,191,116+%#72,191,29,,Allows the current page size to be changed without affecting other page sizes
EndIf=
Else=
#17=0
If=%F7==ADF
WriteINI=CONFIG1,ButtonProcess96,@%F0\Lib\icons\new\images\pagesize.gif,191,87,191,29,,Allows the current page size to be changed without affecting other page sizes
Else=
WriteINI=CONFIG1,ButtonProcess96,@%F0\Lib\icons\new\images\pagesize.gif,191,116+%#72,191,29,,Allows the current page size to be changed without affecting other page sizes
EndIf=
EndIf=
ExecuteFaceliftButtonReload=yes
Command=Config1 
                


[PROCESS102] ; set multi scan ON
If=%F7!=ADF
If=%8F8!=Bookedge
If=%F8!=Minolta
If0=%F8!=Rebel

;remember status of 'high speed' button and 'reset scan area' button
WriteINIb=CONFIG1,ButtonProcess11,@%F0\Lib\icons\new\images\scanpullslipoff.gif,191,29,191,29
WriteINIc=CONFIG1,ButtonProcess51,@%F0\Lib\icons\new\images\scannowoff.gif,0,58+%#72,191,29
WriteINIe=CONFIG1,ButtonProcess81,@%F0\Lib\icons\new\images\scanner_setupoff.gif,0,116+%#72,191,29
WriteINIk=CONFIG1,ButtonProcess38,@%F0\Lib\icons\new\images\rescanpageoff.gif,191,261+%#72,191,29
WriteINIp=CONFIG1,ButtonProcess64,@%F0\Lib\icons\new\images\insertpageoff.gif,191,319+%#72,191,29
If=%#02==1
;bookeye is available
WriteINIa=CONFIG1,ButtonProcess12,@%F0\Lib\icons\new\images\newsessionoff.gif,0,29,191,29
WriteINId=CONFIG1,ButtonProcess27,@%F0\Lib\icons\new\images\setupoff.gif,284,87+%#72,98,29
WriteINIf=CONFIG1,ButtonProcess14,@%F0\Lib\icons\new\images\sendarticle_shortoff.gif,0,174+%#72,191,29
WriteINIg=CONFIG1,ButtonProcess32,@%F0\Lib\icons\new\images\resendarticleoff.gif,191,174+%#72,191,29
WriteINIh=CONFIG1,ButtonRotate90,@%F0\Lib\icons\new\images\rotate90cwoff.gif,0,232+%#72,191,29
WriteINIi=CONFIG1,ButtonRotate270,@%F0\Lib\icons\new\images\rotate90ccwoff.gif,191,232+%#72,191,29
WriteINIj=CONFIG1,ButtonProcess79,@%F0\Lib\icons\new\images\deletepageoff.gif,0,261+%#72,191,29
WriteINIl=CONFIG1,ButtonProcess58,@%F0\Lib\icons\new\images\smallrotatecwoff.gif,0,290+%#72,93,29
WriteINIm=CONFIG1,ButtonProcess59,@%F0\Lib\icons\new\images\smallrotateccwoff.gif,93,290+%#72,98,29
WriteINIn=CONFIG1,ButtonProcess63,@%F0\Lib\icons\new\images\savechangesoff.gif,191,290+%#72,191,29
WriteINIo=CONFIG1,ButtonProcess54,@%F0\Lib\icons\new\images\imagetreatmentoff.gif,0,319+%#72,191,29

WriteINIr=CONFIG1,ButtonProcess44,@%F0\Lib\icons\new\images\printimageoff.gif,0,348+%#72,191,29
WriteINIs=CONFIG1,ButtonProcess46,@%F0\Lib\icons\new\images\exitsmalloff.gif,191,348+%#72,191,29
EndIf=

:14=
ReadINI1=CONFIG1,ButtonProcess90,:14
WriteINI1=PROCESS99,WriteINI1,CONFIG1,ButtonProcess90,%0-.-:14
If=%-.-:14!=
WriteINI11=CONFIG1,ButtonProcess90,@%F0\Lib\icons\new\images\highspeedoff.gif,0,58,191,29
EndIf=

:14=
ReadINI2=CONFIG1,ButtonProcess91,:14
WriteINI2=PROCESS99,WriteINI2,CONFIG1,ButtonProcess91,%0-.-:14
If=%-.-:14!=
WriteINI22=CONFIG1,ButtonProcess91,@%F0\Lib\icons\new\images\highspeedoff.gif,0,58,191,29
EndIf=

:14=
ReadINI3=CONFIG1,ButtonProcess92,:14
WriteINI3=PROCESS99,WriteINI3,CONFIG1,ButtonProcess92,%0-.-:14
If=%-.-:14!=
WriteINI33=CONFIG1,ButtonProcess92,@%F0\Lib\icons\new\images\resetscanareaoff.gif,191,58,191,29
EndIf=

;;
If=%#02==1
WriteINIxx=CONFIG1,ButtonProcess89,@%F0\Lib\icons\new\images\ScanPedal-pressed.gif,191,58+%#72,191,29
ScanTimerKeep=Yes
#23=2
EditFieldSetEnabled=1,000000
ExecuteFaceliftButtonReload=yes
Command=Config1 
Else=
WriteINIxs=CONFIG1,ButtonProcess89,@%F0\Lib\icons\new\images\ScanPedaloff.gif,191,58+%#72,191,29
EndIf=


Else0=
WriteINIe=CONFIG1,ButtonProcess81,@%F0\Lib\icons\new\images\bcontrast.gif,0,116+%#72,191,29
EndIf0=
EndIf=
EndIf=
EndIf=


[PROCESS99] ; set multi scan OFF
If=%F7!=ADF
If=%8F8!=Bookedge
If=%F8!=Minolta
If=%F8!=Rebel

;set on buttons to do!!!
WriteINIa=CONFIG1,ButtonProcess12,@%F0\Lib\icons\new\images\newsession.gif,0,29,191,29
WriteINIb=CONFIG1,ButtonProcess11,@%F0\Lib\icons\new\images\scanpullslip.gif,191,29,191,29
WriteINIc=CONFIG1,ButtonProcess51,@%F0\Lib\icons\new\images\scannow.gif,0,58+%#72,191,29
WriteINId=CONFIG1,ButtonProcess27,@%F0\Lib\icons\new\images\setup.gif,284,87+%#72,98,29
WriteINIe=CONFIG1,ButtonProcess81,@%F0\Lib\icons\new\images\scanner_setup.gif,0,116+%#72,191,29
WriteINIf=CONFIG1,ButtonProcess14,@%F0\Lib\icons\new\images\sendarticle_short.gif,0,174+%#72,191,29
WriteINIg=CONFIG1,ButtonProcess32,@%F0\Lib\icons\new\images\resendarticle.gif,191,174+%#72,191,29
WriteINIh=CONFIG1,ButtonRotate90,@%F0\Lib\icons\new\images\rotate90cw.gif,0,232+%#72,191,29
WriteINIi=CONFIG1,ButtonRotate270,@%F0\Lib\icons\new\images\rotate90ccw.gif,191,232+%#72,191,29
WriteINIj=CONFIG1,ButtonProcess79,@%F0\Lib\icons\new\images\deletepage.gif,0,261+%#72,191,29
WriteINIk=CONFIG1,ButtonProcess38,@%F0\Lib\icons\new\images\rescanpage.gif,191,261+%#72,191,29
WriteINIl=CONFIG1,ButtonProcess58,@%F0\Lib\icons\new\images\smallrotatecw.gif,0,290+%#72,93,29
WriteINIm=CONFIG1,ButtonProcess59,@%F0\Lib\icons\new\images\smallrotateccw.gif,93,290+%#72,98,29
WriteINIn=CONFIG1,ButtonProcess63,@%F0\Lib\icons\new\images\savechanges.gif,191,290+%#72,191,29
WriteINIo=CONFIG1,ButtonProcess54,@%F0\Lib\icons\new\images\imagetreatment.gif,0,319+%#72,191,29
WriteINIp=CONFIG1,ButtonProcess64,@%F0\Lib\icons\new\images\insertpage.gif,191,319+%#72,191,29

WriteINIr=CONFIG1,ButtonProcess44,@%F0\Lib\icons\new\images\printimage.gif,0,348+%#72,191,29
WriteINIs=CONFIG1,ButtonProcess46,@%F0\Lib\icons\new\images\exitsmall.gif,191,348+%#72,191,29

WriteINI1=CONFIG1,ButtonProcess90,
WriteINI2=CONFIG1,ButtonProcess91,
WriteINI3=CONFIG1,ButtonProcess92,

;;
WriteINIxx=CONFIG1,ButtonProcess89,@%F0\Lib\icons\new\images\ScanPedal.gif,191,58+%#72,191,29
#23=0

;EditFieldSetActive=1,111110
EditFieldSetEnabled=1,111110

ScanTimerKeep=No
ExecuteFaceliftButtonReload=yes
Command=Config1 
EndIf=
EndIf=
EndIf=
EndIf=


[PROCESS1] Entrance Process

;* Startup Process
;
;MessageOK!=Test APP

Load=Process*

#52=0
#53=0
#55=0

;temp flag to allow temporaryly scan pull slip in multi scan mode - to support scan pull lsip button on BE4's touch screen
:54=

;#56 flag if single scan with plustek - rotate 270
#56=0
:29=Left side

:56=

;F8 remember if Plustek/Minolta -> twain scanners
F8=

:14a=

#72=0
#73=0

;#26 flag if first page of article is imported (restored from ExportedImages) now
#26=0

#33=0

;#51  page modified flag to remember last page modified by clip or small angle rotate -to validate not to proceed to export without saving modified image
#51=-1

;;;SetJpegQualityForPDF=210

;#23 flag if MultiscanBookeyeWait command will be executed after launching config1
#23=0

:16=
:28=
#00=0

If=%NP==0
;:17 flag for independent image (different clip size)
:17=
EndIf=

#17=0
#19=0

;#13=0 no twain (=ADF+pedal) , #13=1 twain - we need to run read control sheet at scan time becuase command=ScanOne does not wait until scan is done if twain...
#13=0

;#50=0 to use PDFCreator to generate pdf, #50=1 to use IRIS to generate pdf
;#50=0
#50=1

#84=0

; is color supported?
#54a=1

ReadINI1=PARAMS,Logo,:85
#74=1
If=%1:85==N
#74=0
EndIf=
If=%1:85==n
#74=0
EndIf=

If=%#74==1
WriteIni=CONFIG1,EditBox2,OpenLive
WriteIni=CONFIG2,EditBox2,OpenLive
WriteIni=CONFIG9,EditBox2,OpenLive
:85=0,100
WriteIni=CONFIG1,ConfigFaceLiftOffset,%:85
WriteIni=CONFIG9,ConfigFaceLiftOffset,%:85
;:85=0,769
:85=0,799
WriteIni=EDITBOX17,EditFaceLiftOffset,%:85
:85=0,586
WriteIni=EDITBOX1,EditFaceLiftOffset,%:85
Else=
WriteIni=CONFIG1,EditBox2,Close
WriteIni=CONFIG2,EditBox2,Close
WriteIni=CONFIG9,EditBox2,Close
:85=0,0
WriteIni=CONFIG1,ConfigFaceLiftOffset,%:85
WriteIni=CONFIG9,ConfigFaceLiftOffset,%:85

F8=
ReadINI7=@%AP\..\Lib\Control.lst,MAIN,Scanner,F7
If=%F7==Minolta
F8=Minolta
F7=ADF
EndIf=

If=%F7==Plustek
F8=Bookedge a300
F7=ADF
EndIf=

If=%0-.-F7==Bookedge a300
F8=Bookedge a300
F7=ADF
EndIf=

If=%0-.-F7==Bookedge STD/LED
F8=Bookedge STD/LED
F7=ADF
EndIf=

If=%F7==Rebel
F8=Rebel
F7=Bookeye
EndIf=

#02a=1
If4=%F7==Bookeye

If=%F8!=Rebel
BookeyeStatusGet=Yes
If5=%1PF!=P
;Bookeye/Widetek not connected and disabled
#02b=0
Else5=

;is it color unit?
#54a=0
BookeyeSettingIsValid=colormode,truecolor		
If1=%1PF==P
#54b=1
EndIf1=

EndIf5=
EndIf=
Else4=
If6=%F7==Widetek
BookeyeStatusGet=Yes
If5=%1PF!=P
;Bookeye/Widetek not connected and disabled
#02b=0
Else5=

;is it color unit?
#54a=0
BookeyeSettingIsValid=colormode,truecolor		
If1=%1PF==P
#54b=1
EndIf1=

EndIf5=
EndIf6=
EndIf4=

    ;Auto scan mode?
:85=0,387  
#84=0

Ifti=%F7!=ADF
  If=%F8!=Rebel
    ; S8 is just local variable -> is used in different places...
    S8=
    ReadINI10=@%AP\..\Lib\Control.lst,MAIN,ScanAuto,S8
    S8=%-.-S8
    Ifww=%-.-S8!=
      IsNumeric=S8
      If=%1PF==F
        ;alpha
        S8=%UC(%S8)              
        If=%1S8==Y
          :85=0,416          
          ;;#84=1
          ; default TURBO mode (option 4)
          #84=4
        EndIf=
      Else=
        ;numeric
        If=%1S8!=0
          :85=0,416
          #84=%S8
          S8=Yes
        Else=
          S8=No
        EndIf=                        
      EndIf=      
    EndIfww=
  Else=
    S8=No
  EndIf=
Elseti=
  S8=No
EndIfti=
     
WriteIni=EDITBOX1,EditFaceLiftOffset,%:85

If=%1S8==Y
  ;:85=0,599
  :85=0,629
Else=
  ;:85=0,570
  :85=0,600
EndIf=
WriteIni=EDITBOX17,EditFaceLiftOffset,%:85

EndIf=

CacheSize=256000000

    ;// Set page and article # counters
    If=%:22==
        :22=0
        :23=0
    EndIf=


;// Trigger, if :85 == 1 then it means that whatever the root path is set to does not match the %AP variable.
;// Warn the user and open up the setup screen.
;// Default = 0
:85=

:31=

;;:80=0
ReadINI1=@%AP\..\Lib\Control.lst,PATHS,Root,F0
;;;;;ReadINI2=@%AP\..\Lib\Control.lst,PATHS,Temp,F1

ReadINI9=@%AP\..\Lib\Control.lst,PATHS,SaveOnDiskPath,:32

ReadINI3=@%AP\..\Lib\Control.lst,FTP,FtpUseImageSubfolder,S8
#74a=1
Ifw=%-.-S8!=
F2=%UC(%S8)
Iftt=%1F2==N
#74b=0
EndIftt=
EndIfw=

F2c=
ReadINI3=@%AP\..\Lib\Control.lst,PATHS,ExportImages,F2
ReadINI4=@%AP\..\Lib\Control.lst,ILL_TRANSFER,TRANSFER_PATH,F3
ReadINI5=@%AP\..\Lib\Control.lst,PATHS,KICDropPoint,F5
ReadINI6=@%AP\..\Lib\Control.lst,MAIN,Site,F6
;;ReadINI7=@%AP\..\Lib\Control.lst,MAIN,Scanner,F7

If=%F7==Bookeye
If=%F8!=Rebel
If=%#02==1
BookeyeSetting=Speed(2)
EndIf=

Else=
  ; set Rebel settings
  RebelSetFormat=Tiff
  RebelSetColor=bitonal
  RebelSetContrast=128
  RebelSetBrightness=128
EndIf=
EndIf=


ReadINI9=BSCAN,BookeyeAddress,:11
;;;ReadINI8=BSCAN,Version,:56
;;ReadINI10=@%AP\..\Lib\Control.lst,MAIN,Pedal,:12
;;If=%F7!=ADF
; if widetek or Bookeye-> force pedal off
:12=No
;;EndIf=

ReadINI61=@%AP\..\Lib\Control.lst,MAIN,OCR,:15
If61=%-.-:15==
:15c=Yes
EndIf61=

;// Export mode (Ariel,Email,Ftp)
:82=No
:83=No
:84=No
;;;:86=No
:62=No
:61=No

ReadINI10=@%AP\..\Lib\Control.lst,MAIN,SendUsing,:97
If=%:97==
:97=Ariel
EndIf=

If=%:97==Ariel
  :82=Yes
EndIf=

If=%:97==ILLiad
  :61=Yes
EndIf=

If=%:97==Odyssey
  :62=Yes
EndIf=

If=%:97==Email
  :83=Yes
EndIf=

If=%:97==Email+Ftp
  :84=Yes
EndIf=

If=%:97==User
  ;;;:86=Yes
EndIf=


    ReadINI14=@%AP\..\Lib\Control.lst,EMAIL,MaxEmailAttachSize,:78
    ReadINI15=@%AP\..\Lib\Control.lst,EMAIL,EmailReturnEmail,:75
    ReadINI16=@%AP\..\Lib\Control.lst,EMAIL,EmailSubjectText,:76
    ReadINI17=@%AP\..\Lib\Control.lst,EMAIL,EmailMessageText,:77
    ReadINI18=@%AP\..\Lib\Control.lst,FTP,FtpAddress,:72
    ReadINI19=@%AP\..\Lib\Control.lst,FTP,FtpFilePath,:73
    
    ;// Determine what version of Ariel to use when sending
    ReadINI19=@%AP\..\Lib\Control.lst,ARIEL,Version,:87
    ;ReadINI20=@%AP\..\Lib\Control.lst,ARIEL,Path2,:89
    
    If=%:87==4
        ;taken out per Jirka's request
       ;;;;;;;;;;;;;;; FileCopy=%F0\Lib\wariel4.lnk, %F0\Lib\wariel.lnk
    Else=
        If=%:87==3
        ;taken out per Jirka's request
       ;;;;;;;     FileCopy=%F0\Lib\wariel3.lnk, %F0\Lib\wariel.lnk
        EndIf=
    
    EndIf=
    
    ;// Determine ImageFormat settings
    ReadINI21=@%AP\..\Lib\Control.lst,MAIN,ImageFormat,:51
        
    S8a=%AP
    #30a=%LN(S8)
    #30b=%#30-5
    
    If3=%F0!=%(%#30)S8
        F0a=%(%#30)S8
        ;:85a=1
    EndIf3=

Ifgg=%F7!=ADF
If=%F8!=Rebel
If=%#02==1
  BookeyeSetting=Format(auto)    
EndIf=
EndIf=
EndIfgg=
    
  ;Auto scan mode?
  ; S8 is just local variable -> is used in different places...
  Ifti=%F7!=ADF
    Ift2=%F8!=Rebel
      S8=
      ReadINI10=@%AP\..\Lib\Control.lst,MAIN,ScanAuto,S8
      S8=%-.-S8
      Ifww=%-.-S8!=
        IsNumeric=S8
        If=%1PF==F
          ;alpha
          S8=%UC(%S8)              
        Else=
          ;numeric
          If=%1S8!=0
            S8=Yes
          Else=
            S8=No
          EndIf=                        
        EndIf=      
      EndIfww=
    Elset2=
      S8=No
    EndIft2=
  Elseti=
      S8=No
  EndIfti=
    
;S8x=Yes    
    
    :65b=
    
       
    ;// Parse Export Directory
    ;// Default = [Root]ExportedImages
    ;// If the user wants to store the images on a network drive for instance, you can also do that via the setup window.
    ;// We need to parse the control file and find out if we're using the default or a user specified.
    ;// If we're using the default, build a filepath based on root and exportedimages folder. Otherwise just use whatever
    ;// is listed which should be written through the setup window.
    
    If=%1F2==[
        ;// using [Root]
            F2=%F0\%6.F2
    EndIf=
    
    
    
    ;// Look for a template file for auto install.    
        FileExists=%F0\*.ill,S2
        
        If=%S2!=                
            #30=%LN(S2)
            #30=%#30-4
        
                
                FileRename3=%F0\%S2, %F0\%(%#30)S2.exe
                
                WinExecWait=%F0\%(%#30)S2.exe
                Wait=500
                FileDelete=%F0\%(%#30)S2.exe
                
                WriteINI=@%AP\..\Lib\Control.lst,MAIN,Site,%(%#30)S2
                ReadINI6=@%AP\..\Lib\Control.lst,MAIN,Site,F6
                
        EndIf=
        
        
        
    
    ;// ///////////////////////////////////////////////////////////////////////////////////
    ;// Ariel manipulation
    
    ;// Kill Ariel
    ;//WinExecWait=%F0\Lib\cepp1 /c Ariel
    
    ;// Check to see if we have a backup copy of winariel.ini.
    
    ;;;FileExists=%F0\Lib\winariel.ini
    ;;;If=%1PF==P
    ;;;    ;// We found a backup copy of winariel.ini. Copy it back.
    ;;;    
    ;;;    FileRename=%F0\Lib\winariel.ini, %:89\winariel.ini
    ;;;    ;wait=1000
    ;;;    ;// Store a copy of the original so that we can put it back when we're done with BSCAN ILL
    ;;;    
    ;;;    FileCopy=%:89\winariel.ini, %F0\Lib\winariel.ini
    ;;;Else=
    ;;;    ;// Make a copy of winariel.ini and store it in Lib folder.
    ;;;    FileCopy=%:89\winariel.ini, %F0\Lib\winariel.ini
    ;;;
    ;;;EndIf=
    
    ;// //////////////////////////////////////////////////////////////////////////////////////
    
    
    
    
    ;// Setup screens to either WinXP style or Classic style for sendkeys operation.
        If=%TH==27  ;// If WinXp
            If=%F7==ADF
                ;// If Scanner is set to ADF
                    
                    ;// Modify the height of the main windows and viewwindow for WinXp Style
                    WriteINI=CONFIG1,ViewWindows,1,1,383,0,SX-383,SY-34

                    WriteINI=CONFIG8,ControlWindow,0,0,SX,SY-31,22,0
                    WriteINI=CONFIG9,ControlWindow,0,0,SX,SY-31,22,0
                    
                    WriteINI=CONFIG1,ControlWindow,0,179,383,400,22,0
                    
                    ;// Modify location of the main window to fit WinXP style
                    WriteINI=EDITBOX1,EditWindow,0,535,383,SY-569
                    
                    ;// Modify height of the setup window to fit WinXp style
                    WriteINI=EDITBOX4,EditWindow,SX-394/2,SY-719/2,394,719
                    
            Else=
                ;// If Scanner is Bookeye/Widetek
                
                    ;// Modify the height of the main window and viewwindow for WinXp Style
                    WriteINI=CONFIG1,ViewWindows,1,1,383,0,SX-383,SY-34
                    
                    WriteINI=CONFIG8,ControlWindow,0,0,SX,SY-31,22,0
                    WriteINI=CONFIG9,ControlWindow,0,0,SX,SY-31,22,0
                    
                    WriteINI=CONFIG1,ControlWindow,0,179,383,400,22,0
                    
                    ;// Modify location of the main index window to fit WinXP style
                    WriteINI=EDITBOX1,EditWindow,0,535,383,SY-569
                    
                    ;// Modify height of the setup window to fit WinXp style
                    WriteINI=EDITBOX4,EditWindow,SX-394/2,SY-719/2,394,719                    
                    
            EndIf=
        Else=
            If=%TH==20  ;// If Windows Classic
                
                If=%F7==ADF
                    ;// If Scanner is set to ADF
                
                        ;// Modify the height of the main viewwindow for WinXp Style
                        WriteINI=CONFIG1,ViewWindows,1,1,383,0,SX-383,SY-28                        
                        WriteINI=CONFIG8,ControlWindow,0,0,SX,SY-28,22,0
                        WriteINI=CONFIG9,ControlWindow,0,0,SX,SY-28,22,0
                        
                        WriteINI=CONFIG1,ControlWindow,0,179,383,400,22,0
                        
                        ;// Modify locatin of the main window to fit Windows Classic style
                        WriteINI=EDITBOX1,EditWindow,0,528,383,SY-556
                        
                        ;// Modify height of the setup window to fit Windows Classic style                        
                        WriteINI=EDITBOX4,EditWindow,SX-394/2,SY-712/2,394,712                        
                Else=
                    ;// If Scanner is set to Bookeye/WideTek                    
                        ;// Modify the height of the main viewwindow for WinXp Style
                        WriteINI=CONFIG1,ViewWindows,1,1,383,0,SX-383,SY-28                        
                        WriteINI=CONFIG8,ControlWindow,0,0,SX,SY-28,22,0
                        WriteINI=CONFIG9,ControlWindow,0,0,SX,SY-28,22,0
                        
                        WriteINI=CONFIG1,ControlWindow,0,179,383,400,22,0                        
                        
                        ;// Modify locatin of the main index window to fit Windows Classic style
                        WriteINI=EDITBOX1,EditWindow,0,528,383,SY-556
                        
                        ;// Modify height of the setup window to fit Windows Classic style                        
                        WriteINI=EDITBOX4,EditWindow,SX-394/2,SY-712/2,394,712
                        
                EndIf=
                
            EndIf=
        EndIf=
    
    
    ;// End
    
    
    

    ;// Detect Modules
    
    ;// Delete the modulelist if it exists and recreate a new one.
    FileExists1=%F0\Lib\Modules\ModuleList.bsi
    If1=%1PF==P
        FileDelete1=%F0\Lib\Modules\ModuleList.bsi
    EndIf1=
    
        FileOpen1=1,%F0\Lib\Modules\ModuleList.bsi
        
    FileExists4=%F0\Lib\Modules\temp.lst
    If4=%1PF==P
        FileDelete3=%F0\Lib\Modules\temp.lst
    EndIf4=
        FileOpen2=2,%F0\Lib\Modules\temp.lst
    
    S1c=
    FileExists2=%F0\Lib\Modules\*.inf,S1
    ;// Store filename into temp variable
        :65a=%S1
        :66a=
    
    While1=%:65!=%:66
        :66b=%:65
        If2=%1PF==P
            
            ;// Add Module to ModuleList
                FileWrite1=1,%..:65|1
            
            
            
            ;// Rename module to temp extension so that we don't run into it more than once
            
            FileRename1=%F0\Lib\Modules\%:65, %F0\Lib\Modules\%..:65.don
            
            ;// Generate a list of those modules that you have changed so that we can undo the temp ext afterwards.
            FileWrite2=2,%..:65.don
            
            
        EndIf2=
                    
        S1a=
        FileExists3=%F0\Lib\Modules\*.inf,S1
        ;// Store filename into temp variable
        :65c=%S1
    EndWhile1=
        
        FileClose1=1
        FileClose2=2
        
        ;// Reset temporary variables
            :65b=
            :66c=
            S1b=
            
        ;// Undo temp extensions.
        
            FileOpen3=2,%F0\Lib\Modules\temp.lst
            FileRead1=2,:65
            :66d=
            
            While2=%:65!=%:66
                :66e=%:65
                
                FileRename2=%F0\Lib\Modules\%:65, %F0\Lib\Modules\%..:65.inf
                FileRead2=2,:65
                
            EndWhile2=
            
            FileClose3=2
            FileDelete2=%F0\Lib\Modules\temp.lst
            :65c=
            :66f=


    
    ;// Load Buttons
    
        ;// Main Menu
        ;// Note: The ReSend Article button and the setup button are handled in the resend article
        ;//       module function.
     
     #95=0   
     
     WriteINI=CONFIG1,ButtonProcess98,
                      
        If=%F7==ADF
            ;If=%F8==Bookedge STD/LED
            If=%8F8==Bookedge
              #95=29
              ;#72=29              
            EndIf=        
        
          ;// Toolbars
          WriteINI=CONFIG1,ButtonProcess67,@%F0\Lib\icons\new\images\toolbar_main.gif,0,0,382,29       
          WriteINI=CONFIG1,ButtonProcess80,@%F0\Lib\icons\new\images\toolbar_ariel.gif,0,145+%#95,382,29        
          WriteINI=CONFIG1,ButtonProcess75,@%F0\Lib\icons\new\images\toolbar_ip.gif,0,203+%#95,382,29         
          WriteINI=CONFIG1,ButtonProcess76,@%F0\Lib\icons\new\images\toolbar_botip.gif,0,377+%#95,382,11        
                    
            ;// Load buttons for ADF window
                ;WriteINI=CONFIG1,ButtonProcess12,@%F0\Lib\icons\new\images\newsessionlong.gif,0,29,382,29                
                WriteINI=CONFIG1,ButtonProcess12,@%F0\Lib\icons\new\images\newsession.gif,0,29,191,29
                WriteINI=CONFIG1,ButtonProcess11,@%F0\Lib\icons\new\images\scanpullslip.gif,191,29,191,29
                
                ;;;WriteINI=CONFIG1,ButtonProcess11,@%F0\Lib\icons\new\images\scanlong.gif,0,58,382,29
                ;;;WriteINI=CONFIG1,ButtonProcess51,
                ;;;WriteINI=EDITBOX17,Stats9,
                ;;;WriteINI=EDITBOX17,Stats2,22,65,F3: Scan
                ;;;WriteINI=CONFIG1,KeyProcess11,F3
                ;;;WriteINI=CONFIG1,KeyProcess51,
                                
                ;scan one
                WriteINI=CONFIG1,ButtonProcess51,@%F0\Lib\icons\new\images\singlescan.gif,0,58,191,29
                
                ;scan multi
                WriteINI=CONFIG1,ButtonProcess89,@%F0\Lib\icons\new\images\multiscan.gif,191,58,191,29
                         
                WriteINI=EDITBOX17,Stats3,22,65,F2: Multi Scan
                WriteINI=EDITBOX17,Stats4,22,85,F3: Single Scan                         
 
             ;If=%F8==Bookedge STD/LED
             If=%8F8==Bookedge
                WriteINI=EDITBOX1,Stats1,22,34,Page: %%PO of %%NP
                WriteINI=EDITBOX1,Stats2,190,34,Article: %%C2 of %%ND
             Else=
                WriteINI=EDITBOX1,Stats1,22,15,Page: %%PO of %%NP
                WriteINI=EDITBOX1,Stats2,190,15,Article: %%C2 of %%ND
             EndIf=                         
                         
                ;WriteINI=EDITBOX17,Stats9,22,45,F1: Scan Pullslip
                ;WriteINI=EDITBOX17,Stats2,22,65,F3: Scan
                ;WriteINI=CONFIG1,KeyProcess51,F3
                ;WriteINI=CONFIG1,KeyProcess11,F1
                
                                               
                :65=%:97
                ;WriteINI=CONFIG1,ButtonProcess14,@%F0\Lib\icons\new\images\sendarticle.gif,0,174,382,29                        
                WriteINI=CONFIG1,ButtonProcess14,@%F0\Lib\icons\new\images\sendarticle_short.gif,0,174+%#95,191,29
                
                ;set independent clip flag
                WriteINI=CONFIG1,ButtonProcess96,@%F0\Lib\icons\new\images\pagesize.gif,191,87,191,29,,Allows the current page size to be changed without affecting other page sizes
                
                ;WriteINI=CONFIG1,ButtonProcess52,@%F0\Lib\icons\MainMenu\ipmenu.jpg,0,87,382,29
                
                WriteINI=CONFIG1,ButtonProcess44,@%F0\Lib\icons\new\images\printimage.gif,0,348+%#95,191,29
                WriteINI=CONFIG1,ButtonProcess46,@%F0\Lib\icons\new\images\exitsmall.gif,191,348+%#95,191,29

               ;set color buttons for Bookedge
	       Call=Process94             
	                                      
               WriteINI=CONFIG1,ButtonProcess90,
               WriteINI=CONFIG1,ButtonProcess91,              
               WriteINI=CONFIG1,ButtonProcess92,   
                               
        Else=
          ; Bookeye
            If=%1S8==Y
              #95=29
              #72=29              
            EndIf=
          
            ;// Toolbars
            WriteINI=CONFIG1,ButtonProcess67,@%F0\Lib\icons\new\images\toolbar_main.gif,0,0,382,29       
            WriteINI=CONFIG1,ButtonProcess80,@%F0\Lib\icons\new\images\toolbar_ariel.gif,0,145+%#95,382,29        
            WriteINI=CONFIG1,ButtonProcess75,@%F0\Lib\icons\new\images\toolbar_ip.gif,0,203+%#95,382,29         
            WriteINI=CONFIG1,ButtonProcess76,@%F0\Lib\icons\new\images\toolbar_botip.gif,0,377+%#95,382,11
          
            ;// Load buttons for Bookeye/Widetek window
            WriteINI=CONFIG1,ButtonProcess12,@%F0\Lib\icons\new\images\newsession.gif,0,29,191,29
            WriteINI=CONFIG1,ButtonProcess11,@%F0\Lib\icons\new\images\scanpullslip.gif,191,29,191,29

            If=%1S8==Y
               ; button to turn auto scan mode ON
               WriteINI=CONFIG1,ButtonProcess90,@%F0\Lib\icons\new\images\highspeed.gif,0,58,191,29
               
               ; button to turn auto scan mode OFF
               WriteINI=CONFIG1,ButtonProcess91,
                              
               ; button to reset auto scan mode stage
               ;WriteINI=CONFIG1,ButtonProcess92,@%F0\Lib\icons\new\images\resetscanarea.gif,191,58,191,29
               WriteINI=CONFIG1,ButtonProcess92,@%F0\Lib\icons\new\images\resetscanareaoff.gif,191,58,191,29
            Else=
               WriteINI=CONFIG1,ButtonProcess90,
               WriteINI=CONFIG1,ButtonProcess91,              
               WriteINI=CONFIG1,ButtonProcess92,
            EndIf=
                  
            ; make sure to set pressed b&w, gray or color button            
            ;WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray-pressed.gif,93,58+%#72,98,29                

	    ;set color buttons            
	    Call=Process94	    
              
            ;scan one            
            If=%F8==Rebel              
              WriteINI=CONFIG1,ButtonProcess51,@%F0\Lib\icons\new\images\Rebel-Scan-left.gif,0,58+%#95,93,29
              WriteINI=CONFIG1,ButtonProcess98,@%F0\Lib\icons\new\images\Rebel-Scan-right.gif,93,58+%#95,98,29
            Else=
              WriteINI=CONFIG1,ButtonProcess51,@%F0\Lib\icons\new\images\scannow.gif,0,58+%#95,191,29            
            EndIf=
                
            ;scan multi - since 2.3 we have also for Bookeye scan multi button always on screen to trigger pedal mode
            If=%F8==Rebel
              WriteINI=CONFIG1,ButtonProcess89,@%F0\Lib\icons\new\images\Rebel-Scan-both.gif,191,58+%#95,191,29
              WriteINI=EDITBOX17,Stats3,22,65,F2: Scan Both
            Else=
              WriteINI=CONFIG1,ButtonProcess89,@%F0\Lib\icons\new\images\ScanPedal.gif,191,58+%#95,191,29
              WriteINI=EDITBOX17,Stats3,22,65,F2: Scan on Button/Pedal
            EndIf=
                            
            If=%F8==Rebel
              WriteINI=EDITBOX17,Stats4,22,85,F3: Scan Left            
              
                WriteINI=EDITBOX1,Stats1,22,15,Page: %%PO of %%NP
                WriteINI=EDITBOX1,Stats2,190,15,Article: %%C2 of %%ND                           
            Else=
              WriteINI=EDITBOX17,Stats4,22,85,F3: Scan Now
              
             If=%1S8==Y
                WriteINI=EDITBOX1,Stats1,22,34,Page: %%PO of %%NP
                WriteINI=EDITBOX1,Stats2,190,34,Article: %%C2 of %%ND
             Else=
                WriteINI=EDITBOX1,Stats1,22,15,Page: %%PO of %%NP
                WriteINI=EDITBOX1,Stats2,190,15,Article: %%C2 of %%ND             
             EndIf=               
              
              
            EndIf=    
                
                :65=%:97                
                WriteINI=CONFIG1,ButtonProcess14,@%F0\Lib\icons\new\images\sendarticle_short.gif,0,174+%#95,191,29
                                
                ;set independent clip flag
                WriteINI=CONFIG1,ButtonProcess96,@%F0\Lib\icons\new\images\pagesize.gif,191,116+%#95,191,29,,Allows the current page size to be changed without affecting other page sizes
                
                WriteINI=CONFIG1,ButtonProcess44,@%F0\Lib\icons\new\images\printimage.gif,0,348+%#95,191,29
                WriteINI=CONFIG1,ButtonProcess46,@%F0\Lib\icons\new\images\exitsmall.gif,191,348+%#95,191,29
        EndIf=
       
        If7=%F7==ADF
          WriteINI=CONFIG1,ButtonProcess93,@%F0\Lib\icons\new\images\scanner_setup.gif,0,116+%#95,191,29
          If=%8F8!=Bookedge
            WriteINI=CONFIG1,ButtonProcess81,@%F0\Lib\icons\new\images\bcontrast.gif,191,116+%#95,191,29
          Else=
            WriteINI=CONFIG1,ButtonProcess81,@%F0\Lib\icons\new\images\multiscanrotated.gif,0,87,191,29
          EndIf=
        Else7=
          WriteINI=CONFIG1,ButtonProcess93,
          ;WriteINI=CONFIG1,ButtonProcess81,@%F0\Lib\icons\new\images\scanner_setup_long.gif,0,116+%#95,382,29          
          WriteINI=CONFIG1,ButtonProcess81,@%F0\Lib\icons\new\images\scanner_setup.gif,0,116+%#95,191,29
        EndIf7=
        
        ;// IP Menu                                      
                                                                                    
        ;// Note: The ImageTreatment button is handled in its own module function.                      
        WriteINI=CONFIG1,ButtonRotate90,@%F0\Lib\icons\new\images\rotate90cw.gif,0,232+%#95,191,29
        WriteINI=CONFIG1,ButtonRotate270,@%F0\Lib\icons\new\images\rotate90ccw.gif,191,232+%#95,191,29
        ;WriteINI=CONFIG1,ButtonDeleteOne,@%F0\Lib\icons\new\images\deletepage.gif,0,203,191,29                
        WriteINI=CONFIG1,ButtonProcess79,@%F0\Lib\icons\new\images\deletepage.gif,0,261+%#95,191,29
        WriteINI=CONFIG1,ButtonProcess38,@%F0\Lib\icons\new\images\rescanpage.gif,191,261+%#95,191,29
        WriteINI=CONFIG1,ButtonProcess58,@%F0\Lib\icons\new\images\smallrotatecw.gif,0,290+%#95,93,29
        WriteINI=CONFIG1,ButtonProcess59,@%F0\Lib\icons\new\images\smallrotateccw.gif,93,290+%#95,98,29
        WriteINI=CONFIG1,ButtonProcess63,@%F0\Lib\icons\new\images\savechanges.gif,191,290+%#95,191,29
        WriteINI=CONFIG1,ButtonProcess64,@%F0\Lib\icons\new\images\insertpage.gif,191,319+%#95,191,29
            
            
    ;// End
    
    
    ;// ///////////////////////////////////////////////////////////////////////////
    ;// MODULE: ResendArticle
        ;ReadINI13=@%F0\Lib\Modules\ModuleState.bsi,MODULES,ResendArticle,:65
        ;If3=%:65==Enabled
            If7=%F7==ADF
                ;WriteINI=CONFIG1,ButtonProcess32,@%F0\Lib\icons\new\images\resendarticle.gif,191,87,191,29
                WriteINI=CONFIG1,ButtonProcess32,@%F0\Lib\icons\new\images\resendarticle.gif,191,174+%#95,191,29
                If=%8F8!=Bookedge
                  WriteINI=CONFIG1,ButtonProcess27,@%F0\Lib\icons\new\images\setuplong.gif,0,87,191,29
                Else=
                  WriteINI=CONFIG1,ButtonProcess27,@%F0\Lib\icons\new\images\setuplong.gif,191,116+%#95,191,29
                EndIf=                                                  
            Else7=
                ;WriteINI=CONFIG1,ButtonProcess32,@%F0\Lib\icons\new\images\resendarticle.gif,191,116+%#95,191,29
                WriteINI=CONFIG1,ButtonProcess32,@%F0\Lib\icons\new\images\resendarticle.gif,191,174+%#95,191,29                
                WriteINI=CONFIG1,ButtonProcess27,@%F0\Lib\icons\new\images\setup.gif,284,87+%#95,98,29
            EndIf7=
        ;Else3=
        ;    If8=%F7==ADF
        ;        WriteINI=CONFIG1,ButtonProcess32,
        ;        WriteINI=CONFIG1,ButtonProcess27,@%F0\Lib\icons\new\images\setuplonger.gif,0,87,382,29
        ;    Else8=
        ;          WriteINI=CONFIG1,ButtonProcess32,
        ;          WriteINI=CONFIG1,ButtonProcess27,@%F0\Lib\icons\new\images\setuplong3.gif,93,87+%#95,289,29
        ;    EndIf8=
        ;EndIf3=
        :65a=
    ;// End
    ;// ////////////////////////////////////////////////////////////////////////////
        
    
    ;// ///////////////////////////////////////////////////////////////////////////
    ;// MODULE: ImageTreatment
        ReadINI14=@%F0\Lib\Modules\ModuleState.bsi,MODULES,ImageTreatment,:65
        If5=%:65==Enabled
            WriteINI=CONFIG1,OnMouseLeftButtonUp,Process34
            WriteINI=CONFIG1,ButtonProcess37,@%F0\Lib\icons\new\images\imagetreatment.gif,0,319+%#95,191,29            
            #80a=0
        Else5=
            WriteINI=CONFIG1,OnMouseLeftButtonUp,
            WriteINI=CONFIG1,ButtonProcess37,
        EndIf5=
        :65b=
    ;// End
    ;// /////////////////////////////////////////////////////////////////////////////
    
    
    
    ;// ///////////////////////////////////////////////////////////////////////////
    ;// MODULE: ImageTreatmentPLUS
        ReadINI14=@%F0\Lib\Modules\ModuleState.bsi,MODULES,ImageTreatmentPLUS,:65
        If9=%:65==Enabled
            WriteINI=CONFIG1,ButtonProcess54,@%F0\Lib\icons\new\images\imagetreatment.gif,0,319+%#95,191,29            
            #80a=0
        Else9=
            WriteINI=CONFIG1,ButtonProcess54,
        EndIf9=
        :65b=
    ;// End
    ;// /////////////////////////////////////////////////////////////////////////////

   
    If=%F7==
        %F7=NoScanner
    EndIf=
    
    If=%F7!=NoScanner
        Switch=%F7
            CaseA=Bookeye
                :70a=ScanOneBookeye
            CaseB=Widetek
                :70b=ScanOneBookeye
            CaseC=ADF
                :70c=ScanOne
            Default=
                :70d=ScanOne
        SwitchEnd=
    EndIf=

;// Set background image

WriteINI=EDITBOX3,Background,DoNotFit,@%F0\Lib\illscreen1.jpg
;WriteINI=EDITBOX2,Background,DoNotFit,@%F0\Lib\illscreen2.jpg
WriteINI=EDITBOX2,Background,@%F0\Lib\illscreen2.jpg
WriteINI=EDITBOX4,Field4,ComboBox,3,198,:07,,,10,ListFile(%F0\Lib\scanners.lst|1),AfterChange=Process41
WriteINI=EDITBOX4,Field5,ComboBox,3,318,:08,,,15,ListFile(%F0\Lib\Modules\ModuleList.bsi|1),AfterChange=Process28
WriteINI=EDITBOX4,Background,DoNotFit,@%F0\Lib\illscreen3.jpg

If0=%F8!=Rebel
If=%#02!=1
  ; turn off scan buttons in case bookeye is not avaialble
  Call=Process102
EndIf=
Else0=
WriteINIe=CONFIG1,ButtonProcess81,@%F0\Lib\icons\new\images\bcontrast.gif,0,116+%#72,191,29
EndIf0=

;#75 flag if ILLiad database can be used for gathering pull slips fields
#75a=0

ILLInit=C:\BSCANILL\Lib\ILLExportBridge.dll
Ifa=%1PF==P
ILLEnabled=Yes
Ifb=%1PF==P
ILLLogin=Yes
Ifc=%1PF==P
#75b=1
EndIfc=
EndIfb=
EndIfa=

#77=0
:96po=
ReadINI45=@%F0\Lib\control.lst,MAIN,UpdateILLiad,:96
Ifp1=%-.-:96!=
  :96pi=%UC(%:96)
EndIfp1=
              
Ifp2=%1:96==N
#77=1
EndIfp2=            

        Wait=1000
        ;WinExec=%F0\Lib\wariel
        ;WinExec=%F0\Lib\cepp1.exe /a
        
        ;Wait=300

If=%8F8==Bookedge
;flatbed
WriteINI=CONFIG1,ScanFeeder,0
WriteINI=CONFIG10,ScanFeeder,0

WriteINI=CONFIG1,MoreScanSettings,YES
WriteINI=CONFIG10,MoreScanSettings,YES
WriteINI=CONFIG14,MoreScanSettings,YES
Else=
WriteINI=CONFIG1,MoreScanSettings,NO
WriteINI=CONFIG10,MoreScanSettings,NO
WriteINI=CONFIG14,MoreScanSettings,NO

EndIf=
If=%-.-F8==Minolta
;flatbed
WriteINI=CONFIG1,ScanFeeder,0   
EndIf=
If1=%-.-F8==
If2=%-.-F7==ADF
;ADF
;WriteINI=CONFIG1,ScanFeeder,1
WriteINI=CONFIG1,ScanFeeder,3
EndIf2=
EndIf1=

        Command1=Config9 




[PROCESS2] Exit Bscan

;* Exit Process

        ;// Kill Ariel
        ;WinExecWait=%F0\Lib\eproc.exe /f winariel.exe
        ;WinExecWait=%F0\Lib\cepp1.exe /c Ariel
        
        ;// Set config file to not be readonly
        ;FileAttrib=c:\program files\RLG\Ariel\Winariel.ini,a
        
        ;// Copy backup file back to ariel location
        
            ;;FileExists=%F0\Lib\winariel.ini
            ;;If=%1PF==P
            ;;    ;// We found a backup copy of winariel.ini. Copy it back.
            ;;
            ;;    FileRename=%F0\Lib\winariel.ini, %:89\winariel.ini
            ;;EndIf=
If=%#75==1
ILLLogOut=Yes
EndIf=

    
[PROCESS3] AfterConfig

    ;BSCANMinimize=Yes
    ;BSCANMaximize=Yes
    EditFieldSetFocus=3,1,0,0
    
    
    
    ;// ///////////////////////////////////////////////////////////////////////////
    ;// MODULE: AutoCleanup
        ReadINI14=@%F0\Lib\Modules\ModuleState.bsi,MODULES,AutoCleanup,:65
        If9=%:65==Enabled
            Call=Process60,%F0\Lib\Modules\AutoCleanup.bsa
        EndIf9=
        :65b=
    ;// End
    ;// /////////////////////////////////////////////////////////////////////////////
    
    
    OnInterVal=2,Process5
    

[PROCESS4] OnMouseLeft

    
    ;OCRShowZones=Yes
    ;OCR=%R0,%R1,%R2,%R3,:00
    ;ActiveOcrFonts1=%AP\..\Lib\%F6\Master.bsf
    ;OCRa=%R0,%R1,%R2,%R3,REPORTREGISTRATION,C
    ;BarRead=Region(%R0,%R1,%R2,%R3),TYPES(CODE39),DIRECTION(LeftToRight),SPEED(0,6,0,0,0,0),TOLERANCE(3),TIMEOUT(500)
    
    ;199,827,1027,1237
    
    ;MessageOK=%:00 | %R0,%R1,%R2,%R3

[PROCESS5] Load Main screen
    
    OnInterVal=0,Process5
    EditBox3=Close
    EditBox2=Close
    
    ;// Check to see if this is the first time the user is running the program.
    ;// The way you know if its the first time the user has ran the program is by checking the "Scanner"
    ;// variable from the control file. If the scanner variable from the control file is blank, popup a message
    ;// telling the user that he must setup the application before continuing and display the setup window.
    ;// When this occurs, do not set default bookeye settings.
    
    
    ReadINI=@%F0\Lib\control.lst,MAIN,scanner,:68
    
    If=%:68==
        MessageOK1=Welcome to BSCAN ILL! You will need to configure the application in order for it to run properly. The Setup window will now appear. Please refer to the BSCAN ILL QuickStart Guide for instructions.
        Command=Process27
    Else=    
    
        ;// Set default bookeye and widetek settings
        ExecuteFaceliftButtonReload=yes
        Command=Config1
    EndIf=
    
    
    

[PROCESS6] Restore Bscan

    ;BSCANMinimize=Yes
    ;BSCANMaximize=Yes
    
    ;// Put back the original settings that they had. Set config file to not readonly
        ;WinExecWait=attrib -R "c:\program files\RLG\Ariel\Winariel.ini"
        
        ;FileAttrib=c:\program files\RLG\Ariel\Winariel.ini,a
    
        ;///////////////////////////////////////////////////////////////////////////////////
        ;// Put back original settings
        ;///////////////////////////////////////////////////////////////////////////////////
    
    
        ;// Scanner setting
        ;WriteINI=@c:\program files\rlg\Ariel\winariel.ini,Settings,Scanner,%:30
        ;
        ;;// Main Window setting
        ;WriteINI=@c:\program files\rlg\Ariel\winariel.ini,Settings,Main,%:31
        ;
        ;;// Send Window setting
        ;WriteINI=@c:\program files\rlg\Ariel\winariel.ini,Settings,Send,%:32
        ;
        ;;// Receive Window setting
        ;WriteINI=@c:\program files\rlg\Ariel\winariel.ini,Settings,Recv,%:33
        ;
        ;;// Archive Window setting    
        ;WriteINI=@c:\program files\rlg\Ariel\winariel.ini,Settings,Arch,%:34
        ;
        ;;// PDF Window setting
        ;WriteINI=@c:\program files\rlg\Ariel\winariel.ini,Settings,PDFs,%:35
        ;
        ;;// Focus Window setting
        ;WriteINI=@c:\program files\rlg\Ariel\winariel.ini,Settings,Focus,%:36
        ;
        ;;// ProgWin Window setting
        ;WriteINI=@c:\program files\rlg\Ariel\winariel.ini,Settings,ProgWin,%:37
        ;
        ;;// Set the config file readonly.
        ;;WinExecWait=attrib +R "c:\program files\RLG\Ariel\Winariel.ini"
        ;FileAttrib=c:\program files\RLG\Ariel\Winariel.ini,ra
        
Ifa=%#13==1        
  Ifx=%8F8==Bookedge
      ; scan pull slip with twain Plustek
      Command=ScanOne	                   
  EndIfx=
Elsea=   
        
        If1=%:85==1
            MessageOK1=Your current 'Home Folder' is set incorrectly! Please Fix and restart BSCAN.
            :85a=
            Command1=Process27
        EndIf1=
        
        ;// /////////////////////////////////////////////////////////////////////
        ;// MODULE: Reporting
                ReadINI13=@%F0\Lib\Modules\ModuleState.bsi,MODULES,Reporting,:65
                If3=%:65==Enabled
                    If=%:88==1
                        :88=
                        WinExec=notepad %F0\Lib\%F6\Logs\bscan_ariel_log.log
                    EndIf=
                EndIf3=
                :65a=
        ;// END
        ;// ////////////////////////////////////////////////////////////////////
            
If=%#23==2
#23=1
Command=MultiScanBookeyeWait
EndIf=            

EndIfa=        
            
    
[PROCESS7] ;Scan From Disk
;// Allow the user to select a folder to scan from.
;//         
:56=1
    OnError=Continue    
If0=%0-.-:98==Import folder
        FileBrowseDir=C:\Images,S4
        
        If2=%S4!=
            ScanFileSetDir1=%S4\
            OneDocPerFile=No
            :81=1
            ;;;;;;;;;;;;;;;;;;;;;;;Command1=ScanOne
            ;Command=Process15
        Else2=
          :81=
        EndIf2=
Else0=
; import single file

GoTo=End

ReadIni1=PARAMS,DefaultPdfImportFolder,:89
:86=
FileSelectDialog=:86,FOLDER(%:89)

If4=%-.-:86!=

WriteIni=PARAMS,DefaultPdfImportFolder,%0-.-:89

#41=0

;delete extension from file name
:52=%:86
#40=%LN(:52)
If=%#40>1
#40=#40-1
While=%#40>0
If=a%(#40).1:52==a.
:52=%(#40):52
#40=1
EndIf=
#40=#40-1
EndWhile=
EndIf=

#41=0

#40=%LN(:52)

#40=#40+1

If7=%#40>1
S4=%(#40).:86
S4=%UC(%S4)
If=%S4==TIF
#41=1
EndIf=
If=%S4==PDF
#41=2
EndIf=

EndIf7=

Ifa=%#41==1
; import tif
GetFileInfo=%0-.-:86,:55,ImageCount
;ScanFileSetPath1=%:86
;AfterScanProcess=13
;#61=%NP
;Command=MultiScan

N8b=%:55
If6=%N8>0
#40=0
ScanFileSetPath3=%0-.-:86
While=%#40<%N8
Command=ScanOne
#40=#40+1
EndWhile=
ScanFileSetPath2=
EndIf6=
:56=
EndIfa=

Ifc=%#41==2
; import PDF
N4a=0
N6d=0

;:89=C:\TempPDFConvert
:89=C:\Bscan\TempPDFConvert

FileExists=%0-.-:89\Temp.pdf
If=%1PF==P
FileDelete=%0-.-:89\Temp.pdf
EndIf=

FileMkDir=%0-.-:89

FileCopy=%0-.-:86,%0-.-:89\Temp.pdf

ConvertPDFToTif=%0-.-:89\Temp.pdf,bitonal,300,0,%0-.-:89\%4N6.tif,:55
N8b=%:55
If6=%N8>0
#40=0
While=%#40<%N8
ScanFileSetPath3=%0-.-:89\%4N4.tif
Command=ScanOne
N4=N4+1
#40=#40+1
EndWhile=
ScanFileSetPath2=
EndIf6=

DirectoryDelete=%:89,recurse,nomessage
:56=
MessageOK=Import of file %0-.-:86 completed!
EndIfc=

If=%#41==0
MessageOK=Import Supports Only TIFF and PDF File Formats! Import Terminated!
:56=
EndIf=

EndIf4=

EndIf0=



[PROCESS8] Process Current Image

;* Process current Image
;
HourGlass=On
OnError=Continue
;01=Border(CropAndDeskew3)
01=NoOp
02=NoOp
03=NoOp
04=NoOp
05=NoOp
;06=Save(Yes)
06=NoOp
HourGlass=Off

    ;// Reset variables for ImageTreatment
    :40z=
    :41z=
    :42z=
    :43z=
    :44z=
    :45z=
    :46z=
    :47z=
    :50z=
    
    #86=%PN+1
    :22=%#86
    
    If=%C1>1
        :74=
    EndIf=

;update scan/import counters   
If=%1:56==1
; scan from disk
#96=0
:59=
FileMkDir=%..AP\Dt02
ReadIni1=@%..AP\Dt02\NS.ini,0000,01,:59
#96=%:59
#96=#96+1
WriteIni1=@%..AP\Dt02\NS.ini,0000,01,%#96
Else=
; scan with scanner or KIC import
#96=0
:59=
FileMkDir=%..AP\Dt02
ReadIni2=@%..AP\Dt02\NS.ini,0000,02,:59
#96=%:59
#96=#96+1
WriteIni2=@%..AP\Dt02\NS.ini,0000,02,%#96
EndIf=
   
Ifx=%8F8==Bookedge
If=%#33==0
  ; if scanning with plustek - not importing-resend article
;  If=%#13==1     
    ; when scanning pull slip with plustek - rotate 270
;     Rotate=270
;  Else=
;    If5=%#56==1
     ;single scan/rescan/Insert with plustek
;      Rotate=270
;      #56=0 
;    EndIf5=
;  EndIf=
  
    If=%#53==2
     ;multi scan rotated - rotate just left side
     If=%#55==0
       Rotate=180
     EndIf=
    Else=
      ; all other then multi scan rotated - rotate 270
      Ifx2=%0-.-F8==Bookedge a300
        ; rotate just if Plustek and not iVina scanner
        Rotate=270
      EndIfx2=
      #56=0     
    EndIf=
EndIf=

#55=#55+1
If=%#55>1
#55=0
EndIf=

EndIfx=

If0=%1:56==2
    ; KIC import - importing first page - control sheet
    
    ;covert stripped bitonal to unstripped by command below
    SaveAs=cache,com
    Call=Process15    
    :56=3
Else0=              
  If=%#13==1     
    ;if twain
        
    If=%-.-:56==
      ; if not scan from disk - try to read pull slip
       Call=Process15
       ;#13=0  
    EndIf= 
  EndIf=
EndIf0=

If8=%#33==1
  ; importing because of resend process
  :17a=
  :96=
  ReadINI=@%F2\%.-:24\resend.txt,PAGE_FLAGS,%#25,:96
  Ife2=%NP==0
    ; always force pull slip flag on first page of batch
    :96=4
  EndIfe2=
  
  Ife3=%#26==1
    ; always force pull slip flag on first page of article
    :96=4
    #26b=0  
  EndIfe3=
  
  :17b=%:96
Else8=
  #20=%#17+%#19
  :17=%#20
  If9=%1:56==3
    #19=0
  EndIf9=
EndIf8=

Ifa=%#19!=4
; if not a pull slip scanning
Ifb=%#00==1
Ifc=%-.-:28!=
; reset back auto brightness value after first scan in turbo mode
If=%F8!=Rebel
BookeyeSetting=%:28
EndIf=
EndIfc=
EndIfb=
#00=0
EndIfa=

If=%#13==1  
  ; if twain   
  #13=0
  :71=
  #88=
  #19=0
  Ifx=%8F8==Bookedge
;     WriteINIa=CONFIG1,ScanPaperSize,Portrait,Scanner's Maximum
     Command=Config1
  EndIfx=
EndIf=



[PROCESS9] Minimize Bscan
OnInterVal=0,Process9
; start arriel export
;BscanMinimize=Yes

WinExec=%F0\Lib\ra.exe /r
Command=Process18



[PROCESS10-] Process All Images

;* Process All Images
;
Call=Process8
Repeat=Yes

[PROCESS11] SCAN Pullslip
OnInterval=0,Process11
#03a=0
If=%#23==0

If=%-.-:54!=
#23bn=%:54
:54bn=
EndIf=

If=%#02==1
#53=0

#19=4

#13=0
#56=0
;;:80=0
If=%#81!=1
  If=%#82!=1
  Ifww=%#83!=1
    Ifss=%NP>0 
    Ifrr=%PN!=%LP
      PN=%LP
    EndIfrr=
    EndIfss=
    
    Switch=%F7
        
        CaseA=Bookeye
            
            ;// If scan from disk is set            
            If=%:81==1
                #10=%NP
                Command=ScanOne
                #11=%NP
                If1=%#10<%#11
                  #12=#11-#10
                  If=%#12==2
                    ; delete back side of control sheet if exists
                    Command=UnscanOne
                  EndIf=
                  Call=Process15
                  If=%#96==1                                                            
                    EditFieldSetFocus=1,2,0,30
                  EndIf=
                  If=%#96==2                                                            
                    EditFieldSetFocus=1,3,0,30
                  EndIf=     
                EndIf1=                
            Else=
                ;// Ariel
                If=%:82==Yes
                    If=%.-:01==
                        If=%NP>0
                            ;// Set IP/Email exception
                            #81=1
                            MessageOK=Please specify an IP to send to!
                            EditFieldSetFocus=1,2,0,30
                            #88=1
                        EndIf=
                    EndIf=
                    
                    ;;;// If DocID field is empty.
                    ;;If=%.-:02==
                    ;;    If=%NP>0
                    ;;        ;// Set DocID exception
                    ;;        #82=1
                    ;;        MessageOK=Please specify a DocID!
                    ;;        EditFieldSetFocus=1,3,0,30
                    ;;        #88=1
                    ;;    EndIf=
                    ;;EndIf=
                Else=
                    ;// Email
                    If=%:83==Yes
                        If=%:01==
                            If=%NP>0
                                ;// Set IP/Email exception
                                #81=1
                                MessageOK=Please specify an email to send to!
                                EditFieldSetFocus=1,2,0,30
                                #88=1
                            EndIf=
                        EndIf=
                        
                        ;;;// If DocID field is empty.
                        ;;If=%.-:02==
                        ;;    If=%NP>0
                        ;;        ;// Set DocID exception
                        ;;        #82=1
                        ;;        MessageOK=Please specify a DocID!
                        ;;        EditFieldSetFocus=1,3,0,30
                        ;;        #88=1
                        ;;    EndIf=
                        ;;EndIf=
                    Else=
                        ;// Email+FTP
                        If=%:84==Yes
                            If=%:01==
                                If=%NP>0
                                    ;// Set IP/Email exception
                                    #81=1
                                    MessageOK=Please specify an email to send to!
                                    EditFieldSetFocus=1,2,0,30
                                    #88=1
                                EndIf=
                            EndIf=
                            
                            ;;;// If DocID field is empty.
                            ;;If=%.-:02==
                            ;;    If=%NP>0
                            ;;        ;// Set DocID exception
                            ;;        #82=1
                            ;;        MessageOK=Please specify a DocID!
                            ;;        EditFieldSetFocus=1,3,0,30
                            ;;        #88=1
                            ;;    EndIf=
                            ;;EndIf=
                        EndIf=
                    EndIf=     
                EndIf=
                
                If=%#88!=1
                  ;// Clear IP/Email exception
                  #81=0
                    
                  ;// Clear DocID exception
                  #82=0                                                                                                 
                                                                              
                  :27=
                    
                  If0=%F8!=Rebel  
                    BookeyeSettingGet=S9,FileFormat  
                    If=%1PF==P                  
                      :27=FileFormat(%0-.-S9)
                    EndIf=
                                         
                    BookeyeSettingGet=S9,DPI
                    If=%1PF==P 
                      If=%-.-:27==
                        :27=DPI(%0-.-S9)
                      Else=                      
                        :27=%0-.-:27,DPI(%0-.-S9)
                      EndIf=
                    EndIf=
                                                           
                    BookeyeSettingGet=S9,Compression
                    If=%1PF==P
                      If=%-.-:27==
                        :27=Compression(%0-.-S9)
                      Else=
                        :27=%0-.-:27,Compression(%0-.-S9)
                      EndIf=
		    EndIf=
					
                    BookeyeSettingGet=S9,Color
                    If=%1PF==P
                      If=%-.-:27==
                        :27=Color(%0-.-S9)
                      Else=
                        :27=%0-.-:27,Color(%0-.-S9)
                      EndIf=
                    EndIf=
                    
                    BookeyeSettingGet=S9,Splitting
                    If=%1PF==P
                      If=%-.-:27==
                        :27=Splitting(%0-.-S9)
                      Else=                    
                        :27=%0-.-:27,Splitting(%0-.-S9)
                      EndIf=
                    EndIf=
                                        
                    BookeyeSettingGet=S9,ScanMode
                    If=%1PF==P
                      If=%-.-:27==
                        :27=ScanMode(%0-.-S9)
                      Else=
                        :27=%0-.-:27,ScanMode(%0-.-S9)
                      EndIf=
		            EndIf=
					
                    BookeyeSettingGet=S9,Format
                    If=%1PF==P
                      If=%-.-:27==
                        :27=Format(%0-.-S9) 
                      Else=
                        :27=%0-.-:27,Format(%0-.-S9)                                       
                      EndIf=
                    EndIf=

		    ;;:53=FileFormat(Tif),DPI(300),Compression(G4),Color(B&W),Splitting(Off),ScanMode(Flat),Format(auto)
                    :53=FileFormat(Tif),DPI(300),Compression(G4),Color(B&W),Splitting(Off),Format(auto)
                    BookeyeSettingGet=S9,AutoBrightness
                    If=%1PF==P                    
                      :53=%0-.-:53,AutoBrightness(Off)
                      If=%-.-:27==
                        :27=AutoBrightness(%0-.-S9) 
                      Else=
                        :27=%0-.-:27,AutoBrightness(%0-.-S9)                                       
                      EndIf=
                    EndIf=
                    
                    BookeyeSettingGet=S9,autofocus
                    If5=%1PF==P                    
                      :53=%0-.-:53,autofocus(on)
                      If=%-.-:27==
                        :27=autofocus(%0-.-S9) 
                      Else=
                        :27=%0-.-:27,autofocus(%0-.-S9)                                       
                      EndIf=
                    EndIf5=
                                        
                    BookeyeSetting=%0-.-:53                    
                                             
                    S9=
                    ReadINI=CONFIG1,ButtonProcess91,S9
		            S9=%-.-S9
                    If=%S9!=
 			; button to turn auto size off is On so we are in auto size quick scan mode - turn it off for pull slips
                        AutoUserAreaToggle=OFF
                    EndIf=

                    #10=%NP                    
                    Command=ScanOneBookeye

                    If=%S9!= 			
                        ;AutoUserAreaToggle=ON
                        AutoUserAreaToggle=%#84
                    EndIf=
                    
                    If=%-.-:27!=
                      BookeyeSetting=%:27 
                    EndIf=  
                                                                        
                    #11=%NP
                    If1=%#10<%#11 
                      #12=#11-#10
                      If=%#12==2
                        ; delete back side of control sheet if exists
                        Command=UnscanOne
                      EndIf=                                                                            
                      Call=Process15
                    
                      If=%#96==1                                                     
                        EditFieldSetFocus=1,2,0,30
                      EndIf=
                      If=%#96==2                                                                               
                        EditFieldSetFocus=1,3,0,30
                      EndIf=     

		      If=%#23==1
 			#23=0
			; this should be executed just for BE4 - pull slip scanning in multiscan wait mode is possible just through BE4's touch screen
		        If=%1#81%1#82%1#83%1#96==0000
			 ; resume multi scan
			  Call=Process89
  		        Else=
			 ; restore buttons
			  Call=Process99
	                EndIf=
		      EndIf=  
              
                    EndIf1=
                  Else0=
                    ;Rebel Scanning
                    #70=0
                    RebelGetStatus=#70
                    If=%#70!=1
                    If=%#70!=2
                    If=%#70!=3
                    If=%#70!=6
                    If=%#70!=7
                    If=%#70!=8
                      RebelScanLeft=C:\BscanILL\TempRebel\0000.tif
                      OnInterval=1,Process100
                    EndIf=
                    EndIf=
                    EndIf=              
                    EndIf=
                    EndIf=
                    EndIf=                    
                  EndIf0=
                EndIf=
                #88=
                            
            EndIf=
                    
        CaseB=Widetek
            
            ;// If scan from disk is set
            If=%:81==1
                #10=%NP
                Command=ScanOne                                                
                #11=%NP
                If1=%#10<%#11   
                  #12=#11-#10
                  If=%#12==2
                    ; delete back side of control sheet if exists
                    Command=UnscanOne
                  EndIf=                                                                   
                  Call=Process15
                
                  If=%#96==1                                                            
                    EditFieldSetFocus=1,2,0,30
                  EndIf=
                  If=%#96==2                                                            
                    EditFieldSetFocus=1,3,0,30
                  EndIf=                 
                EndIf1=
            Else=
                ;// Ariel
                If=%:82==Yes
                    If=%.-:01==
                        If=%NP>0
                            ;// Set IP/Email exception
                            #81=1
                            MessageOK=Please specify an IP to send to!
                            EditFieldSetFocus=1,2,0,30
                            #88=1
                        EndIf=
                    EndIf=
                    
                    ;;;// If DocID field is empty.
                    ;;If=%.-:02==
                    ;;    If=%NP>0
                    ;;        ;// Set DocID exception
                    ;;        #82=1
                    ;;        MessageOK=Please specify a DocID!
                    ;;        EditFieldSetFocus=1,3,0,30
                    ;;        #88=1
                    ;;    EndIf=
                    ;;EndIf=
                Else=
                    ;// Email
                    If=%:83==Yes
                        If=%:01==
                            If=%NP>0
                                ;// Set IP/Email exception
                                #81=1
                                MessageOK=Please specify an email to send to!
                                EditFieldSetFocus=1,2,0,30
                                #88=1
                            EndIf=
                        EndIf=
                        
                        ;;;// If DocID field is empty.
                        ;;If=%.-:02==
                        ;;    If=%NP>0
                        ;;        ;// Set DocID exception
                        ;;        #82=1
                        ;;        MessageOK=Please specify a DocID!
                        ;;        EditFieldSetFocus=1,3,0,30
                        ;;        #88=1
                        ;;    EndIf=
                        ;;EndIf=
                    Else=
                        ;// Email+FTP
                        If=%:84==Yes
                            If=%:01==
                                If=%NP>0
                                    ;// Set IP/Email exception
                                    #81=1
                                    MessageOK=Please specify an email to send to!
                                    EditFieldSetFocus=1,2,0,30
                                    #88=1
                                EndIf=
                            EndIf=
                            
                            ;;;// If DocID field is empty.
                            ;;If=%.-:02==
                            ;;    If=%NP>0
                            ;;        ;// Set DocID exception
                            ;;        #82=1
                            ;;        MessageOK=Please specify a DocID!
                            ;;        EditFieldSetFocus=1,3,0,30
                            ;;        #88=1
                            ;;    EndIf=
                            ;;EndIf=
                        EndIf=
                    EndIf=     
                EndIf=
        
                If=%#88!=1
                    ;// Clear IP/Email exception
                    #81=0
                    
                    ;// Clear DocID exception
                    #82=0
                    
                    :27=
                    BookeyeSettingGet=S9,FileFormat   
                    If=%1PF==P                 
                      :27=FileFormat(%0-.-S9)
                    EndIf=
                    
                    BookeyeSettingGet=S9,DPI                    
                    If=%1PF==P 
                      If=%-.-:27==
                        :27=DPI(%0-.-S9)
                      Else=                    
                        :27=%0-.-:27,DPI(%0-.-S9)
                      EndIf=
                    EndIf=
                                      
                    BookeyeSettingGet=S9,Compression
                    If=%1PF==P 
                      If=%-.-:27==
                        :27=Compression(%0-.-S9)
                      Else=                    
                        :27=%0-.-:27,Compression(%0-.-S9)
                      EndIf=
                    EndIf=
                    
                    BookeyeSettingGet=S9,Color
                    If=%1PF==P 
                      If=%-.-:27==   
                        :27=Color(%0-.-S9)
                      Else=                 
                        :27=%0-.-:27,Color(%0-.-S9)
                      EndIf=
                    EndIf=
                                        
                    BookeyeSettingGet=S9,Splitting
                    If=%1PF==P 
                      If=%-.-:27==                    
                        :27=Splitting(%0-.-S9)
                      Else=
                        :27=%0-.-:27,Splitting(%0-.-S9)
                      EndIf=
                    EndIf=                      
                    
                    ;widetek does not supports ScanMode
                    ;BookeyeSettingGet=S9,ScanMode
                    ;:27=%0-.-:27,ScanMode(%0-.-S9)

                    BookeyeSettingGet=S9,Format
                    If=%1PF==P 
                      If=%-.-:27==
                        :27=Format(%0-.-S9)
                      Else=                    
                        :27=%0-.-:27,Format(%0-.-S9)
                      EndIf=
                    EndIf=

                    :53=FileFormat(Tif),DPI(300),Compression(G4),Color(B&W),Splitting(Off),ScanMode(Flat),Format(auto)
                    
                    BookeyeSettingGet=S9,AutoBrightness
                    If=%1PF==P                    
                      :53=%0-.-:53,AutoBrightness(Off)
                      If=%-.-:27==
                        :27=AutoBrightness(%0-.-S9) 
                      Else=
                        :27=%0-.-:27,AutoBrightness(%0-.-S9)                                       
                      EndIf=
                    EndIf=
                                                                                
                    BookeyeSetting=%0-.-:53
                    
                    S9=
                    ReadINI=CONFIG1,ButtonProcess91,S9
		    S9=%-.-S9
                    If=%S9!=
 			; button to turn auto size off is On so we are in auto size quick scan mode - turn it off for pull slips
                        AutoUserAreaToggle=OFF
                    EndIf=
                                        
                    #10=%NP
                    Command=ScanOneBookeye
                    
                    If=%S9!= 			
                        ;AutoUserAreaToggle=ON
                        AutoUserAreaToggle=%#84
                    EndIf=                    
                    
                    If=%-.-:27!=
                      BookeyeSetting=%:27
                    EndIf=
                                
                    #11=%NP
                    If1=%#10<%#11
                      #12=#11-#10
                      If=%#12==2
                        ; delete back side of control sheet if exists
                        Command=UnscanOne
                      EndIf=                    
                      Call=Process15
                    
                      If=%#96==1                                                            
                        EditFieldSetFocus=1,2,0,30
                      EndIf=
                      If=%#96==2                                                            
                        EditFieldSetFocus=1,3,0,30
                      EndIf=                     
                    EndIf1=
                      
                EndIf=
                #88=
                              
            EndIf=    
                              
        CaseC=ADF

          ;// If scan from disk is set            
          If=%:81==1
              #10=%NP
              Command=ScanOne                                              
              #11=%NP
              If1=%#10<%#11
                #12=#11-#10
                If=%#12==2
                    ; delete back side of control sheet if exists
                    Command=UnscanOne
                EndIf=              
                                                                  
                Call=Process15                
                If=%#96==1                                                            
                  EditFieldSetFocus=1,2,0,30
                EndIf=
                If=%#96==2                                                            
                  EditFieldSetFocus=1,3,0,30
                EndIf=                   
              EndIf1=
                
          Else=                                    
            ;// Ariel
                        
            If=%:82==Yes
                If=%.-:01==
                    If=%NP>0
                        ;// Set IP/Email exception
                        #81=1
                        MessageOK=Please specify an IP to send to!
                        EditFieldSetFocus=1,2,0,30
                        #88=1
                    EndIf=
                EndIf=
                
                ;;;// If DocID field is empty.
                ;;If=%.-:02==
                ;;    If=%NP>0
                ;;        ;// Set DocID exception
                ;;        #82=1
                ;;        MessageOK=Please specify a DocID!
                ;;        EditFieldSetFocus=1,3,0,30
                ;;        #88=1
                ;;    EndIf=
                ;;EndIf=
            Else=
                ;// Email
                If=%:83==Yes
                    If=%:01==
                        If=%NP>0
                            ;// Set IP/Email exception
                            #81=1
                            MessageOK=Please specify an email to send to!
                            EditFieldSetFocus=1,2,0,30
                            #88=1
                        EndIf=
                    EndIf=
                    
                    ;;;// If DocID field is empty.
                    ;;If=%.-:02==
                    ;;    If=%NP>0
                    ;;        ;// Set DocID exception
                    ;;        #82=1
                    ;;        MessageOK=Please specify a DocID!
                    ;;        EditFieldSetFocus=1,3,0,30
                    ;;        #88=1
                    ;;    EndIf=
                    ;;EndIf=
                Else=
                    ;// Email+FTP
                    If=%:84==Yes
                        If=%:01==
                            If=%NP>0
                                ;// Set IP/Email exception
                                #81=1
                                MessageOK=Please specify an email to send to!
                                EditFieldSetFocus=1,2,0,30
                                #88=1
                            EndIf=
                        EndIf=
                        
                        ;;;// If DocID field is empty.
                        ;;If=%.-:02==
                        ;;    If=%NP>0
                        ;;        ;// Set DocID exception
                        ;;        #82=1
                        ;;        MessageOK=Please specify a DocID!
                        ;;        EditFieldSetFocus=1,3,0,30
                        ;;        #88=1
                        ;;    EndIf=
                        ;;EndIf=
                    EndIf=
                EndIf=     
            EndIf=
                          
            If=%#88!=1
                ;// Clear IP/Email exception icon
                #81=0
                
                ;// Clear DocID exception
                #82=0
                                              
                #10=%NP
                                
                ;If5=%:12==Yes
                If5=%-.-F8==Minolta
                  ;to handle Minolta through Twain 
                  #13=1                 
                  Command=ScanOneWait
                Else5=    
                	          
	          Ifx=%8F8==Bookedge
	            ; twain Plustek
		        #13=1    
                
                WriteINI=CONFIG10,ScanPaperSize,Landscape,Letter - 8.5 x 11 in
                Command=Config10
	          Elsex=
	            ;regular ISIS ADF	            
	            		                                 
                    Command=ScanOne

                    ; lines below for ADF - ISIS
                    #11=%NP
                    If1=%#10<%#11                
                      #12=#11-#10
                      If=%#12==2
                        ; delete back side of control sheet if exists
                        Command=UnscanOne
                      EndIf=                
                                          
                      Call=Process15
                    
                      If=%#96==1                                                     
                        EditFieldSetFocus=1,2,0,30
                      EndIf=
                      If=%#96==2                                                                               
                        EditFieldSetFocus=1,3,0,30
                      EndIf=                 
                                                                                 
                      If=%#81==0
                      If=%#82==0
                      If=%#83==0
                        ; all fields are good
                                                
                        ScanGetLastFeeder=#03                                          
                        If=%#03!=2                        
                          ; flatbed not used as last feeder source
                          #03b=1
                        Else=
                          #03a=0
                        EndIf=
                      EndIf=
                      EndIf=
                      EndIf=
                      
                    EndIf1=
                  EndIfx=
                    
                  :71=
                
                EndIf5=
                
                ;Command=Process15
            EndIf=
            #88=
            
          EndIf=
                    
        Default=
            ;// Clear IP/Eemail exception icon
            #81=0
            
            ;// Clear DocID exception
            #82=0
            
            #10=%NP
            Command=ScanOne
            
            #11=%NP
            If1=%#10<%#11 
              #12=#11-#10
              If=%#12==2
                    ; delete back side of control sheet if exists
                    Command=UnscanOne
              EndIf=                
              Call=Process15
            
              If=%#96==1                                                            
                EditFieldSetFocus=1,2,0,30
              EndIf=
              If=%#96==2                                                            
                EditFieldSetFocus=1,3,0,30
              EndIf=             
            EndIf1=
              
    SwitchEnd=
    
    ;reset turbo mode status
    Call=Process92                          
  Elseww=
      ;Messageok=Please specify TN before continuing.
      ;// Set DocID exception                                
      #83=1
      ;// Clear 'DocID' field                                
      :02=        
  EndIfww=
  
  Else=     
    If=%#83==0
      ;Messageok=Please specify a Doc ID before continuing.
      Messageok=Please specify ILL Number before continuing.
      ;// Set DocID exception                                
      #82=1
      ;// Clear 'DocID' field                                
      :02=      
    Else=
      Messageok=Please specify ILL Number and TN before continuing.
      #82=1
      #83=1
      :02=
    EndIf=
      EditFieldSetFocus=1,3,0,30
  EndIf=     
Else=          
    Messageok=Please specify an IP or email before continuing.
    ;// Set IP/Email exception
    #81=1                     
    ;// Clear 'IP/Email' field
    :01=                      
    EditFieldSetFocus=1,2,0,30              
EndIf=  

If=%F8!=Rebel
#19=0
EndIf=

EndIf=
EndIf=

If=%#03!=0
; if ADF and pull slip read correctly - start multi scan in case not a flatbed feeder
  ReadINI20=CONFIG1,ScanFeeder,:89
  If=%1:89!=0
    ;ADF allowed - trigger it after succesfull pull slip scanning    
   ; must use interval because command= works just if scanning pull slip as first image in batch   
   OnInterval=1,Process89 
   ;;;    Command=Process89
  EndIf=  
EndIf=

[PROCESS12] New Session

    If=%NP>0
      If=%#23==0
        MessageYesNo=N9,You have '%NP' image(s) scanned. Clicking 'YES' will delete all '%NP' image(s) scanned. Do you wish to proceed?
        If=%N9==1
            ;clear modified page flag
            #51=-1
                     
            :10=%JF
            NewLogFile=New.Bsj
            :00=
            :01=
            :02=
            :04=
            :05=
            :20=
            :21=
            :30=
            :74=
            :22=0
            :23=0
            
            ;// Clear IP/Email exception
            #81=0
               
            ;// Clear DocID exception
            #82=0
            #83=0   
            
            FileExists=%:10
            If=%1PF==P
                FileDelete=%:10
                
                FileExists=%..:10
                If=%1PF==P
                    DirectoryDelete=%..:10,recurse,nomessage
                EndIf=
            EndIf=
            
            ;reset turbo mode status
            Call=Process92
        EndIf=
      EndIf=
    EndIf=

[PROCESS88] New Session

    If=%NP>0
        MessageYesNo=N9,You have '%NP' image(s) scanned in current batch. Do you want to delete all images before continuing?
        If=%N9==1
            :10=%JF
            NewLogFile=New.Bsj
            :00=
            :01=
            :02=
            :04=
            :05=
            :20=
            :21=
            :74=
            :22=0
            :23=0
            
            ;// Clear IP/Email exception
            #81=0
               
            ;// Clear DocID exception
            #82=0
            #83=0
               
            FileExists=%:10
            If=%1PF==P
                FileDelete=%:10
                
                FileExists=%..:10
                If=%1PF==P
                    DirectoryDelete=%..:10,recurse,nomessage
                EndIf=
            EndIf=
        EndIf=
    EndIf=    


[PROCESS13--]
:56=


[PROCESS13-] Open Speed Batch

:80=1
NewLogFile=%JP\speedbatch.bsj

              
[PROCESS14] Send to Ariel
If=%#23==0
    If=%NP>0
        If=%NP>1
            If=%:26!=Started
              Ifb=%#51<0
                MessageYesNo=N9,Sending %NP pages. Are you sure?    
                Ifa=%N9==1
                  ;// Set trigger. if set to 'Started' don't allow continued attempts to export unless trigger is set anything but 'Started'                  
                  
                  ;why is this line below there? (if error we cannot export again with this line)
                  ;:26=Started

                    Command=Process108

                EndIfa=                
              Elseb=
                #51=#51+1
                MessageOK=Modified page %#51 has not been saved yet! Please save or restore it before sending!
                #51=#51-1
              EndIfb=                
            Else=
                MessageOK=You can not 'Send' the same batch more than once. If you got this error its due to an error on a previous attempt to 'Send'. Please close BSCAN ILL and try to 'Send' again. 
            EndIf=
        Else=
            MessageOK=Minimum number of pages is 2. Please scan more than 1 page before trying to send!
        EndIf=
    Else=
        MessageOK=Please scan some pages before trying to send!
    EndIf=
EndIf=


[PROCESS15] Process ControlSheet
;//     
#96=0            
            ;OCRShowZones=Yes
            ;PS=00000000000000000000
            ;StatusClear=ID
            ;StatusClear=RG
        
            ;FC=0001
            ;;;PS[ID][1]=1
            ;;UpdateLogEntry=Yes
            ;;;FormReg=@%F0\Lib\IDReg.lst,test

            ;;If2=%PS[RG][1]==0
            ;;    MessageOK=Registration Failed!
                ;#11=#11+1
            ;;Else2=
            ;;        ActiveOcrFonts=
            ;;        OCR=1278,0861,1517,0906,SKIPZONEFIND,TestLead(1,0,5,RCC,2),TestTrail(1,0,5,RCC,2),:01
            ;;        OCR=0508,0343,1168,0421,SKIPZONEFIND,TestLead(1,0,5,RCC,2),TestTrail(1,0,5,RCC,2),:00
                    
            ;;        :02=%..S5
                    
            ;;EndIf2=

        ;Goto=Home
        ;While=%PN<%LP
            ;Call=Process21,%F0\Lib\%F6\%F6.bsa
            #87a=0
            #71a=0
            
            HourGlass=On    
            
            ; if #75==1 we can use ILLiad database to gather pull slip data using TN number
            
            If=%BD>1
              ;color/gray
              RemoveColor=128,128,128,128
              If=%F6==Master
                Call=Process21,%F0\Lib\Modules\Reader.bsa 
              Else=
                Call=Process21,%F0\Lib\%F6\%F6.bsa 
              EndIf=
              RestoreCurrentImage=Yes
            Else=
              ;bitonal image
              If=%F6==Master
                Call=Process21,%F0\Lib\Modules\Reader.bsa 
              Else=
                Call=Process21,%F0\Lib\%F6\%F6.bsa 
              EndIf=             
            EndIf=
                       
            If17=%#87!=2
              ; in case of #87==2 this pound variable is set in pull slip trainig file so do not clear it here
              #96=0 
            EndIf17= 
            
            If=%-.-:02==
            If=%-.-:30!=
              ; docId empty-> use ILL or TN variable in cas doc delivery specified
              If=%0-.-:30==Email
                If=%-.-:04!=
                  :02=%:04
                EndIf=
              EndIf=
                            
              If=%0-.-:30==Email+Ftp
                If=%-.-:04!=
                  :02=%:04
                EndIf=
              EndIf=

              If=%0-.-:30==Ariel
                If=%-.-:04!=
                  :02=%:04
                EndIf=
              EndIf=   

              If=%0-.-:30==Odyssey
                If=%-.-:05!=
                  :02=%:05
                EndIf=
              EndIf=    
              
              If=%0-.-:30==ILLiad
                If=%-.-:05!=
                  :02=%:05
                EndIf=
              EndIf= 

              If=%0-.-:30==Save on Disk
                If=%-.-:04!=
                  :02=%:04
                EndIf=
              EndIf=                              
              
            EndIf=
            EndIf=
            
            If=%-.-:04%-.-:05==
            If=%-.-:02!=
              ;old pull slip training 
              If=%-.-:30!=              
                If=%0-.-:30==Email                  
                  :04=%:02                  
                EndIf=
                            
                If=%0-.-:30==Email+Ftp
                  :04=%:02
                EndIf=

                If=%0-.-:30==Ariel
                  :04=%:02
                EndIf=   

                If=%0-.-:30==Odyssey
                  :05=%:02    
                EndIf=    
              
                If=%0-.-:30==ILLiad                  
                  :05=%:02                  
                EndIf= 

                If=%0-.-:30==Save on Disk                    
                  :04=%:02                    
                EndIf=               
                
              Else=
                 ; default to ariel -> ILL number was read
                 :04=%:02                            
              EndIf=
            EndIf=
            EndIf=
                 
            If=%#75==1
             ;ILL database enabled
             If=%-.-:00%-.-:01==
               Beep=800,200
               Wait=100
               Beep=800,200
              
               ;show LookupTN button               
               EditFieldSetActive=1,111111                              
             Else=
               ;hide Lookup TN button
               EditFieldSetActive=1,111110
             EndIf=
            EndIf=
            
            HourGlass=Off
            
            Editbox7=Close
            
         ;   UpdateLogEntry=Yes
          ;  PN=%PN+1
        ;Endwhile=
         ;   Call=Process16,%F0\Lib\%F6\%F6.bsa
          ;  UpdateLogEntry=Yes                                    
            
            ;// If pullslip was detected.
            If=%:74==1                
                                                                            
                ;Ifg2=%#81!=1
                Ifxx=%#71==0
                     ; if DocID validation is ON
                     
                     ;is empty TN allowed?
                     #78=0
                     If=%#77==1
                       If=%0-.-:30!=
                         If=%0-.-:30!=Odyssey                  
                           If=%0-.-:30!=ILLiad                                       
                             ;no update to ILLiad and delivery is not Odyssey nor ILLiad -> we can have ILL# only and TN can be blank
                             #78=1
                           EndIf=
                         EndIf=
                       EndIf=
                     EndIf=
                     
                     ;is empty ILL# allowed?
                     #79=0
                     If=%0-.-:30!=
                       If=%0-.-:30==Odyssey                  
			 #79=1
                       EndIf=
                       If=%0-.-:30==ILLiad                                                              
                         #79=1
                       EndIf=                     
                     EndIf=                                          
                     
                     #82=0             
                     #83=0
                     ;// If DocID field is empty.                     
                     #86=0
                     If=%-.-:04==
                       If=%-.-:05==
                         #86=1
                       EndIf=
                     EndIf=
                     
                     If1=%#86>0
                            If=%NP>0
                                ;// Set DocID exception
                                If=%#79!=1
                                  #82=1
                                EndIf=
                                
                                If=%#78!=1
                                  #83=1
                                EndIf=
                                
                                Ifoo=%#75==1
                                  ;ILL database enabled 
                                  #83=1
                                  MessageOK=Please enter the transaction number and click 'Lookup Transaction Number' button!
                                Elseoo=
                                  ;MessageOK=Please specify a DocID!
                                  If=%#78!=1
                                    If=%#79!=1
                                      MessageOK=Please specify ILL Number and TN!
                                    Else=
                                      MessageOK=Please specify TN!
                                    EndIf=
                                  Else=
                                    MessageOK=Please specify ILL Number!
                                  EndIf=
                                EndIfoo=
                                ;EditFieldSetFocus=1,3,0,30
                                #96=2
                                ;;#88=1
                            Else=
                              If0=%1:56==2
                                ;KIC import
                                ;if scan cotrol sheet with KIC Import->%NP is not updated yet at this point so condition above is false... workaroud
                                ; this script is executed only if page was scanned as os scan process sets control sheet detected flag for twain
                                ;// Set DocID exception
                                #82=1
                                
                                If=%#78!=1
                                  #83=1
                                EndIf=
                                Ifoo=%#75==1
                                  ;ILL database enabled
                                  #83=1 
                                  MessageOK=Please enter the transaction number and click 'Lookup Transaction Number' button!
                                Elseoo=
                                  If=%#78!=1
                                    If=%#79!=1
                                      MessageOK=Please specify ILL Number and TN!
                                    Else=
                                      MessageOK=Please specify TN!
                                    EndIf=
                                  Else=
                                    MessageOK=Please specify ILL Number!
                                  EndIf=
                                EndIfoo=
                                ;EditFieldSetFocus=1,3,0,30
                                #96=2
                                ;;#88=1                                
                              Else0=  
                               If=%#13==1                    
                                ;if scan cotrol sheet with TWAIN - ADF+pedal (MINOLTA)->%NP is not updated yet at this point so condition above is false... workaroud
                                ; this script is executed only if page was scanned as os scan process sets control sheet detected flag for twain
                                ;// Set DocID exception
                                #82=1
                                
                                If=%#78!=1
                                  #83=1
                                EndIf=
                                Ifoo=%#75==1
                                  ;ILL database enabled
                                  #83=1 
                                  MessageOK=Please enter the transaction number and click 'Lookup Transaction Number' button!
                                Elseoo=
                                  If=%#78!=1
                                    If=%#79!=1
                                      MessageOK=Please specify ILL Number and TN!
                                    Else=
                                      MessageOK=Please specify TN!
                                    EndIf=
                                  Else=
                                    MessageOK=Please specify ILL Number!
                                  EndIf=
                                EndIfoo=
                                ;EditFieldSetFocus=1,3,0,30
                                #96=2
                                ;;#88=1
                               EndIf=                              
                              EndIf0=
                            EndIf=
                     Else1=
                       If=%-.-:04!=
                          #07=%LN(:04)
                          
                          #05=0
                          While=%#05<%#07
                            #06=0
                            If=%(#05).1:04>=0
                            If=%(#05).1:04<=9
                              #06=1
                            EndIf=
                            EndIf= 
                            
                            If=%#06==0
                              If=%(#05).1:04>=A
                              If=%(#05).1:04<=Z
                                #06=1
                              EndIf=
                              EndIf=
                            EndIf=
                            
                            If=%#06==0
                              If=%(#05).1:04>=a
                              If=%(#05).1:04<=z
                                #06=1
                              EndIf=
                              EndIf=
                            EndIf=             
                            
                            If=%#06==0
                              If=A%(#05).1:04==A_
                                #06=1
                              EndIf=
                            EndIf=
                            If=%#06==0
                              If=A%(#05).1:04==A-
                                #06=1
                              EndIf=
                            EndIf=                                                                     
                          
                            Ifd=%#06==1
                              #05=#05+1
                            Elsed=
                              ;bad char
                              #05=%#07 
                              #82=1                                                            
                            EndIfd=
                            
                          EndWhile=
                          
                          ;test if dash is not as last character - ariel would not like it (based on LindaHall info)
                          #07=#07-1
                          If=A%(#07).1:04==A-
                                #82=1
                          EndIf=
                       Else=
                         If=%#79!=1
                           #82=1
                         EndIf=
                       EndIf=                       
                                  
                       If=%-.-:05!=
                          #07=%LN(:05)
                          
                          #05=0
                          While=%#05<%#07
                            #06=0
                            If=%(#05).1:05>=0
                            If=%(#05).1:05<=9
                              #06=1
                            EndIf=
                            EndIf= 
                            
                            If=%#06==0
                              If=%(#05).1:05>=A
                              If=%(#05).1:05<=Z
                                #06=1
                              EndIf=
                              EndIf=
                            EndIf=
                            
                            If=%#06==0
                              If=%(#05).1:05>=a
                              If=%(#05).1:05<=z
                                #06=1
                              EndIf=
                              EndIf=
                            EndIf=             
                            
                            If=%#06==0
                              If=A%(#05).1:05==A_
                                #06=1
                              EndIf=
                            EndIf=
                            If=%#06==0
                              If=A%(#05).1:05==A-
                                #06=1
                              EndIf=
                            EndIf=                                                                     
                          
                            Ifd=%#06==1
                              #05=#05+1
                            Elsed=
                              ;bad char
                              #05=%#07 
                              #82=#82+2                                                            
                            EndIfd=
                            
                          EndWhile=
                          
                          ;test if dash is not as last character - ariel would not like it (based on LindaHall info)
                          #07=#07-1
                          If=A%(#07).1:05==A-
                                #82=#82+2
                          EndIf=
                       Else=    
                           If=%#78!=1                                   
                                #82=#82+2
                           EndIf=
                       EndIf=                                  
                                                                                  
                          ;Ifgg=%#82==1
                       Ifgg=%#82>0
                                ;MessageOK=Please specify a valid DocID!
                                ;MessageOK=Please specify valid ILL Number/TN!
                   
                             If=%#82==1
                               MessageOK=Please specify valid ILL Number!
                             EndIf=
                             If=%#82==2
                               #82=0
                               #83=1
                               MessageOK=Please specify valid TN!
                             EndIf=
                             If=%#82==3
                               #82=1
                               #83=1
                               MessageOK=Please specify valid ILL Number and TN!
                             EndIf=                          
                                
                                ;EditFieldSetFocus=1,3,0,30
                                #96=2                          
                       EndIfgg=
                     EndIf1=                                      
                EndIfxx=
                ;EndIfg2=                          
                
                ;;-------------------------------------;;
                          
                Ifg8=%#82!=1
                Ifg9=%#83!=1
                ;// If IP/Email field is empty.
                Ifz=%.-:01==
                  Ifrr=%0-.-:30!=ILLiad
                  Ifrr=%0-.-:30!=Odyssey

                    If=%NP>0
                        ;// Set IP exception
                        #81=1
                        MessageOK=Please specify an IP or Email!
                        ;EditFieldSetFocus=1,2,0,30
                        #96=1
                        ;;#88=1
                    Else=
                      If0=%1:56==2
                        ; KIC import
                        
                        ;if scan cotrol sheet with KIC import->%NP is not updated yet at this point so condition above is false... workaroud
                        ; this script is executed only if page was scanned as os scan process sets control sheet detected flag for twain
                        ;// Set IP exception
                        #81=1
                        MessageOK=Please specify an IP or Email!
                        ;EditFieldSetFocus=1,2,0,30
                        #96=1                                              
                      Else0=
                       If=%#13==1                    
                        ;if scan cotrol sheet with TWAIN - ADF+pedal (MINOLTA)->%NP is not updated yet at this point so condition above is false... workaroud
                        ; this script is executed only if page was scanned as os scan process sets control sheet detected flag for twain
                        ;// Set IP exception
                        #81=1
                        MessageOK=Please specify an IP or Email!
                        ;EditFieldSetFocus=1,2,0,30
                        #96=1                        
                       EndIf=
                     EndIf0= 
                    EndIf=
                  EndIfrr=
                  EndIfrr=
                Elsez=
                  Ifrr=%0-.-:30!=ILLiad
                    
                    S6=%:01
                    IsNumeric=S6,PLUS(.)
                    If=%1PF==P
                        ;// IP
                        
                        ;// ///////////////////////////////////////////////////////////////////////////
                        		
			LocateIP=%:01,:57,S6
                        #48=%S6
                        If=%#48<50
                          ;IP validation failed
                            If=%NP>0
                                ;// Set IP exception
                                #81=1
                                MessageOK=Please specify a valid IP!
                                :01=
                                ;EditFieldSetFocus=1,2,0,30
                                #96=1
                                
                                ;;#88=1
                            Else=
                              If0=%1:56==2
                                ;KIC import
                                
                                ;if scan cotrol sheet with KIC import->%NP is not updated yet at this point so condition above is false... workaroud
                                ; this script is executed only if page was scanned as os scan process sets control sheet detected flag for twain
                                ;// Set IP exception
                                #81=1
                                MessageOK=Please specify a valid IP!
                                :01=
                                ;EditFieldSetFocus=1,2,0,30
                                #96=1
                                
                                ;;#88=1                                
                              Else0=
                               If=%#13==1                    
                                ;if scan cotrol sheet with TWAIN - ADF+pedal (MINOLTA)->%NP is not updated yet at this point so condition above is false... workaroud
                                ; this script is executed only if page was scanned as os scan process sets control sheet detected flag for twain
                                ;// Set IP exception
                                #81=1
                                MessageOK=Please specify a valid IP!
                                :01=
                                ;EditFieldSetFocus=1,2,0,30
                                #96=1
                                
                                ;;#88=1
                               EndIf=                             
                              EndIf0=
                            EndIf=                        
                        EndIf=
                        
                        ;// ///////////////////////////////////////////////////////////////////////////                        
                    Else=
                        ;// Email or Alpha IP or unknown
                        
                      Ifgg=%#87==0                        
                                                                                     
                                                                                     
                          #07a=%LN(:01)
                          ;workaround script to replace misreads of '@' sign
                          #05a=0
                          While9=%#05<%#07

                            Ifw5=a%(#05).3:01==a(g)
                              #06a=#05+3
                              :01t=%(#05):01@%(#06).:01                              
                              #05b=%#07 
                            Elsew5=
                              Ifw6=a%(#05).3:01==a(Ql
                                #06a=#05+3
                                :01t=%(#05):01@%(#06).:01                              
                                #05b=%#07                                                          
                              EndIfw6=
                            EndIfw5= 
                            #05c=#05+1
                            
                          EndWhile9= 
                                                                                                                                                           
                      
                        IsExist=S6,@
                        If=%1PF==P
                            ;email
                            #81=
                        Else=
                          ;check if alpha IP
			              LocateIP=%:01,:57,S6
                          #48=%S6
                          If1=%#48<50                        
                            If=%NP>0
                                ;// Set IP exception
                                #81=1
                                ;MessageOK=Please specify a valid Email!
                                MessageOK=Please specify a valid IP or Email!
                                :01=
                                ;EditFieldSetFocus=1,2,0,30
                                #96=1
                                ;;#88=1
                            Else=
                              If0=%1:56==2
                                ;KIC import
                                
                                ;if scan cotrol sheet with KIC import->%NP is not updated yet at this point so condition above is false... workaroud
                                ; this script is executed only if page was scanned as os scan process sets control sheet detected flag for twain
                                ;// Set IP exception
                                #81=1
                                ;MessageOK=Please specify a valid Email!
                                MessageOK=Please specify a valid IP or Email!
                                :01=
                                ;EditFieldSetFocus=1,2,0,30
                                #96=1
                                ;;#88=1                              
                              Else0=
                               If=%#13==1                    
                                ;if scan cotrol sheet with TWAIN - ADF+pedal (MINOLTA)->%NP is not updated yet at this point so condition above is false... workaroud
                                ; this script is executed only if page was scanned as os scan process sets control sheet detected flag for twain
                                ;// Set IP exception
                                #81=1
                                ;MessageOK=Please specify a valid Email!
                                MessageOK=Please specify a valid IP or Email!
                                :01=
                                ;EditFieldSetFocus=1,2,0,30
                                #96=1
                                ;;#88=1
                               EndIf=
                              EndIf0=                             
                            EndIf=
                          EndIf1=
                        EndIf=
                      Elsegg=
                        ;add to release
                        If78=%#87!=2                        
                          #81=0
                        EndIf78=
                      EndIfgg=
                    
                    EndIf=
                    
                    ;// Validation over. Check to see if flag was set indicating a problem.
                    
                    Ifg=%#81!=1
   
  ; why this is here? 
                    
  ;                        Ifrr=%#81!=1
  ;                          ;// If 'Email' export is selected
  ;                          If=%:83==Yes
  ;                              ;// Set IP/Email exception
  ;                              #81=1
  ;                              ;// Clear 'IP/Email' field
  ;                              :01=
  ;                              ;EditFieldSetFocus=1,2,0,30
  ;                              #96=1
                                
  ;                          Else=
  ;                              ;// If 'Email+Ftp' export is selected
  ;                              If=%:84==Yes
  ;                                  ;// Set IP/Email exception
  ;                                  #81=1
  ;                                  ;// Clear 'IP/Email' field
  ;                                  :01=
  ;                                  ;EditFieldSetFocus=1,2,0,30
  ;                                  #96=1
                                    
  
  ;                              EndIf=
  ;                          EndIf=
  ;                        EndIfrr=
                        
                        
                        ;// -------------------------------------
                        ;// Check borrower code.
                        ;// note: this is temporary code because eventually this will go into the master file for each institution.
                        ;// 
                        
                        ;// Only do this function if sending to Ariel.
                        #85=0
                        Ifa1=%-.-:30==
                          Ifa=%.-:82==Yes
                            #85=1
                          EndIfa=
                        Elsea1=
                          Ifb=%0-.-:30==Ariel
                            #85=1
                          EndIfb=
                        EndIfa1=      
                        
                        ;Ifa=%.-:82==Yes
                        Ifa=%#85==1
                        
                            ;// temp variable for getting length
                            S3=%.-:01
                            ;// temp variable for getting length
                            #86=%LN(S3)
                            
                            If=%#86==3
                                ;// Borrower code was used.
                                
                                ;// check to make sure this borrower code exists in the ariel address list.
                                ;// if it doesn't, let the user know so that they can fix the problem before releasing.
                                ReadINI20=@%AP\..\Lib\Control.lst,ARIEL,Path2,:89
                                FileExists=%:89\ALIASES.TXT
                                If=%1PF==P
                                    
                                    FileOpen=4,%:89\ALIASES.TXT
                                    S3=
                                    FileRead=4,S3
                                    S4=
                                    
                                    While=%S3!=%S4
                                        
                                        If=%3S3==%.-:01
                                            ;// Borrower was found. exit while loop.
                                            S4=%S3
                                            ;// set flag saying borrower was found.
                                            #86=99
                                        Else=
                                            S4=%S3
                                            ;// Read next line
                                            FileRead=4,S3
                                            
                                        EndIf=
                                    
                                    EndWhile=
                                    FileClose=4
                                    
                                    If=%#86!=99
                                        ;// Borrower was not found. Warn user!
                                        
                                        MessageOK=WARNING! Borrower code '%.-:01' was not found in your Ariel address book. Please specify a correct IP before sending!
                                        ;// Set IP/Email exception
                                        #81=1
                                        ;// Clear 'IP/Email' field
                                        :01=
                                        ;EditFieldSetFocus=1,2,0,30
                                        #96=1
                                        
                                    EndIf=
                                Else=
                                    ;// If the address list doesn't even exist, don't even try to do anything.
                                    ;// warn the user that they don't have an address list setup and they need to
                                    ;// fix the IP to a good IP.
                                    
                                    MessageOK=WARNING! You Do not have an address list setup in Ariel. Please update the IP to a valid IP before sending!
                                    ;// Set IP/Email exception
                                    #81=1
                                    ;// Clear 'IP/Email' field
                                    :01=
                                    ;EditFieldSetFocus=1,2,0,30
                                    #96=1
                                    
                                EndIf=
                                
                                ;// Clear temp vars
                                
                                S3=
                                S4=
                                #86=
                                
                            EndIf=
                        EndIfa=
                    
                    
                    EndIfg=
                
                  EndIfrr=
                  
                EndIfz=                                
                EndIfg9=
                EndIfg8=
                
                UpdateLogEntry=Yes
            EndIf=
            

[PROCESS16] Append image
    
If=%5:25!=ERROR
    
    ;If1=%6C1==000001
    If1=%1:74==1       
        ; current page is a control sheet
        #15=0
        #22=0
                
        If=%:25!=
            ;// Check to see if the last doc that was saved exists.
            FileExists=%:25            
            If=%1PF!=P
                ;// File doesnt exist. Set the 'ERROR' flag on var :25
                
                :25=ERROR            
            EndIf=
        EndIf=
        
        If=%5:25!=ERROR
                        
            If=%:51==pdf
              If=%#69>0
                 
                 FileMkDir=%F2\%:52
                 
                 If=%#50!=0
                   RecognizeWriteDocument=%F2\%:52\%:52.pdf,Adobe PDF image only
                 Else=
                   FileClose=7                   
                   WinExecWait=%IP\PDFCreator\BScanPDFBatchConverter.exe "%IP\PDFCreator\ImageToPDF.txt" "%F2\%:52\%:52.pdf" 75
                 EndIf=
              EndIf=
            Else=
              If=%:51==spdf
                If=%#69>0                 
                  FileMkDir=%F2\%:52
                 
                  If=%#50!=0
                    RecognizeWriteDocument=%F2\%:52\%:52.pdf,Adobe PDF image only
                  Else=
                    FileClose=7                   
                    WinExecWait=%IP\PDFCreator\BScanPDFBatchConverter.exe "%IP\PDFCreator\ImageToPDF.txt" "%F2\%:52\%:52.pdf" 75
                  EndIf=
                EndIf=                          
              EndIf=  
            EndIf=
                   
            ; new article if there is something for ftp - previous article - do it
            ;;;;;;Call=Process74
        
            ;:18=%0-.-:02
                
            ;// Determine ImageFormat - whether tif or pdf
        
        
            #76=0                
            ReadINI21=@%AP\..\Lib\Control.lst,MAIN,ImageFormat,:51
            
            Ifa=%-.-:30==              
              ; delivery list box not selected -> go by controls.lst
              
              ;// If Exporting to Email
              If=%-.-:83==Yes
                #76=1        
                :51=pdf
              EndIf=
    
              ;// If Exporting to Email+FTP
              If=%-.-:84==Yes
                #76=2
                :51=pdf
              EndIf=

              If=%-.-:82==Yes
                ;ariel
                #76=0   
                :51=tif     
              EndIf=   
              If=%-.-:62==Yes
                ;Odyssey
                #76=3  
                :51=tif    
              EndIf=    
              If=%-.-:61==Yes
                ;ILLiad
                #76=4   
                :51=tif     
              EndIf=        
            Elsea=
              ; delivery method listbox selected..
              ;// If Exporting to Email
              If=%0-.-:30==Email
                #76=1        
                ;;:51=pdf
                ReadINI60=@%AP\..\Lib\Control.lst,EMAIL,ImageFormat,:51
              EndIf=
    
              ;// If Exporting to Email+FTP
              If=%0-.-:30==Email+Ftp
                #76=2                
                ;:51=pdf
                ReadINI61=@%AP\..\Lib\Control.lst,FTP,ImageFormat,:51
              EndIf=

              If=%0-.-:30==Ariel
                ;ariel
                #76=0 
                :51=tif       
              EndIf=   
              If=%0-.-:30==Odyssey
                ;Odyssey
                #76=3   
                ;:51=tif   
                ReadINI62=@%AP\..\Lib\Control.lst,ODYSSEY,ImageFormat,:51
              EndIf=    
              If=%0-.-:30==ILLiad
                ;ILLiad
                #76=4      
                ;:51=tif  
                ReadINI63=@%AP\..\Lib\Control.lst,ILLiad,ImageFormat,:51
              EndIf= 
              If=%0-.-:30==Save on Disk
                ;Save on disk
                #76=5        
                
                ; already executed above
                ;;ReadINI21=@%AP\..\Lib\Control.lst,MAIN,ImageFormat,:51
              EndIf=               
            
            EndIfa=
 
 	    If=%-.-:51==
		ReadINI21=@%AP\..\Lib\Control.lst,MAIN,ImageFormat,:51
	    EndIf=

            If=%#76==0
              ; flag at least one document to sent by Ariel
              #31=1
            EndIf=
            
            If=%#76==5
             ;save on disk -> check if large size article - to skip backup to multi image tiff
             #10=%PN
             #18=%PN
             #11=%LP
             #12=0
             #14=0
             
             UpdateView=No
             While=%#10<=%#11
               If1=%1:74==1
                 #12=#12+1
               EndIf1=         
               
               If=%#12<=1
                 ;check file extension and file size
                 :92=%FN
                 :93=%..:92
                 #16=%LN(:93)
                 #16=#16+1
                 :92=%(#16).:92
                 :92=%UC(%:92)
                 If=%-.-:92==JPG
                   ;exit loop in case jpeg is used in article
                     #15=1
                     #10=#11+1                 
                 Else=
                   #14=#14+%FS
                   ;#14=#14+20000001
                   If=%#14>50000000
                     ;too big article for multi image tiff
                     #15=1
                     #10=#11+1
                   Else=          
                     If=%PN<%LP       
                       PN=PN+1
                       #10=#10+1
                     Else=
                       ;exit loop - last page processed
                       #10=#11+1                     
                     EndIf=
                   EndIf=
                 EndIf=
               Else=                 
                 ;exit loop - next article
                 #10=#11+1
               EndIf=                          
             
             EndWhile=             
             PN=%#18
             UpdateView=Yes
            EndIf=
          
            ; set :02 based on :30 resp #76 and :04, :05
            If=%-.-:04%-.-:05!=
              If=%#76==1
                ;Email
                If=%-.-:04!=
                  :02=%:04
                Else=
                  :02=%:05
                EndIf=
              EndIf=
    
              ;// If Exporting to Email+FTP
              If=%#76==2
                ;Email+Ftp                
                If=%-.-:04!=
                  :02=%:04
                Else=
                  :02=%:05
                EndIf=
              EndIf=

              If=%#76==0
                ;Ariel                
                If=%-.-:04!=
                  :02=%:04
                Else=
                  :02=%:05
                EndIf=
              EndIf=   
              
              If=%#76==3
                ;Odyssey
                If=%-.-:05!=
                  :02=%:05
                Else=
                  :02=%:04
                EndIf=
              EndIf=    
              If=%#76==4
                ;ILLiad
                If=%-.-:05!=
                  :02=%:05
                Else=
                  :02=%:04
                EndIf=
              EndIf= 
              If=%#76==5
                ;Save on Disk
                If=%-.-:04!=
                  :02=%:04
                Else=
                  :02=%:05
                EndIf=
              EndIf=             
            EndIf=
            
            :18=%0-.-:02
            
            If=%:51==tif
                F4a=%.-:18.tif
            Else=
                If=%:51==pdf
                    F4a=%.-:18.pdf
                Else=
                  If=%:51==spdf
                    F4a=%.-:18.pdf
                  EndIf=  
                EndIf=
            EndIf=
            
            :94=%.-:18.tif
            
            FileMkDir1=%F2\%.-:18
            ;// Batch write
            
            If=%:20==
                :20=%:18
            EndIf=
            
            If=%:21==
                :21=%:18
            EndIf=
            
            
            #85=0         
            
            :34=%:30
            
            Ifa=%-.-:30==
              ;ReadINI=@%F0\Lib\control.lst,MAIN,SendUsing,:65
              ; line below might be borken as we use :97 in pull slip trainig...
              
              :34=%:97
                                                                                                             
              If=%:34==ILLiad
                #85=1              
              EndIf=
            Elsea=
            
              ;Ariel
              ;ILLiad
              ;Odyssey
              ;Email
              ;Email+Ftp
              ;Save on Disk            
            
              If15=%#76==4              
                #85=1
              EndIf15=            
            EndIfa=
                        
            
            ;If=%:65==ILLiad
            ;If=%#85==1
            ;    FileWrite1=1,%.-:18|%0-.-:34|
            ;Else=
            ;    ;// Find out what version of ariel is set
            ;    If=%:87==3
            ;        FileWrite1=1,%F2\%.-:18\%F4|%.-:18|%.-:00|%.-:20|%.-:21|%.-:01|%0-.-:34|
            ;    Else=
            ;        If=%:87==4
                        FileWrite1=1,%F2\%.-:18\%F4|%.-:00|%.-:20|%.-:01|%0-.-:34|%.-:04|%0-.-:05|
            ;        EndIf=
            ;    EndIf=  
            ;EndIf=
            
      
            
            ;// Write the information for this particular docid to its own docid folder.
            
            FileExists4=%F2\%.-:18\imdata.txt
            If5=%1PF==P
                FileDelete4=%F2\%.-:18\imdata.txt
            EndIf5=
            
            FileMkDir2=%F2\%.-:18
            FileOpen1=5,%F2\%.-:18\imdata.txt
            
            ;ReadINI=@%F0\Lib\control.lst,MAIN,SendUsing,:65
            ;If=%:65==ILLiad
            ;If=%#85==1
            ;    FileWrite1=5,%.-:18|%0-.-:34|
            ;Else=
            ;    If=%:87==3
            ;        FileWrite4=5,%F2\%.-:18\%F4|%.-:18|%.-:00|%.-:20|%.-:21|%.-:01|%0-.-:34|
            ;    Else=
            ;        If=%:87==4
                        FileWrite4=5,%F2\%.-:18\%F4|%.-:00|%.-:20|%.-:01|%0-.-:34|%.-:04|%0-.-:05|
            ;        EndIf=
            ;    EndIf=
            ;EndIf=
            FileClose1=5
            
            ;// /////////////////////////////////////////////////////////////////////
            ;// RESEND configuration preparation
            ;// 
            FileExists=%F2\%.-:18\resend.txt
            If=%1PF==P
                FileDelete=%F2\%.-:18\resend.txt
            EndIf=
            FileOpen=3,%F2\%.-:18\resend.txt
            FileWrite=3,[INFO]
            ;// Remove zeroes for compatibility with reporting module.
            If=%1D2==0
                :65=%1.D2
                If=%3:65==0
                    :65=%2:65%3.:65
                EndIf=
            Else=
                :65=%D2
                If=%4:65==0
                    :65=%3:65%4.:65
                EndIf=
            EndIf=
            FileWrite=3,DateCreated=%:65
            FileWrite=3,LastSent=%:65
            FileWrite=3,Patron=%.-:00
            FileWrite=3,IPEmail=%.-:01
            FileWrite=3,DocID=%.-:18
            FileWrite=3,Notes=%.-:03
            ;FileWrite=3,Desc=%.-:04
            FileWrite=3,Desc=
            FileWrite=3,DelMeth=%.-:30
            FileWrite=3,ILLNumber=%.-:04
            FileWrite=3,TN=%.-:05
            
            ;// reset temp variable.
            :65=
            
            #85=0
            If15=%#76==1
              ;email
              #85=1
            EndIf15=
            If15=%#76==2
              ;ftp
              #85=1
            EndIf15=
            If15=%#76==5
              ;save on disk
              #85=1
            EndIf15=            
            
            
            ;If=%#76==0
            If=%#85==0                       
            
                ;ReadINI=@%F0\Lib\control.lst,MAIN,SendUsing,:65
                ;If=%:65==Odyssey
                If=%#76==3
                    FileWrite=3,DeliveryMethod=Odyssey 1.0
                Else=
                    ;If=%:65==ILLiad
                    If=%#76==4
                        FileWrite=3,DeliveryMethod=ILLiad
                    Else=
                        ;Ariel
                        If=%:87==3
                            FileWrite=3,DeliveryMethod=Ariel 3.x
                        Else=
                            If=%:87==4
                                FileWrite=3,DeliveryMethod=Ariel 4.0
                            EndIf=
                        EndIf=
                    EndIf=
                EndIf=
            Else=
                If=%#76==1
                    FileWrite=3,DeliveryMethod=Email
                EndIf=
                If=%#76==2
                    FileWrite=3,DeliveryMethod=Email+Ftp
                EndIf=
                If=%#76==5
                    FileWrite=3,DeliveryMethod=Save on Disk
                EndIf=                
            EndIf=
            FileWrite=3,DeliveryDetail=%.-:01
            If=%:51==tif
                FileWrite=3,ImageFormat=Tiff G4
            Else=
                If=%:51==pdf
                    FileWrite=3,ImageFormat=PDF
                Else=
                  If=%:51==spdf
                    FileWrite=3,ImageFormat=PDF
                  EndIf=  
                EndIf=
            EndIf=
            FileWrite=3,Location=%F2\%.-:18\%F4
            FileWrite=3,Status=
            FileWrite=3,Pages=
            FileWrite=3,
            FileWrite=3,[PAGE_FLAGS]
            FileClose=3
            
            #25=0    
            
            ;// Make sure the DOCID doesn't already exist. If it does, delete and write new one.
            FileExists1=%F2\%.-:18\%F4
            If4=%1PF==P
                FileDelete1=%F2\%.-:18\%F4
            EndIf4=
            
            If=%:51==pdf
              ; clear also tif file (for resend purposes) if necessary
              FileExists1=%F2\%.-:18\%:94
              If4=%1PF==P
                FileDelete1=%F2\%.-:18\%:94
              EndIf4=
            Else=
              If=%:51==spdf
                FileExists1=%F2\%.-:18\%:94
                If4=%1PF==P
                  FileDelete1=%F2\%.-:18\%:94
                EndIf4=                          
              EndIf=  
            EndIf=
            
            FileMkDirt=%F2\%.-:18         
            
            ;ReadINI=@%F0\Lib\control.lst,MAIN,SendUsing,:65
            ;If=%:65==ILLiad
            If=%#76==4
                FileExists=C:\ILLiad\elecdel\%F4
                If=%1PF==P
                    FileDelete=C:\ILLiad\elecdel\%F4
                EndIf=
            EndIf=
                
                ;// Determine what to save the images to, whether tiff or pdf.
                :99=%..FN
                #24=%LN(:99)
                
                If=%:51==tif
                    If=%1:87!=3
                      If=%BD>1
                        SaveAs=%FP,lzw
                        RestoreCurrentImage=Yes
                      EndIf=
                    EndIf=
                    
                    ;;; to fix uncompressed bitonal images to G4 compression at export time to avoid odyssey issue
                    ;If=%BD==1
                    ;  #93=0
                    ;  GetTiffTag=259,#93
                    ;  If=%#93==1
                    ;    ;;; if uncompressed bitonal->compress to G4
                    ;    SaveAs=%FP,com
                    ;    RestoreCurrentImage=Yes
                    ;  EndIf=
                    ;EndIf=
                    
                    If=%#15==0
                      AppendImageTo1=%F2\%.-:18\%F4
                    Else=
                      ; copy images into backup subfolder
                      FileMkDir=%F2\%.-:18\%..F4
                      FileCopy=%FP,%F2\%.-:18\%..F4\%4#22%(#24).FN
                      #22=#22+1
                    EndIf=
                    FileOpen=3,%F2\%.-:18\resend.txt
                    FileWrite=3,%#25=%0-.-:17
                    FileClose=3
                    
                    ;ReadINI=@%F0\Lib\control.lst,MAIN,SendUsing,:65
                    ;If=%:65==ILLiad
                    If=%#76==4
                        AppendImageTo1=C:\ILLiad\elecdel\%F4
                    EndIf=
                    
                    ;// Store filename so that we can later check to make sure it exists. If it doesn't exist we will catch the error.
                    :25=%F2\%.-:18\%F4
                Else=
                    #93=0
                    If=%:51==pdf
                      #93=1
                    EndIf=
                    If=%:51==spdf
                      #93=1
                    EndIf=                    
                    If=%#93==1
                     ;   If=%PN>0
                     ;       RecognizeWriteDocument=%F2\%:52\%:52.pdf,Adobe PDF image only
                     ;   EndIf=
                     
                     If=%#50!=0
                        RecognizeBeginDocument=Yes
                        If=%:51==pdf                          
                          RecognizePage=%FP,NoOcr                          
                        Else=                          
                          RecognizePage=%FP
                        EndIf=
                     Else=                        
                        FileExists=%IP\PDFCreator\ImageToPDF.txt
                        If=%1PF==P
                           FileDelete1=%IP\PDFCreator\ImageToPDF.txt
                        EndIf=
                        FileOpen=7,%IP\PDFCreator\ImageToPDF.txt
                                              
                        FileWrite=7,%FP
                     EndIf=
                        
                        :52=%.-:18
                        
                        ;create also tif to support resend
                        If=%1:87!=3
                          If=%BD>1
                            SaveAs=%FP,lzw
                            RestoreCurrentImage=Yes
                          EndIf=
                        EndIf=
                        
                    ;;; to fix uncompressed bitonal images to G4 compression at export time to avoid odyssey issue
                    ;If=%BD==1
                    ;  #93=0
                    ;  GetTiffTag=259,#93
                    ;  If=%#93==1
                    ;    ;;; if uncompressed bitonal->compress to G4
                    ;    SaveAs=%FP,com
                    ;    RestoreCurrentImage=Yes
                    ;  EndIf=
                    ;EndIf=
                                            
                        If=%#15==0
                          AppendImageTo1=%F2\%.-:18\%:94
                        Else=
                          ; copy images into backup subfolder
                          FileMkDir=%F2\%.-:18\%..:94
                          FileCopy=%FP,%F2\%.-:18\%..:94\%4#22%(#24).FN                      
                          #22=#22+1
                                                
                        EndIf=
                    
                        FileOpen=3,%F2\%.-:18\resend.txt
                        FileWrite=3,%#25=%0-.-:17
                        FileClose=3                        
                        
                    EndIf=
                EndIf=
            
            ;// Store current article name , email address , attachment filepath for email purposes
                ;// Full path to article
                :69=%F2\%.-:18\%F4
                ;// Email address (TO:)
                :48=%:01
                ;// DocID
                :49=%:18
                ;// Increment counter
                #69=#69+1            
                #25=#25+1
                
            ;// //////////////////////////////////////
            ;// MODULE: Reporting
                ReadINI13=@%F0\Lib\Modules\ModuleState.bsi,MODULES,Reporting,:65
                If2=%:65==Enabled
                    If3=%:39==
                        FileWrite2=2,%.-:18
                    Else3=
                        FileWrite3=2,%.-:18
                    EndIf3=
                EndIf2=
                :65a=
            ;// END
            ;// //////////////////////////////////////
        EndIf=
    Else1=
        
        ;// Determine what to save the images to, whether tiff or pdf.
        
        If=%:51==tif
                 If=%1:87!=3
                    If=%BD>1
                    SaveAs=%FP,lzw
                    RestoreCurrentImage=Yes
                    EndIf=  
                 EndIf=      
                 
                    ;;; to fix uncompressed bitonal images to G4 compression at export time to avoid odyssey issue
                    ;If=%BD==1
                    ;  #93=0
                    ;  GetTiffTag=259,#93
                    ;  If=%#93==1
                    ;    ;;; if uncompressed bitonal->compress to G4
                    ;    SaveAs=%FP,com
                    ;    RestoreCurrentImage=Yes
                    ;  EndIf=
                    ;EndIf=                 
                    
            If=%#15==0
              AppendImageTo2=%F2\%.-:18\%F4
            Else=
              ; copy images into backup subfolder
              FileCopy=%FP,%F2\%.-:18\%..F4\%4#22%(#24).FN              
              #22=#22+1
                                        
            EndIf=            
            
            FileOpen=3,%F2\%.-:18\resend.txt
            FileWrite=3,%#25=%0-.-:17
            FileClose=3
                                
            ;ReadINI=@%F0\Lib\control.lst,MAIN,SendUsing,:65
            ;If=%:65==ILLiad
            If=%#76==4
                AppendImageTo1=C:\ILLiad\elecdel\%F4
            EndIf=
            
        Else=
            #93=0
            If=%:51==pdf
              #93=1
            EndIf=
            If=%:51==spdf
              #93=1
            EndIf=
                        
            If=%#93==1
              If=%#50!=0
                If=%:51==pdf                
                  RecognizePage=%FP,NoOcr
                Else=                
                  RecognizePage=%FP
                EndIf=
              Else=
                FileWrite=7,%FP
              EndIf=
                If=%1:87!=3
                    If=%BD>1
                    SaveAs=%FP,lzw
                    RestoreCurrentImage=Yes
                    EndIf= 
                EndIf=               
                
                    ;;; to fix uncompressed bitonal images to G4 compression at export time to avoid odyssey issue
                    ;If=%BD==1
                    ;  #93=0
                    ;  GetTiffTag=259,#93
                    ;  If=%#93==1
                    ;    ;;; if uncompressed bitonal->compress to G4
                    ;    SaveAs=%FP,com
                    ;    RestoreCurrentImage=Yes
                    ;  EndIf=
                    ;EndIf=                
            
              If=%#15==0
                AppendImageTo2=%F2\%.-:18\%:94  
              Else=
                ; copy images into backup subfolder
                FileCopy=%FP,%F2\%.-:18\%..:94\%4#22%(#24).FN              
                #22=#22+1
                              
              EndIf=  
                              
                FileOpen=3,%F2\%.-:18\resend.txt
                FileWrite=3,%#25=%0-.-:17
                FileClose=3                
                
            EndIf=
        EndIf=
        #69=#69+1
        #25=#25+1
    EndIf1=

EndIf= 



[PROCESS17]    
EditBox8=Close


[PROCESS17-] Run STA

OnInterVal=0,Process17
;WinExec=%F0\Lib\STA.exe
WinExec=%F0\Lib\ra.exe /r
Command=Process18


[PROCESS18] Timer Loop On

    OnInterVal=2,Process19


[PROCESS19] im.txt loop

    OnInterVal=0,Process19
    FileExists=%F0\Lib\imdata.txt
    If=%1PF==P
        Command=Process18
    Else=
        Command=Process20
        ;OnInterVal=2,Process20
    EndIf=    
     
[PROCESS20] STA Terminate


    OnInterVal=0,Process20
    ;WinExec=TASKKILL /F /IM sendkeys.exe /T
    ;WinExec=%F0\Lib\eproc /f sendkeys
    ;WinExec=%F0\Lib\cepp1 /c Untitled - sendkeys
    ;MessageOK=Done!
    
    ;NewLogFile=New.bsj
    ;Winexec=kill bsnp505p
    
    
    ;EditBox3=Close
    ;BscanMaximize=Yes
    :00=
    :01=
    :02=
    :04=
    :05=
    :20=
    :21=                  
    :30=    

    ;Wait=2000

    ;ReadINI=@%F0\Lib\control.lst,MAIN,SendUsing,:65
    :65=%:97
    If=%:65!=ILLiad

    ;// /////////////////////////////////////////////////////////////////////
    ;// MODULE: Reporting
        ReadINI13=@%F0\Lib\Modules\ModuleState.bsi,MODULES,Reporting,:65
        If3=%:65==Enabled
            Call1=Process23,%F0\Lib\Modules\Reporting.bsa
        EndIf3=
        :65a=
    ;// END
    ;// ////////////////////////////////////////////////////////////////////
    
    ;Command=Config1
    
            ;// /////////////////////////////////////////////////////////////////////
        ;// MODULE: Reporting
                ReadINI13=@%F0\Lib\Modules\ModuleState.bsi,MODULES,Reporting,:65
                If3=%:65==Enabled
                    If=%:88==1
                        :88=
                        WinExec=notepad %F0\Lib\%F6\Logs\bscan_ariel_log.log
                    EndIf=
                EndIf3=
                :65a=
        ;// END
        ;// ////////////////////////////////////////////////////////////////////
    Else=
    
        FileExists=C:\BSCANILL\Lib\ILLiadLog.txt
        If=%1PF==P
            WinExec=notepad C:\BSCANILL\Lib\ILLiadLog.txt
        EndIf=
        
    EndIf=
        

[PROCESS26] Lookup TN
If0=%NP>0
#92a=0
Ifa=%#75==1
;ILL database enabled  
  ;:02a=%0-.-:02
  :05a=%0-.-:05
  ;Ifb=%-.-:02!=
  Ifb=%-.-:05!=
    ;IsNumeric1=:02
    IsNumeric1=:05
    Ifc=%1PF==P    
      ;ILLGetData5=%:02,:91,:92,:93,:94
      ILLGetData5=%:05,:91,:92,:93,:94
      If76=%1PF==P
        #92k=1
        ;docID
        :02i=%-.-:91
        
        Ifrt=%-.-:05!=%-.-:91
          ; TN different then :91-> :91 is a ILL number
          :04cv=%:91   
        Elsert=
          :04cc=                  
        EndIfrt=        
        
        ;ariel IP
        :01i=%-.-:92
       ; If71=%-.-:01!=
       ;    #87b=1
       ; EndIf71=         
        
        ;patron
        :00i=%0-.-:93
        
        ;delivery method        
        If56=%0-.-:94==0
        :30f=Email+Ftp
        EndIf56=
        If57=%0-.-:94==1
        :30f1=Ariel
        EndIf57=
        If58=%0-.-:94==2
        :30f2=ILLiad
        EndIf58=
        If59=%0-.-:94==3
        :30f3=Email
        EndIf59=
        If60=%0-.-:94==4
        :30f4=Odyssey
        EndIf60=
        If51=%0-.-:94==5
        :30f5=Save on Disk
        EndIf51=  

        EditFieldSetActive=1,111110
      EndIf76=
    EndIfc=
  EndIfb=

EndIfa=

Ifd=%#92==0
  ;If7=%-.-:02!=
  If7=%-.-:05!=
    ;MessageOK1=No information for transaction number %0-.-:02 is available!
    MessageOK1=No information for transaction number %0-.-:05 is available!
  Else7=
    ;MessageOK2=Transaction number field is empty. Please enter a transaction number in the DocID field.
    MessageOK2=Transaction number field is empty. Please enter a transaction number in the TN field.
  EndIf7=
Elsed=
Call=Process97
EndIfd=

EndIf0=

    
[PROCESS27] Open Setup
If=%#23==0
    ;// Root       = F0
    ;// Site       = F6
    ;// Scanner    = F7
    ;// Scanner IP = :11
    
    ReadINI1=@%AP\..\Lib\Control.lst,PATHS,Root,:03
    ReadINI2=@%AP\..\Lib\Control.lst,MAIN,Site,:06
    ReadINI3=@%AP\..\Lib\Control.lst,MAIN,Scanner,:07
    ReadINI4=BSCAN,BookeyeAddress,:11
    
    ;:03a=%F0
    ;:06a=%F6
    ;:07a=%F7

    :82=No ;// Ariel
    :83=No  ;// Email
    :84=No  ;// Email+FTP
    :62=No  ;// Odyssey
    :61=No  ;// ILLiad    
    ;;;;;:86=No  ;// User Defined
    
If=%:97==Ariel
    :82=Yes 
EndIf=

If=%:97==Email
    :83=Yes
EndIf=

If=%:97==Email+FTP  
    :84=Yes 
EndIf=    

If=%:97==Odyssey
    :62=Yes 
EndIf=

If=%:97==ILLiad
    :61=Yes 
EndIf=    

If=%:97==User
    ;;;;;;:86=Yes 
EndIf=    

    
      
    #66=0
    
;;    EditBox4=OpenLive
    
;;    If=%:68==
    ;// If first time configuring application. Disable "Close" button
;;        EditFieldSetActive=4,111111100000
;;        :11=
;;    Else=
    
;;        If=%:07!=ADF
            ;// Scanner selected is either Bookeye or Widetek
            
;;            EditFieldSetActive=4,111111111101
;;            If=%.-:11==
;;                EditFieldSetFocus=4,9,0,0
;;            EndIf=
;;        Else=
            ;// Scanner selected is ADF
            
;;            EditFieldSetActive=4,111111110010
;;        EndIf=
;;    EndIf=
;WinExec=C:\BSCANILL\Lib\IllExportSetup.exe
WinExec="C:\BSCANILL\Lib\Bscan ILL Setup.exe"
EndIf=

    
[PROCESS28] Module Check
    

    ReadINI1=@%F0\Lib\Modules\ModuleState.bsi,MODULES,%:08,:65
    
    If1=%:65==Enabled
        :09a=Yes
    Else1=
        :09b=No
    EndIf1=
    
    :65a=
    
[PROCESS29] Browse Button

    OnError=Continue
    
    ;// Open up file browse dialog    
    FileBrowseDir=C:\,:65
    
    ;// Set :03 (setup window 'Home' variable) to whatever the user selected in the browse dialog window
    :03a=%:65
    
    ;// Reset temporary variable
    :65a=

[PROCESS30] Setup Save Button

    
    FileExists=%:03\Lib\%:06
    If5=%1PF==F
        MessageOK=Site '%:06' does not exist! Please specify a known site.
    Else5=
        WriteIni1=@%F0\Lib\control.lst,PATHS,Root,%:03
        WriteIni2=@%F0\Lib\control.lst,MAIN,Site,%:06
        
        ;If=%F7!=%:07
            WriteIni3=@%F0\Lib\control.lst,MAIN,Scanner,%:07
            
            ;// put the correct information into runill.bat so that the correct executable is ran.
            FileExists=%F0\Lib\runill.bat
            If=%1PF==P
                FileDelete=%F0\Lib\runill.bat
            EndIf=
                
            FileOpen=4,%F0\Lib\runill.bat
            
            
            If=%:07!=ADF
                ;// Bookeye/WideTek
                WriteIni5=BSCAN,BookeyeAddress,%.-:11
                FileWrite=4,c:\bscan\illbookeye.exe /i=c:\bscanill\apps\illscan.bsa
            Else=
                ;// ADF
                FileWrite=4,c:\bscan\illadf.exe /i=c:\bscanill\apps\illscan.bsa
            EndIf=
            
            FileClose=4
            
        ;EndIf=
        
        ;// Pedal support
        WriteIni6=@%F0\Lib\control.lst,MAIN,Pedal,%:12        

        ;// Use OCR to read control sheet
        WriteIni6=@%F0\Lib\control.lst,MAIN,OCR,%:15

        ;Export mode (Ariel,Email,Ftp)
        ;WriteIni10=@%AP\..\Lib\Control.lst,MAIN,ExportToAriel,%:82
        ;WriteIni11=@%AP\..\Lib\Control.lst,MAIN,ExportToEmail,%:83
        ;WriteIni12=@%AP\..\Lib\Control.lst,MAIN,ExportToEmailFtp,%:84
        
        WriteIni14=@%AP\..\Lib\Control.lst,EMAIL,MaxEmailAttachSize,%:78
        WriteIni15=@%AP\..\Lib\Control.lst,EMAIL,EmailReturnEmail,%:75
        WriteIni16=@%AP\..\Lib\Control.lst,EMAIL,EmailSubjectText,%:76
        WriteIni17=@%AP\..\Lib\Control.lst,EMAIL,EmailMessageText,%:77
        WriteIni18=@%AP\..\Lib\Control.lst,FTP,FtpAddress,%:72
        WriteIni19=@%AP\..\Lib\Control.lst,FTP,FtpFilePath,%:73
        ;WriteIni20=@%AP\..\Lib\Control.lst,MAIN,ExportToOdyssey,%:62
        ;WriteIni21=@%AP\..\Lib\Control.lst,MAIN,ExportToIlliad,%:61
              
        ;;Set Send Using in lst file             
        :97=
        
        If=%:62==Yes
            WriteIni23=@%AP\..\Lib\Control.lst,MAIN,SendUsing,Odyssey
            :97=Odyssey
        EndIf=
        
        If=%:61==Yes
            WriteIni23=@%AP\..\Lib\Control.lst,MAIN,SendUsing,ILLiad
            :97=ILLiad
        EndIf=
        
        If=%:82==Yes
            WriteIni22=@%AP\..\Lib\Control.lst,MAIN,SendUsing,Ariel
            :97=Ariel
        EndIf=        

        If=%:83==Yes
            WriteIni22=@%AP\..\Lib\Control.lst,MAIN,SendUsing,Email
            :97=Email
        EndIf=        
        
        If=%:84==Yes
            WriteIni22=@%AP\..\Lib\Control.lst,MAIN,SendUsing,Email+Ftp
            :97=Email+Ftp
        EndIf=                        
        
        If=%:97==
          :97=Ariel
        EndIf=           
                        
        ;;;;// Set module state.
        ;;;
        ;;;    ;// Get module state from MODULES section and compare it to the current state in the setup window.
        ;;;    ;// If they don't match, set the module to whatever the value in the setup screen is. 
        ;;;    ;//
        ;;;    
        ;;;        
        ;;;        ;// Make sure the user has selected a module from the list, otherwise don't even bother doing anything.
        ;;;        If1=%:08!=
        ;;;            ;// Get the state of the current module selected in the setup screen.
        ;;;            ReadINI1=@%F0\Lib\Modules\ModuleState.bsi,MODULES,%:08,:65
        ;;;            
        ;;;            If4=%:65==
        ;;;            ;// If Module is not listed inside the app it means its not installed yet.
        ;;;                MessageOK=This module is not yet installed.
        ;;;                
        ;;;                ;// ADD CODE TO INSTALL MODULE HERE
        ;;;            Else4=
        ;;;                ;// Module is installed and we got the state of the module.
        ;;;                ;// Convert the checkbox to match the format of the state of the module in the [MODULES] section
        ;;;                ;// for comparison.
        ;;;                
        ;;;                If2=%:09==Yes
        ;;;                    :66a=Enabled
        ;;;                Else2=
        ;;;                    :66b=Disabled
        ;;;                EndIf2=
        ;;;                
        ;;;                ;// If the state of the module in the [MODULES] section does not match whatever the checkbox
        ;;;                ;// currently indicates, set the state of the module in the [MODULES] section to match whatever
        ;;;                ;// the checkbox currently indicates.
        ;;;                
        ;;;                If3=%:65!=%:66
        ;;;                    WriteINI4=@%F0\Lib\Modules\ModuleState.bsi,MODULES,%:08,%:66
        ;;;                EndIf3=
        ;;;            EndIf4=
        ;;;        EndIf1=
        
        
        MessageOK1=BSCAN ILL must be restarted in order for the changes to take effect!
        ;// :13 is a flag that is set if the state of a module was changed. Reset flag here because we're restarting
        :13=
        Command1=Process46
    EndIf5=

[PROCESS31] Module 'Check' Afterchange


    If1=%:08==
        :09a=No
    Else1=
    
        If2=%:09==No
            ;// If checkbox is unchecked -- write disabled to modulestate.bsi
            
            WriteINI=@%F0\Lib\Modules\ModuleState.bsi,MODULES,%:08,Disabled
            :13=1
        
        Else2=
            
            ;// If checkbox is checked -- write enabled to modulestate.bsi
            
            ;// CONDITION
            ;// Check if current module being modified is ImageTreatment/ImageTreatmentPlus
            ;// ImageTreatment can't be enabled if ImageTreatmentPLUS is enabled and vice versa 
            
            
            
                If=%:08==ImageTreatment
                    ReadINI=@%F0\Lib\Modules\ModuleState.bsi,MODULES,ImageTreatmentPLUS,:10
                    If=%:10==Enabled
                        MessageOK=You can not enable module 'ImageTreatment' because module 'ImageTreatmentPLUS' is already enabled. Please disable module 'ImageTreatmentPLUS' first!
                        :09=No
                        :10=
                    Else=
                        ;// If ImageTreatmentPLUS isn't enabled, go ahead and enable ImageTreatment
                    
                        WriteINI=@%F0\Lib\Modules\ModuleState.bsi,MODULES,%:08,Enabled
                        :10=
                        :13=1
                        
                    EndIf=
                
                Else=
                    If=%:08==ImageTreatmentPLUS
                        ReadINI=@%F0\Lib\Modules\ModuleState.bsi,MODULES,ImageTreatment,:10
                        If=%:10==Enabled
                            MessageOK=You can not enable module 'ImageTreatmentPLUS' because module 'ImageTreatment' is already enabled. Please disable module 'ImageTreatment' first!
                            :09=No
                            :10=
                        Else=
                            ;// If ImageTreatment isn't enabled, go ahead and enable ImageTreatmentPLUS
                    
                            WriteINI=@%F0\Lib\Modules\ModuleState.bsi,MODULES,%:08,Enabled
                            :10=
                            :13=1
                        EndIf=
                    Else=
                        WriteINI=@%F0\Lib\Modules\ModuleState.bsi,MODULES,%:08,Enabled
                        :10=
                        :13=1
                    EndIf=
                EndIf=
            
        EndIf2=
    EndIf1=
    
    

[PROCESS32] Resend Article - RESERVED
;// //////////////////////////////////////////////////////////////////////////////////
;// MODULE: ResendArticle
If=%#23==0
#33=0

    ;// /////////////////////////////////////////////////////////////////////
    ;// MODULE: Reporting
        ReadINI3=@%F0\Lib\Modules\ModuleState.bsi,MODULES,Reporting,:65
        If6=%:65==Enabled
            ;FileClose2=4
        EndIf6=
        :65f=
        
        ;ReadINI=@%F0\Lib\control.lst,MAIN,SendUsing,:65
        :65=%:97
        
        ;;If=%:65==Ariel
        
        ReadINI66=@%AP\..\Lib\Control.lst,ARIEL,Path,:89
        If66=%-.-:89!=
          ;Ariel path specified - take care of logs
          
            ;// Delete Ariel Log
            If=%1:87==3
                FileExists=C:\program files\RLG\Ariel\ARIEL.LOG
                If=%1PF==P
                  FileDelete5=C:\program files\RLG\Ariel\ARIEL.LOG
                EndIf=
                
                ;// Recreate Ariel Log
                FileMkDir=C:\program files\RLG\Ariel
                FileOpen4=4,C:\program files\RLG\Ariel\ARIEL.LOG
                FileClose4=4
            Else=
                If=%1:87==4
                    FileExists=C:\program files\Ariel\ARIEL.LOG
                    If=%1PF==P                
                      FileDelete5=C:\program files\Ariel\ARIEL.LOG
                    EndIf=
                    
                    ;// Recreate Ariel Log
                    FileMkDir=C:\program files\Ariel
                    FileOpen4=4,C:\program files\Ariel\ARIEL.LOG   
                    FileClose4=4         
                EndIf=
            EndIf=
            
            ;FileClose4=4            
        EndIf66=
        
    ;// END        
    ;// ///////////////////////////////////////////////////////////////////////

    
    WinExecWait=%F0\Lib\ra.exe
    
    FileExists=%F0\Lib\ra.don
    If=%1PF==P
        FileDelete=%F0\Lib\ra.don
        
        ;// Run report module
        
        wait=2000
        
        ;// /////////////////////////////////////////////////////////////////////
        ;// MODULE: Reporting
            ReadINI13=@%F0\Lib\Modules\ModuleState.bsi,MODULES,Reporting,:65
            If3=%:65==Enabled
                Call1=Process23,%F0\Lib\Modules\Reporting.bsa
            EndIf3=
            :65a=
        ;// END
        ;// ////////////////////////////////////////////////////////////////////
        
        ;messageok=ok
        Command=Config1
        
    Else=
        FileExists=%F0\Lib\ra.inf
        If=%1PF==P
            ;// Info file found. Read file to determine what to do.
            FileOpen=3,%F0\Lib\ra.inf
            :24=
            FileRead=3,:24            
            
            ;// Start new job
            ;;Call=Process88  
            If=%NP>0
              GoTo=End
            EndIf=
            
            #25=0
            
            While=%-.-:24!=  
              If=%1:24==O                
                    S9=%:24
                    #24=%LN(S9)
                    #24=%#24-2
                    :24=%2.(%#24):24
                    
                    #22=0
                    #16=0
                    ;// Determine if article is pdf or tiff
                    FileExists=%F2\%.-:24\%.-:24.tif
                    If1=%1PF==P
                      #22=1
                    Else1=
                      ; resend supports jpegs now too, just first image is always pull slip scanned as tiff...
                      FileExists=%F2\%.-:24\%.-:24\%4#16.tif
                      If2=%1PF==P  
                        #22=2
                      EndIf2=
                    EndIf1=
                    If=%#22>0
                        ;// Article is in tif format                   
                        If=%#22==1     
                          GetFileInfo=%F2\%.-:24\%.-:24.tif,N5,ImageCount                        
                          ScanFileSetPath=%F2\%.-:24\%.-:24.tif
                        Else=
                          ScanFileSetPath=%F2\%.-:24\%.-:24\%4#16.tif
                        EndIf=
                        
                       ;// Set flag for imagetreatment
                       :74a=1
                       C1=1
                       If=%NP>0
                         C2=C2+1
                       EndIf=
                       ReadINI=@%F2\%.-:24\resend.txt,INFO,Patron,:00
                       ReadINI=@%F2\%.-:24\resend.txt,INFO,IPEmail,:01
                       ReadINI=@%F2\%.-:24\resend.txt,INFO,DocID,:02
                       ReadINI=@%F2\%.-:24\resend.txt,INFO,Notes,:03
                       ;ReadINI=@%F2\%.-:24\resend.txt,INFO,Desc,:04                       
                       ReadINI=@%F2\%.-:24\resend.txt,INFO,DelMeth,:30
                       :04=
                       :05=
                       ReadINI=@%F2\%.-:24\resend.txt,INFO,ILLNumber,:04
                       ReadINI=@%F2\%.-:24\resend.txt,INFO,TN,:05
                       
                       If=%-.-:04%-.-:05==
                         ;resending old articles exported by previous version that did not support :04 and :05
                         If=%-.-:30!=
              
                          If=%0-.-:30==Email                  
                            :04=%:02                  
                          EndIf=
                            
                          If=%0-.-:30==Email+Ftp
                            :04=%:02
                          EndIf=

                          If=%0-.-:30==Ariel
                            :04=%:02
                          EndIf=   

                          If=%0-.-:30==Odyssey
                            :05=%:02    
                          EndIf=    
              
                          If=%0-.-:30==ILLiad                  
                            :05=%:02                  
                          EndIf= 

                          If=%0-.-:30==Save on Disk                    
                            :04=%:02                    
                          EndIf=                           
                          
                         EndIf=
                       EndIf=                       
                       
                       Call=Process87
                    Else=
                        ;FileExists=%F2\%.-:24\%.-:24.pdf
                        ;If=%1PF==P
                            ;// Article is in pdf format
                        ;    ScanFileSetPath=%F2\%.-:24\%.-:24.pdf
                        ;EndIf=
                        
                        ; unable to find multi image tiff with backup of images - unable to load this document
                        MessageOK=Unable to load document %0-.-:24!
                    EndIf=
                                                                                                                
              EndIf=
              :24=
              FileRead=3,:24
            EndWhile=
            
            FileClose=3
            FileDelete=%F0\Lib\ra.inf
            
            ;Command=MultiScan
        EndIf=
    EndIf=
EndIf=


[PROCESS87] ;scan entire multiimage from disk
#70=0
#33=1

#26=1

If0=%#22==1
While1=%#70<%N5

Command=ScanOne

;new page was scanned
Ifb=%#70==0
:74a=1
C1=1
Elseb=
:74b=
EndIfb=
UpdateLogEntry=Yes

#25=#25+1

#70=#70+1
EndWhile1=

Else0=

While2=%#16>=0
Command=ScanOne
;new page was scanned
Ifb=%#70==0
:74a=1
C1=1
Elseb=
:74b=
EndIfb=
UpdateLogEntry=Yes

#25=#25+1
#70=#70+1

#16=#16+1
FileExists=%F2\%.-:24\%.-:24\%4#16.tif
If=%1PF==P
   ScanFileSetPath=%F2\%.-:24\%.-:24\%4#16.tif
Else=
   FileExists=%F2\%.-:24\%.-:24\%4#16.jpg
   If5=%1PF==P
      ScanFileSetPath=%F2\%.-:24\%.-:24\%4#16.jpg
   Else5=
     #16=-1
   EndIf5=
EndIf=
 
EndWhile2=
EndIf0=
ScanFileSetPath=    

#33=0
#26=0

    
[PROCESS34] Module 'ImageTreament'


    OcrShowZones=Yes
    
Ifm=%1C1!=1
    
    #40zz=%.-:40
    #41zz=%.-:41
    #42zz=%.-:42
    #43zz=%.-:43
    
    #44zz=%.-:44
    #45zz=%.-:45
    #46zz=%.-:46
    #47zz=%.-:47
    
    #36a=%R0
    #37a=%R1
    #38a=%R2
    #39a=%R3
    
    ;If13=%#80!=3
        If9=%#36>%#40
            If10=%#37>%#41
                If11=%#38<%#42
                    If12=%#39<%#43
                            OcrClearZones=Yes
                            OcrShowZones=Yes
                            If19=%:44!=
                                If=%:46!=
                                    SetRegion1=%:44,%:45,%:46,%:47,213,219,249
                                EndIf=
                            EndIf19=
                        
                            ;// Set a flag so that if the user has clicked on an area that both box1 and box2 occupy it will
                            ;// only erase box #1 by default.
                            :63a=1
                    EndIf12=
                EndIf11=
            EndIf10=
        EndIf9=
    ;EndIf13=
    
        If14=%#36>%#44
            If15=%#37>%#45
                If16=%#38<%#46
                    If17=%#39<%#47
                        ;If18=%:63!=1
                            OcrClearZones=Yes
                            OcrShowZones=Yes
                            If20=%:40!=
                                SetRegion2=%:40,%:41,%:42,%:43,213,219,249
                            EndIf20=
                            
                            ;// Reset flag
                            :63b=
                            :64a=1
                            ;// Reset trigger and coords so that we can redraw again.
                            ;:50a=
                            ;:40z=
                            ;:41z=
                            ;:42z=
                            ;:43z=
                            ;UpdateLogEntry=Yes
                        ;EndIf18=
                    EndIf17=
                EndIf16=
            EndIf15=
        EndIf14=
    
    
    
    If8=%:50!=1
        If19=%:64!=1
            #80h=0
        EndIf19=
    EndIf8=
    
    If3=%#80==1
        #80c=2
    EndIf3=
    
    If4=%#80==3
        #80d=4
    EndIf4=
    
    If6=%#80==5
        #80f=6
    EndIf6=
    
    If1=%#80==0
        :40a=%R0
        :41a=%R1
        #80a=1
        :50a=1
        :63a=
        :64a=
    EndIf1=
    
    ;// Draw box 1
    
    If2=%#80==2
        :42a=%R2
        :43a=%R3
        
        ;// Force the user to go from left to right. If they click on the bottom right and then top left, popup usr msg.
        ;// #36 = current %R0
        ;// #40 = first %R0
        
        If=%#36<%#40
            MessageOK=Invalid Region - Please Re-Draw Region.
            ;// reset variables so that user has to redraw box 1.
            :40=
            :41=
            :42=
            :43=
            #80=
            :63=
            :64=
            UpdateLogEntry=Yes
        Else=
        
            ;// require a minimum of 300 pixels wide.
            #20=%#36-%#40
            
            If=%#20>=300
        
                #21=%#37-%#41
        
                If=%#21>=300
                    
                    SetRegion1=%:40,%:41,%:42,%:43,213,219,249
                    #80b=3
                    UpdateLogEntry1=Yes
                Else=
                    MessageOK=Region too small - Please Re-draw region.
                    ;// reset variables so that user has to redraw box 1.
                    :40=
                    :41=
                    :42=
                    :43=
                    #80=
                    :63=
                    :64=
                    UpdateLogEntry=Yes
                EndIf=                    
                
            Else=
                MessageOK=Region too small - Please Re-Draw Region.
                ;// reset variables so that user has to redraw box 1.
                :40=
                :41=
                :42=
                :43=
                #80=
                :63=
                :64=
                UpdateLogEntry=Yes
            EndIf=
        EndIf=
    EndIf2=
    
    If5=%#80==4
        Ifx=%:44==
            Ifx1=%:63!=1
                :44a=%R0
                :45a=%R1
                #80e=5
            EndIfx1=
        EndIfx=
    EndIf5=
    
    ;// Draw box #2
    
    If7=%#80==6
        :46a=%R2
        :47a=%R3
        
        ;// Force the user to go from left to right. If they click on the bottom right and then top left, popup usr msg.
        ;// #36 = current %R0
        ;// #44 = first %R0
        
        Ifz=%#36<%#44
            MessageOK=Invalid Region - Please Re-Draw Region.
            ;// reset variables so that user has to redraw box 1.
            :44=
            :45=
            :46=
            :47=
            #80=3
            :63=
            :64=
            UpdateLogEntry=Yes
            SetRegion=%:40,%:41,%:42,%:43,213,219,249
        Elsez=
            
            ;// require a minimum of 300 pixels wide.
            #20=%#36-%#44
            
            If=%#20>=300
                
                #21=%#37-%#45
        
                If=%#21>=300
                
                    SetRegion2=%:44,%:45,%:46,%:47,213,219,249
                    #80g=7
                    UpdateLogEntry2=Yes
                Else=
                    MessageOK=Region too small - Please Re-Draw Region.
                    ;// reset variables so that user has to redraw box 1.
                    :44=
                    :45=
                    :46=
                    :47=
                    #80=3
                    :63=
                    :64=
                    UpdateLogEntry=Yes
                EndIf=
            Else=
                MessageOK=Region too small - Please Re-Draw Region.
                ;// reset variables so that user has to redraw box 1.
                :44=
                :45=
                :46=
                :47=
                #80=3
                :63=
                :64=
                UpdateLogEntry=Yes
            EndIf=
            
        EndIfz=
    EndIf7=
    
    If14=%:63==1
        ;// Reset trigger and coords so that we can redraw again.
        :50a=
        :40z=
        :41z=
        :42z=
        :43z=
        UpdateLogEntry=Yes
    EndIf14=
    
    If15=%:64==1
        ;// If we've cleared box 1 and 2
        If16=%:40==
            :50z=
            :44z=
            :45z=
            :46z=
            :47z=
            :64=
            UpdateLogEntry=Yes
        Else16=
        ;// If we've only clearned box 2
            #80a=3
            :44=
            :45=
            :46=
            :47=
            :64=
            UpdateLogEntry=Yes
        EndIf16=
    EndIf15=
EndIfm=
    
[PROCESS37--] Module 'ImageTreatment' Proc

    Goto=Home

    ;// ////////////////////////////////////////////////////////////////////
    ;// MODULE: ImageTreatment
        ReadINI15=@%F0\Lib\Modules\ModuleState.bsi,MODULES,ImageTreatment,:65
        If3=%:65==Enabled
                Call1=Process35,%F0\Lib\Modules\ImageTreatment.bsa
                NewLogFile=%:66
                :66a=
                Goto1=Home
        EndIf3=
        :65z=
    ;// END
    ;// ////////////////////////////////////////////////////////////////////
    
[PROCESS38] Rescan
If=%#23==0
If=%#02==1
  #53=0
  #56=0
    If=%NP!=
        If=%F7==ADF                        
            If=%-.-F8==
              Command=ReScanOne
            Else=
              If=%-.-F8==Minolta
                Command=ReScanOneWait
              EndIf=
              If=%8F8==Bookedge
                #56=1
                Command=ReScanOne
              EndIf=              
            EndIf=            
            
        Else=
            If=%NP==0
              BookeyeSetting=FileFormat(Tif),DPI(300)
            Else=
              BookeyeSetting=FileFormat(Tif)
            EndIf=
            
            Call=Process104
            
            If=%:12==Yes
                Command=ReScanOneBookeyeWait
            Else=
                Command=ReScanOneBookeye
            EndIf=

        EndIf=
    Else=
        MessageOK=There are no pages to 'RESCAN' Please 'SCAN' a page first.
    EndIf=
EndIf=
EndIf=


[PROCESS39] OnNewImage



    ;// Refresh any Image Treatment regions if they exists
        
        
        If=%:50!=
            OCRClearZones=Yes
            OCRShowZones=Yes
            
            If=%:40!=
                SetRegion=%.-:40,%.-:41,%.-:42,%.-:43,213,219,249
            EndIf=
            
            If=%:44!=
                SetRegion=%.-:44,%.-:45,%.-:46,%.-:47,213,219,249
            EndIf=
        EndIf=


[PROCESS40-] Setup Close Button
        
        ;// :13 is a flag that is set when a module state has changed in the setup window. Don't allow the user to close the setup window
        ;// if this flag has been set. Pop up a message and let the user hit the 'save' button.
        
        If=%:13==1
            MessageOK=Changes were made, Please save your changes!
        Else=
        
          ; just close was hit - do not save Save using
          If=%:97==Ariel
            :82=Yes
          EndIf=

          If=%:97==Email
            :83=Yes
          EndIf=

          If=%:97==Email+FTP  
            :84=Yes 
          EndIf=    

          If=%:97==Odyssey
            :62=Yes 
          EndIf=

          If=%:97==ILLiad
            :61=Yes 
          EndIf=    
 
          If=%:97==User
            ;;;:86=Yes 
          EndIf=         
        
          EditBox4=Close
        EndIf=
    
[PROCESS41] Scanner List Afterchange

    
    If=%:68==
        ;// First time configuring application, disable the 'Close' button
        
        If=%:07!=ADF
            ;// Scanner selected is either Bookeye or Widetek
            
            EditFieldSetActive=4,111111101101
        Else=
            ;// Scanner selected is ADF
            
            EditFieldSetActive=4,111111100010
        EndIf=
    Else=
        If=%:07!=ADF
            ;// Scanner selected is either Bookeye or Widetek
            
            EditFieldSetActive=4,111111111101
        Else=
            ;// Scanner selected is ADF
            
            EditFieldSetActive=4,111111110010
        EndIf=
    EndIf=


[PROCESS42] Bookeye or widetek scanner setup

    Command=ScanSettingsBookeye
    
[PROCESS43] ADF scanner setup

    Command=ScanSettings

[PROCESS44] ; print button pressed
If=%#23==0
#20a=0
:90a=
;:96a=Rotate
:95a=DoNotSkip
:98a=Current Image
:80a=1
EditBox10=OpenLive
EndIf=


[PROCESS105] ; print dialog OK pressed
#20a=1
EditBox10=Close

[PROCESS106] ; print dialog Cancel pressed
#20a=0
EditBox10=Close

[PROCESS107] ; after change radio
:99=111111
If1=%0-.-:98!=Range
; turn off range edit field
:90=
:99=%1:990%2.:99

If2=%0-.-:98==Current Image
; turn off skip pull slip checkbox
:95=DoNotSkip
:99=%2:990%3.:99
EndIf2=
EndIf1=

EditFieldSetActive=10,%0-.-:99


[PROCESS109] ; parse range value #-#
#95=0
#97=0
#80=0
#98=0
:90=%-.-:90
If0=%-.-:90!=
#94=%LN(:90)
While=%#80<%#94
If1=a%(#80).1:90==a-
#98=#98+1
Else1=

#99=%(#80).1:90
If=%#99>=0
If=%#99<=9
If2=%#98==0
#95=#95*10
#95=#95+%#99
EndIf2=

If3=%#98==1
#97=#97*10
#97=#97+%#99
EndIf3=

EndIf=
EndIf=

EndIf1=
#80=#80+1
EndWhile=
EndIf0=


[PROCESS40] ; print dialog closed
If0=%#20==1
;:98 -selection (Current Image,Current Article,All,Range)
;:90 -range
;:96 -Rotate to fit (DoNotRotate,Rotate)
;:95 -Skip pull slips (DoNotSkip,Skip)
;:80 -copies to print
#93=%NP
Ifb=%0-.-:98==Range
; is range value valid ##-##
;#95-#97
#90=-1
Call=Process109
If=%#95>0
If=%#97>0
#95=#95-1
#97=#97-1
#90=#97-#95
EndIf=
EndIf=
If=%#90<0
#93=0
EndIf=
EndIfb=

If1=%#93>0
If2=%0-.-:98==Current Image
;If2b=%-.-:96==Rotate
;PrintImage1=%-.-:80,fittopage,rotatetofit
;Else2b=
PrintImage2=%-.-:80,fittopage
;EndIf2b=
#90=%PN+1
MessageOK=Image #%#90 Printed!
Else2=
UpdateView=No
#90a=%PN

If31=%0-.-:98==Current Article
#91a=0
While=%#91==0
If4=%1:74==1
#91b=1
Else4=
If5=%PN>0
PN=PN-1
Else5=
#91b=1
EndIf5=
EndIf4=
EndWhile=
EndIf31=

If32=%0-.-:98==All
PN=0
EndIf32=

If33=%0-.-:98==Range
PN=%#95
EndIf33=

; go forward and print
#98=0
#80=0

While=%#98==0
If6=%1:74==1
If7=%-.-:95!=Skip
#80=#80+1
;If2b=%-.-:96==Rotate
;PrintImage3=%-.-:80,STARTDOC,fittopage,rotatetofit
;Else2b=
PrintImage4=%-.-:80,STARTDOC,fittopage
;EndIf2b=
EndIf7=
Else6=
#80=#80+1
;If2b=%-.-:96==Rotate
;PrintImage5=%-.-:80,STARTDOC,fittopage,rotatetofit
;Else2b=
PrintImage6=%-.-:80,STARTDOC,fittopage
;EndIf2b=
EndIf6=

; test if we are done or go to next page

If7a=%PN<%LP

If33=%0-.-:98==Range
If=%PN>=%#97
; last page from range was printed - terminate
#98=1
EndIf=
EndIf33=

Else7a=
#98=1
EndIf7a=

If=%#98==0
PN=PN+1
If6=%1:74==1
If31=%0-.-:98==Current Article
;next article began-exit
#98=1
EndIf31=
EndIf6=
EndIf=

EndWhile=

If8=%#80>0
;If2b=%-.-:96==Rotate
;PrintImage7=0,ENDDOC,fittopage,rotatetofit
;Else2b=
PrintImage8=0,ENDDOC,fittopage
;EndIf2b=
EndIf8=

PN=%#90
UpdateView=Yes

If=%#80==1
MessageOK=Image Printed!
Else=
If=%#80>1
MessageOK=Images Printed!
EndIf=
EndIf=

EndIf2=
EndIf1=
EndIf0=


[PROCESS68] ; on open edit 10
EditFieldClearLST=10,4
EditFieldAddItemInLST=10,4,1
EditFieldAddItemInLST=10,4,2
EditFieldAddItemInLST=10,4,3
EditFieldAddItemInLST=10,4,4
EditFieldAddItemInLST=10,4,5
EditFieldAddItemInLST=10,4,6
EditFieldAddItemInLST=10,4,7
EditFieldAddItemInLST=10,4,8
EditFieldAddItemInLST=10,4,9
EditFieldAddItemInLST=10,4,10
Call=Process107

[PROCESS45]

[PROCESS45-]

OnError=Continue

MessageYesNo1=N6,Was not able to connect to Bookeye/WideTek on IP: '%.-:11'. Please check to make sure the device is turned ON and the IP is correct. - Open Setup screen to modify IP? Click 'Yes' to Open setup screen. Click 'No' to close BSCAN ILL.

If1=%N6==1
    Command2=Process27
Else1=
    Command1=Process46
EndIf1=     

[PROCESS46] Exit BSCAN
If=%#23==0
Ifb=%#51<0
        MessageYesNo=N9,Are you sure you want to exit BSCAN ILL?
    
        If=%N9==1
            Exit=Yes
        EndIf=
Elseb=
  #51=#51+1
  MessageOK=Modified page %#51 has not been saved yet! Please save or restore it before exiting!
  #51=#51-1
EndIfb=  
EndIf=

                      
[PROCESS47] Clear ImageTreatment Zones

    If=%:50!=
        OCRClearZones=Yes
        OCRShowZones=Yes
        :40=
        :41=
        :42=
        :43=
        :44=
        :45=
        :46=
        :47=
        :50=
        #80=
        :63=
        :64=
        UpdateLogEntry=Yes
    EndIf=
    
[PROCESS48] Set Color
If=%#02==1

    If=%#81!=1
        If=%#82!=1
          If=%#83!=1
            If=%:81==1
                Command=ScanOne
            Else=             

             If0=%F7==ADF
              ;If=%F8==Bookedge STD/LED
              If=%8F8==Bookedge
                ;Set color                                
                ScanParameterSetBitsPerPixel=24
		ScanSaveAdvancedSettings=%AF,CONFIG1
                WriteINI=CONFIG1,ScanBitsPerPixel,24
                WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\SetBW-long.gif,0,116,191,29
                WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,191,116,93,29
                WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor-pressed.gif,284,116,98,29
              Else=
                WriteINI=CONFIG1,ButtonProcess48,
                WriteINI=CONFIG1,ButtonProcess49,
                WriteINI=CONFIG1,ButtonProcess50,              
  	      EndIf=
             Else0= 
              If=%F8!=Rebel

                If1=%#54==1
                  ;; if color is supported -> set it

                  ;BookeyeSetting=FileFormat(jpg),Color(Color),DPI(300),Splitting(Off),ScanMode(Flat),Format(auto)
                  ;BookeyeSetting=FileFormat(tif),Color(Color),DPI(300),Splitting(Off),ScanMode(Flat),Format(auto)
                  BookeyeSetting=Color(Color),Compression(uncompressed)
                  ;:74b=0
                  ;If=%:12==Yes
                  ;    Command=MultiScanBookeyeWait
                  ;Else=
                  ;    Command=ScanOneBookeye
                  ;EndIf=
                
                  ;seve into [BOOKEYE]
                  WriteINI=BOOKEYE,colormode,truecolor
                  WriteINI=BOOKEYE,tiff_compr,none

                  ;change button to pressed button
                  ;WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor-pressed.gif,0,87+%#72,93,29
                  ;WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,58+%#72,93,29                
                  ;WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,58+%#72,98,29                
                  WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor-pressed.gif,191,87+%#72,93,29
                  WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,87+%#72,93,29                
                  WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,87+%#72,98,29                
		EndIf1=                
              Else=
                RebelSetColor=Color

                ;change button to pressed button
                ;WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor-pressed.gif,0,87+%#72,93,29
                ;WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,58+%#72,93,29                
                ;WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,58+%#72,98,29                
                WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor-pressed.gif,191,87+%#72,93,29
                WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,87+%#72,93,29                
                WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,87+%#72,98,29                
              EndIf=
                             

	     EndIf0=
             If1=%#54==1
                ExecuteFaceliftButtonReload=yes                
                Command=Config1                
             EndIf1=
            EndIf= 
            ;#81=   
            ;#82=   
          Else=  
            Messageok=Please specify TN before continuing.
            ;// Set IP/Email exception                                
            #83=1                                                     
            ;// Clear 'IP/Email' field                                
            ;:02=
            :05=
            EditFieldSetFocus=1,4,0,30            
          EndIf=
        Else=      
            ;Messageok=Please specify a Doc ID before continuing.
            Messageok=Please specify ILL Number before continuing.
            ;// Set IP/Email exception                                
            #82=1                                                     
            ;// Clear 'IP/Email' field                                
            ;:02=
            :04=
            EditFieldSetFocus=1,3,0,30                                
        EndIf=     
    Else=          
        Messageok=Please specify an IP or email before continuing.
        ;// Set IP/Email exception
        #81=1                     
        ;// Clear 'IP/Email' field
        :01=                      
        EditFieldSetFocus=1,2,0,30              
    EndIf=         
EndIf=   
       
         
[PROCESS49] Set Gray
If=%#02==1         
    If=%#81!=1
        If=%#82!=1
          If=%#83!=1
            If=%:81==1
                Command=ScanOne
            Else=
             If0=%F7==ADF
              ;If=%F8==Bookedge STD/LED
              If=%8F8==Bookedge
                ;Set Gray
                ScanParameterSetBitsPerPixel=8
		ScanSaveAdvancedSettings=%AF,CONFIG1
                WriteINI=CONFIG1,ScanBitsPerPixel,8
                WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\SetBW-long.gif,0,116,191,29
                WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray-pressed.gif,191,116,93,29
                WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,284,116,98,29
              Else=
                WriteINI=CONFIG1,ButtonProcess48,
                WriteINI=CONFIG1,ButtonProcess49,
                WriteINI=CONFIG1,ButtonProcess50,              
  	      EndIf=
             Else0=             
              If=%F8!=Rebel
                ;BookeyeSetting=FileFormat(jpg),Color(Color),DPI(300),Splitting(Off),ScanMode(Flat),Format(auto)
                ;BookeyeSetting=FileFormat(tif),Compression(G4),Color(Gray),DPI(300),Splitting(Off),ScanMode(Flat),Format(auto)
                BookeyeSetting=Color(Gray),Compression(uncompressed)
                ;:74b=0
                ;If=%:12==Yes
                ;    Command=MultiScanBookeyeWait
                ;Else=
                ;    Command=ScanOneBookeye
                ;EndIf=
                
                ;seve into [BOOKEYE]
                WriteINI=BOOKEYE,colormode,grayscale
                WriteINI=BOOKEYE,tiff_compr,none
              Else=                  
                RebelSetColor=Grayscale
              EndIf=                                                  
                ;change button to pressed button
                ;WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray-pressed.gif,93,58+%#72,98,29                
                ;WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,58+%#72,93,29                
                ;WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,0,87+%#72,93,29
                WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray-pressed.gif,93,87+%#72,98,29                
                WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw.gif,0,87+%#72,93,29                
                If1=%#54==1
                  ;; if color is supported -> enable button
                  WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,191,87+%#72,93,29                
       		Else1=
                  WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcoloroff.gif,191,87+%#72,93,29  
		EndIf1=
	     EndIf0=                
                ExecuteFaceliftButtonReload=yes
                Command=Config1 
                                
            EndIf= 
            ;#81=   
            ;#82=   
          Else=  
            Messageok=Please specify TN before continuing.
            ;// Set IP/Email exception                                
            #83=1                                                     
            ;// Clear 'IP/Email' field                                
            ;:02=
            :05=
            EditFieldSetFocus=1,4,0,30            
          EndIf=
        Else=      
            Messageok=Please specify ILL Number before continuing.
            ;// Set IP/Email exception                                
            #82=1                                                     
            ;// Clear 'IP/Email' field                                
            ;:02=                                                      
            :04=
            EditFieldSetFocus=1,3,0,30                                
        EndIf=     
    Else=          
        Messageok=Please specify an IP or email before continuing.
        ;// Set IP/Email exception
        #81=1                     
        ;// Clear 'IP/Email' field
        :01=                      
        EditFieldSetFocus=1,2,0,30              
    EndIf=  
EndIf=


[PROCESS50] Set B&W
If=%#02==1
    If=%#81!=1
        If=%#82!=1
          If=%#83!=1
            If=%:81==1
                Command=ScanOne
            Else=
             If0=%F7==ADF
              ;If=%F8==Bookedge STD/LED
              If=%8F8==Bookedge
                ;Set B&W
                ScanParameterSetBitsPerPixel=1
		ScanSaveAdvancedSettings=%AF,CONFIG1
                WriteINI=CONFIG1,ScanBitsPerPixel,1
                WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\SetBW-long-pressed.gif,0,116,191,29
                WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,191,116,93,29
                WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,284,116,98,29
              Else=
                WriteINI=CONFIG1,ButtonProcess48,
                WriteINI=CONFIG1,ButtonProcess49,
                WriteINI=CONFIG1,ButtonProcess50,              
  	      EndIf=
  	                    
             Else0=             
              If=%F8!=Rebel
                ;BookeyeSetting=FileFormat(jpg),Color(Color),DPI(300),Splitting(Off),ScanMode(Flat),Format(auto)
                ;BookeyeSetting=FileFormat(tif),Compression(G4),Color(B&W),DPI(300),Splitting(Off),ScanMode(Flat),Format(auto)
                
                BookeyeSetting=Color(B&W),Compression(G4)
                ;:74b=0
                ;If=%:12==Yes
                ;    Command=MultiScanBookeyeWait
                ;Else=
                ;    Command=ScanOneBookeye
                ;EndIf=
                                
                ;seve into [BOOKEYE]
                WriteINI=BOOKEYE,colormode,lineart
                WriteINI=BOOKEYE,tiff_compr,g4
              Else=                     
                RebelSetColor=Bitonal
              EndIf=
                                                
                ;change button to pressed button                
                ;WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw-pressed.gif,0,58+%#72,93,29                
                ;WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,58+%#72,98,29                
                ;WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,0,87+%#72,93,29
                WriteINI=CONFIG1,ButtonProcess50,@%F0\Lib\icons\new\images\setbw-pressed.gif,0,87+%#72,93,29                
                WriteINI=CONFIG1,ButtonProcess49,@%F0\Lib\icons\new\images\setgray.gif,93,87+%#72,98,29                
                If1=%#54==1
                  ;; if color is supported -> enable button
                  WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcolor.gif,191,87+%#72,93,29                
       		Else1=
                  WriteINI=CONFIG1,ButtonProcess48,@%F0\Lib\icons\new\images\setcoloroff.gif,191,87+%#72,93,29  
		EndIf1=
             EndIf0=
                ExecuteFaceliftButtonReload=yes
                Command=Config1
                
            EndIf= 
            ;#81=   
            ;#82=   
          Else=  
            Messageok=Please specify TN before continuing.
            ;// Set IP/Email exception                                
            #83=1                                                     
            ;// Clear 'IP/Email' field                                
            ;:02=
            :05=
            EditFieldSetFocus=1,4,0,30            
          EndIf=            
        Else=      
            Messageok=Please specify ILL Number before continuing.
            ;// Set IP/Email exception                                
            #82=1                                                     
            ;// Clear 'IP/Email' field                                
            ;:02=                                                      
            :04=                                                      
            EditFieldSetFocus=1,3,0,30                                
        EndIf=     
    Else=          
        Messageok=Please specify an IP or email before continuing.
        ;// Set IP/Email exception
        #81=1                     
        ;// Clear 'IP/Email' field
        :01=                      
        EditFieldSetFocus=1,2,0,30              
    EndIf=  
EndIf=
    

[PROCESS90] ;  button to turn auto scan mode ON
If=%#23==0
If=%#02==1
WriteINI=CONFIG1,ButtonProcess90,                             
WriteINI=CONFIG1,ButtonProcess91,@%F0\Lib\icons\new\images\highspeed-pressed.gif,0,58,191,29  
WriteINI=CONFIG1,ButtonProcess92,@%F0\Lib\icons\new\images\resetscanarea.gif,191,58,191,29
#73=1

; store current setting
:16=
:28=

BookeyeSettingGet=S9,Splitting
If=%1PF==P
  If=%-.-:16==
    :16=Splitting(%0-.-S9)
  Else=                    
    :16=%0-.-:16,Splitting(%0-.-S9)
  EndIf=
EndIf=
                                        
BookeyeSettingGet=S9,ScanMode
If=%1PF==P
  If=%-.-:16==
    :16=ScanMode(%0-.-S9)
  Else=
    :16=%0-.-:16,ScanMode(%0-.-S9)
  EndIf=
EndIf=
					
BookeyeSettingGet=S9,Format
If=%1PF==P
  If=%-.-:16==
    :16=Format(%0-.-S9) 
  Else=
    :16=%0-.-:16,Format(%0-.-S9)                                       
  EndIf=
EndIf=

BookeyeSettingGet=S9,AutoBrightness
If=%1PF==P
  If=%-.-:16==
    :16=AutoBrightness(%0-.-S9) 
  Else=
    :16=%0-.-:16,AutoBrightness(%0-.-S9)
  EndIf=
  If=%-.-:28==
    :28=AutoBrightness(%0-.-S9)
  Else=
    :28=%0-.-:28,AutoBrightness(%0-.-S9)    
  EndIf=  
  BookeyeSetting=AutoBrightness(Off)
EndIf=

BookeyeSettingGet=S9,AutoFocus
If=%1PF==P
  If=%-.-:16==
    :16=autofocus(%0-.-S9)
  Else=
    :16=%0-.-:16,autofocus(%0-.-S9)
  EndIf=
  If=%-.-:28==
    :28=autofocus(Skip)
  Else=
    :28=%0-.-:28,autofocus(Skip)    
  EndIf=
  BookeyeSetting=autofocus(On)
EndIf=

#00=1

;AutoUserAreaToggle=ON
AutoUserAreaToggle=%#84
ExecuteFaceliftButtonReload=yes
Command=Config1
EndIf=
EndIf=


[PROCESS91] ;  button to turn auto scan mode OFF
If=%#23==0
If=%#02==1
WriteINI=CONFIG1,ButtonProcess90,@%F0\Lib\icons\new\images\highspeed.gif,0,58,191,29
WriteINI=CONFIG1,ButtonProcess91,
WriteINI=CONFIG1,ButtonProcess92,@%F0\Lib\icons\new\images\resetscanareaoff.gif,191,58,191,29
#73=0               
; set setting back that was before auto mode
If=%-.-:16!=
  BookeyeSetting=%:16 
EndIf=
:28=

AutoUserAreaToggle=OFF
ExecuteFaceliftButtonReload=yes
Command=Config1
EndIf=
EndIf=


[PROCESS92] ; reset auto scan mode status mode
If=%#23==0
If=%#02==1
If=%#73!=0
If=%F7!=ADF
If=%8F8!=Bookedge
If=%F8!=Minolta
  S9=
  ReadINI=CONFIG1,ButtonProcess91,S9
  S9=%-.-S9
  If=%S9!=
    ;need to force auto brightness off in case Fast scan is turned ON
    BookeyeSetting=AutoBrightness(Off)
    #00=1
    BookeyeSettingGet=S9,AutoFocus
    If=%1PF==P
      BookeyeSetting=autofocus(On)
    EndIf=
  EndIf=
AutoUserAreaReset=Yes
EndIf=
EndIf=
EndIf=
EndIf=
EndIf=
EndIf=


[PROCESS89] ;Scan Multi
OnInterval=0,Process89 

If=%#23==0
If=%#02==1
#13=0
#56=0
#53=0
If=%NP>0
    If=%#81!=1
        If=%#82!=1
          Ifa=%#83!=1
            If=%PN<%LP
              PN=%LP
            EndIf=
                        
            :74b=0
                 
            If0=%F8!=Rebel           
              ;// If foot pedal turned on
              If=%:12==Yes
                If=%F7==Widetek
                   If=%NP==0
                     BookeyeSetting=FileFormat(Tif),DPI(300),Format(auto)
                   Else=
                     BookeyeSetting=FileFormat(Tif),Format(auto)
                   EndIf=
                   Call=Process104
                   
                   Call=Process102
                   ;Command=MultiScanBookeyeWait
                Else=
                    If=%F7==Bookeye
                        ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Status,:65
                        
                        ;;;If=%:65==On
                        ; turn off the default settings-we do not use it
                        If=%:65==xxxxxxxxxxx
                            
                            ;// check/set format
                            ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Format,:65
                            
                            If=%:65!=
                                BookeyeSetting=Format(%:65)
                            EndIf=
                            
                            ;// check/set scanmode
                            ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,ScanMode,:65
                            
                            If=%:65!=
                                BookeyeSetting=ScanMode(%:65)
                            EndIf=
                            
                            ;// check/set Splitting
                            ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Splitting,:65
                            
                            If=%:65!=
                                BookeyeSetting=Splitting(%:65)
                            EndIf=
                            
                            ;// Set global defaults
                            
                            If=%NP==0
                              BookeyeSetting=FileFormat(Tif),DPI(300)
                            Else=
                              BookeyeSetting=FileFormat(Tif)
                            EndIf=
                            
                            ;// Determine if user has auto and both on the panel. If they do, scan twice.
                            
                           ; BookeyeSettingGet=:65,Format
                           ; If=%:65==Auto
                           ;     BookeyeSettingGet=:65,Splitting
                           ;     If=%:65==Auto
                           ;         Command=ScanOneBookeye
                           ;     EndIf=
                           ; EndIf=
                            
                            Call=Process102
                            ;Command=MultiScanBookeyeWait                            
                        
                        Else=
                            ;// Set global defaults
                            If=%NP==0
                              BookeyeSetting=FileFormat(Tif),DPI(300)
                            Else=
                              BookeyeSetting=FileFormat(Tif)
                            EndIf=
                            
                            Call=Process104
                            
                            Call=Process102
                            ;Command=MultiScanBookeyeWait                            
                        EndIf=
                    EndIf=
                    
                    If=%F7==ADF
                      ;If=%:12==Yes
                      If=%-.-F8==Minolta
                        ;if TWAIN - ADF+pedal (MINOLTA)
                        Command=MultiScanWait
                      Else=  
                        If=%8F8==Bookedge
 			  If=%#52==2
 			    ; scan and rotate every other page
 			    #53=2
 			    Ifb=%0-.-:29==Left side
                              #55=0
                            Elseb=
                              ;Right side
                              #55=1
                            EndIfb=
                            Command=MultiScanWait
 			  Else=
 			    If=%#52==0                                                                     
                              Command=MultiScanWait
                            Else=
                              ;cancel was pressed
                              #52=0
                              
                              If=%F8==Bookedge STD/LED
                                ;restore scanner settings
                                Command=Config1                              
                              EndIf=
                            EndIf=
                          EndIf=
                        Else=
                          Command=MultiScan                          
                        EndIf=
                      EndIf=
                    EndIf=
                                        
                EndIf=
              Else=
              ;// Foot pedal turned off
                
                ;// If scan from disk is enabled
                If=%:81==1
                    Command=MultiScan
                Else=
                    If=%F7==Widetek
                      If=%NP==0
                        BookeyeSetting=FileFormat(Tif),DPI(300),Format(auto)
                      Else=
                        BookeyeSetting=FileFormat(Tif),Format(auto)
                      EndIf=    
                              
                      Call=Process104
                                          
                      Call=Process102
                      ;Command=MultiScanBookeyeWait                        
                    Else=
                        If=%F7==Bookeye
                        
                            ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Status,:65
                            
                            ;;;;If=%:65==On
                            ; turn off the default settings-we do not use it
                            If=%:65==xxxxxxxxxxx
                                
                                ;// check/set format
                                ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Format,:65
                                
                                If=%:65!=
                                    BookeyeSetting=Format(%:65)
                                EndIf=
                                
                                ;// check/set scanmode
                                ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,ScanMode,:65
                                
                                If=%:65!=
                                    BookeyeSetting=ScanMode(%:65)
                                EndIf=
                                
                                ;// check/set Splitting
                                ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Splitting,:65
                                
                                If=%:65!=
                                    BookeyeSetting=Splitting(%:65)
                                EndIf=
                                
                                ;// Set global defaults
                                If=%NP==0
                                  BookeyeSetting=FileFormat(Tif),DPI(300)
                                Else=
                                  BookeyeSetting=FileFormat(Tif)
                                EndIf=
                                
                                ;// Determine if user has auto and both on the panel. If they do, scan twice.
                                
                                ;BookeyeSettingGet=:65,Format                                
                                ;If=%:65==Auto
                                ;    BookeyeSettingGet=:65,Splitting
                                    
                                ;    If=%:65==Auto
                                ;        Command=ScanOneBookeye
                                ;    EndIf=
                                ;EndIf=
                                
                                Call=Process102
                                ;Command=MultiScanBookeyeWait                                
                            
                            Else=
                                ;// Set global defaults
                                If=%NP==0
                                  BookeyeSetting=FileFormat(Tif),DPI(300)
                                Else=
                                  BookeyeSetting=FileFormat(Tif)
                                EndIf=  
                                
                                Call=Process104
                                                              
                                Call=Process102
                                ;Command=MultiScanBookeyeWait
                            EndIf=
                        EndIf=
                        
                        If=%F7==ADF
                          ;If=%:12==Yes
                          If=%-.-F8==Minolta
                            ;if TWAIN - ADF+pedal (MINOLTA)
                            Command=MultiScanWait
                          Else=  
                            If=%8F8==Bookedge
                              If=%#52==2
 			        ; scan and rotate every other page
 			        #53=2
 			        Ifb=%0-.-:29==Left side
                                  #55=0
                                Elseb=
                                  ;Right side
                                  #55=1
                                EndIfb=
                                Command=MultiScanWait
 			      Else= 			        
 			        If=%#52==0                                                                     
                                  Command=MultiScanWait
                                Else=
                                  ;cancel was pressed
                                  #52=0
                                
                                  If=%F8==Bookedge STD/LED  
                                    ;restore scanner settings
                                    Command=Config1
                                  EndIf=
                                EndIf=
                              EndIf=                              
                            Else=
                              Command=MultiScan                          
                            EndIf=
                          EndIf=
                        EndIf=                     
                        
                    EndIf=                                
                    
                EndIf=
              EndIf=
            Else0=
              ;Rebel Scanning
              #70=0
              RebelGetStatus=#70
              If=%#70!=1
              If=%#70!=2
              If=%#70!=3
              If=%#70!=6
              If=%#70!=7
              If=%#70!=8
                 RebelScanBoth=C:\BscanILL\TempRebel\0000.tif,C:\BscanILL\TempRebel\0001.tif
                 OnInterval=1,Process100
              EndIf=
              EndIf=
              EndIf=              
              EndIf=
              EndIf=
              EndIf=
            EndIf0=            
          Elsea=
            Messageok=Please specify TN before continuing.
            ;// Set IP/Email exception                          
            #83=1                                               
            ;// Clear 'IP/Email' field                          
            ;:02=                                                
            :05=                                                
            EditFieldSetFocus=1,4,0,30          
          EndIfa=  
        Else=
            ;Messageok=Please specify a Doc ID before continuing.
            Messageok=Please specify ILL Number before continuing.
            ;// Set IP/Email exception                          
            #82=1                                               
            ;// Clear 'IP/Email' field                          
            ;:02=                                                
            :04=                                                
            EditFieldSetFocus=1,3,0,30                          
        EndIf=
    Else=
        Messageok=Please specify an IP or email before continuing.    
        ;// Set IP/Email exception                                    
        #81=1                                                         
        ;// Clear 'IP/Email' field                                    
        :01=                                                          
        EditFieldSetFocus=1,2,0,30                                    
    EndIf=
Else=
    If=%:81==1
        Command=ScanOne
    Else=
        MessageOK=Please scan a pullslip first!
    EndIf=
EndIf=       
        
EndIf=

Else=
  If=%#02==1
    ; user invoked timeout
    ; restore buttons
    ;Call=Process99
    ScanTimeOutBookeye=Force
  EndIf=
EndIf=

#52=0


[PROCESS51] ;Single Scan
If=%#23==0
If=%#02==1
#13=0
#53=0
#56=0
If=%NP>0    
    If=%#81!=1
        If=%#82!=1
          If=%#83!=1
            If=%PN<%LP
             PN=%LP
            EndIf=
        
            :74b=0
            
            If0=%F8!=Rebel
              ;// If foot pedal turned on
              If=%:12==Yes
                If=%F7==Widetek
                  If=%NP==0
                    BookeyeSetting=FileFormat(Tif),DPI(300),Format(auto)
                  Else=
                    BookeyeSetting=FileFormat(Tif),Format(auto)
                  EndIf=
                  
                  Call=Process104
                  Command=ScanOneBookeyeWait
                Else=
                    If=%F7==Bookeye
                        ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Status,:65
                        
                        ;;;If=%:65==On
                        ; turn off the default settings-we do not use it
                        If=%:65==xxxxxxxxxxx
                            
                            ;// check/set format
                            ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Format,:65
                            
                            If=%:65!=
                                BookeyeSetting=Format(%:65)
                            EndIf=
                            
                            ;// check/set scanmode
                            ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,ScanMode,:65
                            
                            If=%:65!=
                                BookeyeSetting=ScanMode(%:65)
                            EndIf=
                            
                            ;// check/set Splitting
                            ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Splitting,:65
                            
                            If=%:65!=
                                BookeyeSetting=Splitting(%:65)
                            EndIf=
                            
                            ;// Set global defaults
                            If=%NP==0
                              BookeyeSetting=FileFormat(Tif),DPI(300)
                            Else=
                              BookeyeSetting=FileFormat(Tif)
                            EndIf=
                            
                            ;// Determine if user has auto and both on the panel. If they do, scan twice.
                            
                            BookeyeSettingGet=:65,Format
                            If=%:65==Auto
                                BookeyeSettingGet=:65,Splitting
                                ;If=%:65==Auto
                                ;    Command=ScanOneBookeye
                                ;EndIf=
                                If=%:65!=Auto
                                  :65=
                                EndIf=
                            Else=
                              :65=
                            EndIf=
                            
                            Command=ScanOneBookeyeWait                            
                            If=%:65==Auto
                                Command=ScanOneBookeye
                            EndIf=
                                                        
                        Else=
                            ;// Set global defaults
                            If=%NP==0
                              BookeyeSetting=FileFormat(Tif),DPI(300)
                            Else=
                              BookeyeSetting=FileFormat(Tif)
                            EndIf=
                            Call=Process104
                            Command=ScanOneBookeyeWait
                        EndIf=
                    EndIf=
                    
                    If=%F7==ADF
                      ;If=%:12==Yes
                      If=%-.-F8==Minolta
                        Command=ScanOneWait
                      Else=
                        Command=ScanOne
                      EndIf=
                    EndIf=
                                        
                EndIf=
              Else=
              ;// Foot pedal turned off
                
                ;// If scan from disk is enabled
                If=%:81==1
                    Command=ScanOne
                Else=
                    If=%F7==Widetek
                      If=%NP==0
                        BookeyeSetting=FileFormat(Tif),DPI(300),Format(auto)
                      Else=
                        BookeyeSetting=FileFormat(Tif),Format(auto)
                      EndIf=
                      Call=Process104
                        Command=ScanOneBookeye
                    Else=
                        If=%F7==Bookeye
                        
                            ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Status,:65
                            
                            //////////If=%:65==On
                            ; turn off the default settings-we do not use it
                            If=%:65==xxxxxxxxxxx                                
                                ;// check/set format
                                ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Format,:65
                                
                                If=%:65!=
                                    BookeyeSetting=Format(%:65)
                                EndIf=
                                
                                ;// check/set scanmode
                                ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,ScanMode,:65
                                
                                If=%:65!=
                                    BookeyeSetting=ScanMode(%:65)
                                EndIf=
                                
                                ;// check/set Splitting
                                ReadINI=@%F0\Lib\control.lst,BOOKEYE_DEFAULT,Splitting,:65
                                
                                If=%:65!=
                                    BookeyeSetting=Splitting(%:65)
                                EndIf=
                                
                                ;// Set global defaults
                                If=%NP==0
                                  BookeyeSetting=FileFormat(Tif),DPI(300)
                                Else=
                                  BookeyeSetting=FileFormat(Tif)
                                EndIf=
                                
                                ;// Determine if user has auto and both on the panel. If they do, scan twice.
                                
                                BookeyeSettingGet=:65,Format
                                
                                If=%:65==Auto
                                    BookeyeSettingGet=:65,Splitting
                                    
                                    If=%:65==Auto
                                        Command=ScanOneBookeye
                                    EndIf=
                                EndIf=
                                
                                Command=ScanOneBookeye
                            
                            Else=
                                ;// Set global defaults
                                If=%NP==0
                                  BookeyeSetting=FileFormat(Tif),DPI(300)
                                Else=
                                  BookeyeSetting=FileFormat(Tif)
                                EndIf=
                                Call=Process104
                                Command=ScanOneBookeye
                            EndIf=
                        EndIf=
                                                                        
                        If=%F7==ADF                        
                          If=%-.-F8==Minolta
                            Command=ScanOneWait
                          Else=
                            If=%8F8==Bookedge
                              #56=1
                            EndIf=
                            Command=ScanOne
                          EndIf=                        
                        EndIf=                        
                        
                    EndIf=
                
                ;BookeyeSetting=FileFormat(Tif),DPI(300),Compression(G4),Color(B&W),Splitting(Off),ScanMode(Flat),Format(letp)
                    
                EndIf=
              EndIf=
            Else0=
              ;Rebel Scanning
              #70=0
              RebelGetStatus=#70
              If=%#70!=1
              If=%#70!=2
              If=%#70!=3
              If=%#70!=6
              If=%#70!=7
              If=%#70!=8
                 RebelScanLeft=C:\BscanILL\TempRebel\0000.tif
                 OnInterval=1,Process100
              EndIf=
              EndIf=
              EndIf=              
              EndIf=
              EndIf=
              EndIf=
            EndIf0=
          Else=
            Messageok=Please specify TN before continuing.
            ;// Set IP/Email exception                          
            #83=1
            ;// Clear 'IP/Email' field                          
            :05=                                                
            EditFieldSetFocus=1,4,0,30          
          EndIf=
        Else=
            ;Messageok=Please specify a Doc ID before continuing.
            Messageok=Please specify ILL Number before continuing.
            ;// Set IP/Email exception                          
            #82=1                                               
            ;// Clear 'IP/Email' field                          
            ;:02=                                                
            :04=                                                
            EditFieldSetFocus=1,3,0,30                          
        EndIf=
    Else=
        Messageok=Please specify an IP or email before continuing.    
        ;// Set IP/Email exception                                    
        #81=1                                                         
        ;// Clear 'IP/Email' field                                    
        :01=                                                          
        EditFieldSetFocus=1,2,0,30                                    
    EndIf=
Else=
    If=%:81==1
        Command=ScanOne
    Else=
        MessageOK=Please scan a pullslip first!
    EndIf=
EndIf=       
EndIf=
EndIf=


[PROCESS98] ;Scan Right - Rebel
If=%#23==0
If=%#02==1
#13=0
#53=0
#56=0
If=%NP>0    
    If=%#81!=1
        If=%#82!=1
          If=%#83!=1
            If=%PN<%LP
             PN=%LP
            EndIf=
        
            :74b=0
            
            
              ;Rebel Scanning
              #70=0
              RebelGetStatus=#70
              If=%#70!=1
              If=%#70!=2
              If=%#70!=3
              If=%#70!=6
              If=%#70!=7
              If=%#70!=8
                 RebelScanRight=C:\BscanILL\TempRebel\0001.tif
                 OnInterval=1,Process100
              EndIf=
              EndIf=
              EndIf=              
              EndIf=
              EndIf=
              EndIf=
            
          Else=
            Messageok=Please specify TN before continuing.
            ;// Set IP/Email exception                          
            #83=1
            ;// Clear 'IP/Email' field                          
            :05=                                                
            EditFieldSetFocus=1,4,0,30          
          EndIf=
        Else=
            ;Messageok=Please specify a Doc ID before continuing.
            Messageok=Please specify ILL Number before continuing.
            ;// Set IP/Email exception                          
            #82=1                                               
            ;// Clear 'IP/Email' field                          
            ;:02=                                                
            :04=                                                
            EditFieldSetFocus=1,3,0,30                          
        EndIf=
    Else=
        Messageok=Please specify an IP or email before continuing.    
        ;// Set IP/Email exception                                    
        #81=1                                                         
        ;// Clear 'IP/Email' field                                    
        :01=                                                          
        EditFieldSetFocus=1,2,0,30                                    
    EndIf=
Else=
    If=%:81==1
        Command=ScanOne
    Else=
        MessageOK=Please scan a pullslip first!
    EndIf=
EndIf=       
EndIf=
EndIf=


[PROCESS100]  ;check if rebel image ready
OnInterval=0,Process100
If=%F8==Rebel
#70=0
RebelGetStatus=#70
If=%#70>=1
If=%#70<=3
; image pending
OnInterval=1,Process100
EndIf=
EndIf=

If=%#70==6
; left image was scanned
FileExists=C:\BscanILL\TempRebel\0000.tif
#10=%NP
If=%1PF==P
ScanFileSetPath3=C:\BscanILL\TempRebel\0000.tif
Command=ScanOne
#11=%NP
ScanFileSetPath3=
FileDelete=C:\BscanILL\TempRebel\0000.tif
EndIf=

Ifa=%#19==4
  ; if a pull slip scanning
  If1=%#10<%#11
  
    Call=Process15                
    If=%#96==1                                                            
      EditFieldSetFocus=1,2,0,30
    EndIf=
    If=%#96==2                                                            
      EditFieldSetFocus=1,3,0,30
    EndIf=   
    
  EndIf1=
  #19=0
EndIfa=

EndIf=

If=%#70==7
; right image was scanned
FileExists=C:\BscanILL\TempRebel\0001.tif
If=%1PF==P
ScanFileSetPath3=C:\BscanILL\TempRebel\0001.tif
Command=ScanOne
ScanFileSetPath3=
FileDelete=C:\BscanILL\TempRebel\0001.tif
EndIf=
EndIf=

If=%#70==8
; both images scanned too
FileExists=C:\BscanILL\TempRebel\0000.tif
If=%1PF==P
ScanFileSetPath3=C:\BscanILL\TempRebel\0000.tif
Command=ScanOne
ScanFileSetPath3=
FileDelete=C:\BscanILL\TempRebel\0000.tif
EndIf=

FileExists=C:\BscanILL\TempRebel\0001.tif
If=%1PF==P
ScanFileSetPath3=C:\BscanILL\TempRebel\0001.tif
Command=ScanOne
ScanFileSetPath3=
FileDelete=C:\BscanILL\TempRebel\0001.tif
EndIf=

EndIf=

If=%#70>3
;ready to scan next image
RebelSetStatus=0
EndIf=

EndIf=                 
                 

[PROCESS52] Goto IP Menu
    
    If=%F7==ADF
        EditBox1=Close
        EditBox17=Close
        If=%TH==27
            ;// WinXP Style
            WriteINI=EDITBOX1,EditWindow,0,352,383,SY-383
        Else=
            If=%TH==20
                ;// Win2k style
                WriteINI=EDITBOX1,EditWindow,0,345,383,SY-373
            EndIf=
        EndIf=
        ExecuteFaceliftButtonReload=yes
        Command=Config2
    Else=
        ;// Bookeye/WideTek settings
        
        EditBox1=Close
        EditBox17=Close
        If=%TH==27
            ;// WinXP Style
            WriteINI=EDITBOX1,EditWindow,0,352,383,SY-383
        Else=
            If=%TH==20
                ;// Win2k Style
                WriteINI=EDITBOX1,EditWindow,0,345,383,SY-373
            EndIf=
        EndIf=
        ExecuteFaceliftButtonReload=yes
        Command=Config2
        ;EditBox1=OpenLive
    EndIf=
    
[PROCESS53] Goto Main Menu
    
    If=%F7==ADF
        EditBox1=Close
        EditBox17=Close
        If=%TH==27
            ;// WinXP Style
            WriteINI=EDITBOX1,EditWindow,0,352,383,SY-383
        Else=
            If=%TH==20
                ;// Win2k Style
                WriteINI=EDITBOX1,EditWindow,0,345,383,SY-373
            EndIf=
        EndIf=
        ExecuteFaceliftButtonReload=yes
        Command=Config1
    Else=
        ;// Bookeye/WideTek settings
        
        EditBox1=Close
        EditBox17=Close
        If=%TH==27
            ;// WinXP Style
            WriteINI=EDITBOX1,EditWindow,0,410,383,SY-441
        Else=
            If=%TH==20
                ;// Win2k Style
                WriteINI=EDITBOX1,EditWindow,0,403,383,SY-431
            EndIf=
        EndIf=
        ExecuteFaceliftButtonReload=yes
        Command=Config1
    EndIf=

[PROCESS54] ImageTreatmentPLUS
If=%#23==0
Ifb=%#51<0

    ;// ////////////////////////////////////////////////////////////////////
    ;// MODULE: ImageTreatmentPLUS
        ReadINI15=@%F0\Lib\Modules\ModuleState.bsi,MODULES,ImageTreatmentPLUS,:65
        If3=%:65==Enabled
            If=%NP<1
                MessageOK=Please scan some images first!
            Else=
                ;EditBox6=OpenLive
                Call1=Process55,%F0\Lib\Modules\ImageTreatmentPLUS.bsa
            EndIf=
        EndIf3=
        :65z=
    ;// END
    ;// ////////////////////////////////////////////////////////////////////

Elseb=
  #51=#51+1
  MessageOK=Modified page %#51 has not been saved yet! Please save or restore it before Image Treatment!
  #51=#51-1
EndIfb=  
EndIf=
      
    
[PROCESS56] ImageTreatmentPLUS Window OnClose
    
    ;EditBox6=Close
    
    If=%1PF==P
        HourGlass=On
        EditBox6=OpenLive
    
        Wait=2000
        
        Ifa=%NP>0
            #98=0
            FileExists=%F0\Lib\%F6\templog.bsj
            If=%1PF==P
                Filedelete=%F0\Lib\%F6\templog.bsj
            EndIf=
            FileOpen=3,%F0\Lib\%F6\templog.bsj
            #67a=0
            Goto=Home
        
            PreProcess=OFF
            FileWrite=3,.ImageFileDir=%AP\%..AN\%..JN\
            FileWrite=3,.ImageFileName=%%4N0.TIF
            FileWrite=3,.ImageFileSideChar=1
            FileWrite=3,.LogFileEntry=%%7PN|%%FP|%%6C1|%%5C2|%%4C3|%%3C4|%%3CF|%%D0|%%T0|%%4FC|%%20PS|%%12CV|%%50:00|%%50:01|%%120:02|%%50:04|%%50:05|%%2:17|%%50:20|%%50:21|%%10:22|%%10:23|%%5:39|%%4:40|%%4:41|%%4:42|%%4:43|%%4:44|%%4:45|%%4:46|%%4:47|%%1:50|%%1:74|%%20:30|            
            
            FileWrite=3,.LogEntryProc=NewDirEvery1000000            
            FileWrite=3,.FileFormat=TIFF-G4
            FileWrite=3,.JobId=
            PreProcess=ON
        
            UpdateView=No
            
            While=%#67==0
                :14=
                :19=
                BookFoldSaveOneImage=%PN,%FP,1,:14,:19
                :14=%-.-:14
                :17=
                #96=0        
                If=%-.-:14!=
                  #95=%LN(:14)
                  If=%#95>=4
                    #95=#95-4
                    ;1000
                    If=%(#95).1:14==1                      
                      #96=8
                    EndIf=
                    #95=#95+4
                  EndIf=
                  
                  If=%#95>=3
                    #95=#95-3                    
                    ;0100
                    If=%(#95).1:14==1                      
                      #96=#96+4
                    EndIf=
                    #95=#95+3
                  EndIf=  
                EndIf=
                
                If=%#96>0
                  :17=%#96                  
                EndIf=
                             
                #97=0
                If=%-.-:19!=
                  #97=%:19                
                EndIf=
                                
                ;// Determine if its a jpeg or tiff
                
                ;S3=%FP
                ;#94=%LN(S3)
                ;#94=%#94-3
                
                ;S3=%(%#94).3FP
                
                ;If=%S3==TIF
                        
                    ;// if its a tiff
                
                    ; how many clips?
                    ;FileExists=%..FP_1.tif                
                    ;If=%1PF==P
                    If=%#97>=1
                        F9=%..FP_1.tif
                        FileWrite=3,%7#98|%F9|%6C1|%5C2|%4C3|%3C4|%3CF|%D0|%T0|%4FC|%20PS|%12CV|%50:00|%50:01|%120:02|%50:04|%50:05|%2:17|%50:20|%50:21|%10:22|%10:23|%5:39|%4:40|%4:41|%4:42|%4:43|%4:44|%4:45|%4:46|%4:47|%1:50|%1:74|%20:30|
                        #98=#98+1
                    EndIf=
                    
                    ;FileExists=%..FP_2.tif                    
                    ;If=%1PF==P
                    If=%#97>=2
                        F9=%..FP_2.tif
                        
                        ;need to filter out pull slip flag in second clip on page it should not be
                        Ifa=%-.-:17==4
                          FileWrite=3,%7#98|%F9|%6C1|%5C2|%4C3|%3C4|%3CF|%D0|%T0|%4FC|%20PS|%12CV|%50:00|%50:01|%120:02|%50:04|%50:05|  |%50:20|%50:21|%10:22|%10:23|%5:39|%4:40|%4:41|%4:42|%4:43|%4:44|%4:45|%4:46|%4:47|%1:50|%1:74|%20:30|
                        Elsea=
                          Ifb=%-.-:17==12
                            FileWrite=3,%7#98|%F9|%6C1|%5C2|%4C3|%3C4|%3CF|%D0|%T0|%4FC|%20PS|%12CV|%50:00|%50:01|%120:02|%50:04|%50:05|8 |%50:20|%50:21|%10:22|%10:23|%5:39|%4:40|%4:41|%4:42|%4:43|%4:44|%4:45|%4:46|%4:47|%1:50|%1:74|%20:30|
                          Elseb=
                            FileWrite=3,%7#98|%F9|%6C1|%5C2|%4C3|%3C4|%3CF|%D0|%T0|%4FC|%20PS|%12CV|%50:00|%50:01|%120:02|%50:04|%50:05|%2:17|%50:20|%50:21|%10:22|%10:23|%5:39|%4:40|%4:41|%4:42|%4:43|%4:44|%4:45|%4:46|%4:47|%1:50|%1:74|%20:30|
                          EndIfb=
                        EndIfa=
                        #98=#98+1
                    EndIf=
                ;;Else=
                ;;    
                ;;    ;// If its a jpeg
                ;;    
                ;;    ; how many clips?
                ;;    FileExists=%..FP_1.jpg
                ;;
                ;;    If=%1PF==P
                ;;        F9=%..FP_1.jpg
                ;;        FileWrite=3,%7#98|%F9|%6C1|%5C2|%4C3|%3C4|%3CF|%D0|%T0|%4FC|%20PS|%12CV|%50:00|%50:01|%10:02|%50:20|%50:21|%10:22|%10:23|%5:39|%4:40|%4:41|%4:42|%4:43|%4:44|%4:45|%4:46|%4:47|%1:50|
                ;;        #98=#98+1
                ;;    EndIf=
                ;;    
                ;;    FileExists=%..FP_2.jpg
                ;;    
                ;;    If=%1PF==P
                ;;        F9=%..FP_2.jpg
                ;;        FileWrite=3,%7#98|%F9|%6C1|%5C2|%4C3|%3C4|%3CF|%D0|%T0|%4FC|%20PS|%12CV|%50:00|%50:01|%10:02|%50:20|%50:21|%10:22|%10:23|%5:39|%4:40|%4:41|%4:42|%4:43|%4:44|%4:45|%4:46|%4:47|%1:50|
                ;;        #98=#98+1
                ;;    EndIf=
                ;;
                ;;EndIf=
                
                ;delete original image file
                ;FileExists=%FP
                ;If=%1PF==P
                ;  FileDelete4=%FP
                ;EndIf=
               
                :14=
                
                Ifb=%PN<%LP
                    PN=PN+1
                Elseb=
                    #67b=1
                EndIfb=
            EndWhile=
            
            UpdateView=Yes
            
            FileClose=3
            F9=%JF
            S9=%JN
            NewLogFile=New.Bsj
                                             
            FileExists=%F0\Lib\Modules\ImageTreatmentPLUS\%S9
            If=%1PF==P
                FileDelete=%F0\Lib\Modules\ImageTreatmentPLUS\%S9
            EndIf=
            
            FileMkDir=%F0\Lib\Modules\ImageTreatmentPLUS
            
            FileRename=%F9,%F0\Lib\Modules\ImageTreatmentPLUS\%S9
            
            FileRename=%F0\Lib\%F6\templog.bsj,%F9
            NewLogFile=%F9
        
            ;RestoreImages=Yes
        EndIfa=
            ;;BookFoldWindowClose=Yes
        BookFoldBufferClear=Yes
        EditBox6=Close
        HourGlass=Off
    Else=
        BookFoldBufferClear=Yes
        EditBox6=Close
    EndIf=

[PROCESS58] Rotate .1 CW
If=%#23==0
Ifa=%NP>0
#20=0
Ifh=%#51<0
#20=1
Elseh=
If9=%#51==%PN
#20=1
EndIf9=
EndIfh=

Ifb=%#20==1
  RotateFromOriginal=0.1,White
  #51=%PN
Elseb=
#51=#51+1
MessageOK=Modified page %#51 has not been saved yet! Please save or restore it before modifying this page!
#51=#51-1
EndIfb=
EndIfa=  
EndIf=


[PROCESS59] Rotate .1 CCW
If=%#23==0
Ifa=%NP>0
#20=0
Ifh=%#51<0
#20=1
Elseh=
If9=%#51==%PN
#20=1
EndIf9=
EndIfh=

Ifb=%#20==1
  RotateFromOriginal=-0.1,White
  #51=%PN
Elseb=
#51=#51+1
MessageOK=Modified page %#51 has not been saved yet! Please save or restore it before modifying this page!
#51=#51-1
EndIfb=
EndIfa=
EndIf=


[PROCESS63] Save Changes Button
If=%#23==0
    If=%NP>0
        Save=Yes
        #51=-1
        MessageOK=Changes to the image have been saved!
    Else=
        MessageOK=Nothing to save. Please scan some images first!
    
    EndIf=
EndIf=

   
[PROCESS64] Insert Button
If=%#23==0
If=%#02==1
  #53=0
  #56=0
    If=%NP!=0
      If=%1:74!=1
        If=%F7==ADF
            If=%-.-F8==
              Command=ScanOneInsert
            Else=
              If=%-.-F8==Minolta
                Command=ScanOneInsertWait
              EndIf=
              If=%8F8==Bookedge
                #56=1
                Command=ScanOneInsert
              EndIf=              
            EndIf=
            
        Else=
            ;BookeyeSetting=FileFormat(Tif),DPI(300)
            BookeyeSetting=FileFormat(Tif)
            
            Call=Process104            
            
            If=%:12==Yes
                Command=ScanOneInsertBookeyeWait
            Else=                
                Command=ScanOneInsertBookeye
            EndIf=

        EndIf=
      Else=
        MessageOK=Cannot Insert page before Pull Slip page!
      EndIf=        
    Else=
        MessageOK=You must first scan an image before using 'Insert'
    EndIf=
EndIf=
EndIf=
    
[PROCESS108] Export Processing
    HourGlass=On
    
    F4=
    :94=
    
    #31=0

    ;Root,F0
    ;Temp,F1
    ;ExportImages,F2
    ;TRANSFER_PATH,F3

    Goto=Home
    
            
    ; #76:
    ; 0- Ariel
    ; 1- Email
    ; 2- Ftp
    ; 3- Odyssey
    ; 4- ILLiad
    ; 5- Save on disk
     
    #76=0    
    ReadINI21=@%AP\..\Lib\Control.lst,MAIN,ImageFormat,:51
            
    Ifa=%-.-:30==
              ; delivery list box not selected -> go by controls.lst
              
              ;// If Exporting to Email
              If=%-.-:83==Yes
                #76=1        
                :51=pdf
              EndIf=
    
              ;// If Exporting to Email+FTP
              If=%-.-:84==Yes
                #76=2
                :51=pdf
              EndIf=

              If=%-.-:82==Yes
                ;ariel
                #76=0  
                :51=tif      
              EndIf=   
              If=%-.-:62==Yes
                ;Odyssey
                #76=3   
                :51=tif   
              EndIf=    
              If=%-.-:61==Yes
                ;ILLiad
                #76=4       
                :51=tif 
              EndIf=        
    Elsea=
              ; delivery method listbox selected..
              ;// If Exporting to Email
              If=%0-.-:30==Email
                #76=1        
                ;;:51=pdf
                ReadINI60=@%AP\..\Lib\Control.lst,EMAIL,ImageFormat,:51
              EndIf=
    
              ;// If Exporting to Email+FTP
              If=%0-.-:30==Email+Ftp
                #76=2
                ;:51=pdf
                ReadINI61=@%AP\..\Lib\Control.lst,FTP,ImageFormat,:51
              EndIf=

              If=%0-.-:30==Ariel
                ;ariel
                #76=0  
                :51=tif      
              EndIf=   
              If=%0-.-:30==Odyssey
                ;Odyssey
                #76=3   
                ;:51=tif   
                ReadINI62=@%AP\..\Lib\Control.lst,ODYSSEY,ImageFormat,:51
              EndIf=    
              If=%0-.-:30==ILLiad
                ;ILLiad
                #76=4      
                ;:51=tif  
                ReadINI63=@%AP\..\Lib\Control.lst,ILLiad,ImageFormat,:51
              EndIf= 
              If=%0-.-:30==Save on Disk
                ;Save on disk
                #76=5       
                
                ;already set above
                ;;ReadINI21=@%AP\..\Lib\Control.lst,MAIN,ImageFormat,:51
              EndIf=               
    EndIfa=
    
    If=%#76==0
       ; flag at least one document to sent by Ariel
       #31=1
    EndIf=    
             
    
    ;// #69 == counter -  how many images in multi tiff so far (in article for email/ftp export purposes)
    #69=0
    
    ;#25 article level page count
    #25=0
    
    ; article attachment path
    :69=
    :48=
    :49=
    
    
    ; set :02 based on :30 resp #76 and :04, :05
    If=%-.-:04%-.-:05!=
              If=%#76==1
                ;Email
                If=%-.-:04!=
                  :02=%:04
                Else=
                  :02=%:05
                EndIf=
              EndIf=
    
              ;// If Exporting to Email+FTP
              If=%#76==2
                ;Email+Ftp                
                If=%-.-:04!=
                  :02=%:04
                Else=
                  :02=%:05
                EndIf=
              EndIf=

              If=%#76==0
                ;Ariel                
                If=%-.-:04!=
                  :02=%:04
                Else=
                  :02=%:05
                EndIf=
              EndIf=   
              
              If=%#76==3
                ;Odyssey
                If=%-.-:05!=
                  :02=%:05
                Else=
                  :02=%:04
                EndIf=
              EndIf=    
              If=%#76==4
                ;ILLiad
                If=%-.-:05!=
                  :02=%:05
                Else=
                  :02=%:04
                EndIf=
              EndIf= 
              If=%#76==5
                ;Save on Disk
                If=%-.-:04!=
                  :02=%:04
                Else=
                  :02=%:05
                EndIf=
              EndIf=             
    EndIf=
            
                
    :18=%0-.-:02
    
    ;// Delete imtest.txt of it exists in the sendkeys folder.
    ;// 
        
    ;// Check to make sure imdata doesn't exist. If it does, delete it.
    
        FileExists=%F0\Lib\imdata.txt
        If=%1PF==P
            FileDelete=%F0\Lib\imdata.txt
        EndIf=
        
    ;// Write imdata/txt
        
        FileOpen=1,%F0\Lib\imdata.txt
        
    
    ;// ////////////////////////////////////////////////////////////////////
    ;// MODULE: Reporting
        ReadINI13=@%F0\Lib\Modules\ModuleState.bsi,MODULES,Reporting,:65
        If3=%:65==Enabled
            FileExists3=%F0\Lib\%F6\Logs\bscan.log
            If4=%1PF==P
                FileDelete3=%F0\Lib\%F6\Logs\bscan.log
            EndIf4=
            FileMkDir1=%F0\Lib\%F6\Logs
                       
            FileOpen1=2,%F0\Lib\%F6\Logs\bscan.log
        EndIf3=
        :65a=
    ;// END
    ;// ////////////////////////////////////////////////////////////////////
    
        ;// Main loop. to create article image. (Either pdf or Tiff)
        
        ;#15 - create multi image tiff flag
        #15=0
        #22=0
                
        While1=%PN<%LP
            Calla=Process16            
            PNa=%PN+1
        EndWhile1=
                
            Callb=Process16                    
            
            ;FileClose=2
            
            If=%:51==pdf
              If=%#69>0
                
                FileMkDir=%F2\%.-:18                
                
                If=%#50!=0
                  RecognizeWriteDocument=%F2\%.-:18\%F4,Adobe PDF image only
                Else=
                  FileClose=7                  
                  WinExecWait=%IP\PDFCreator\BScanPDFBatchConverter.exe "%IP\PDFCreator\ImageToPDF.txt" "%F2\%.-:18\%F4" 75                  
                EndIf=
              EndIf=
            Else=
              If=%:51==spdf
                If=%#69>0
                
                  FileMkDir=%F2\%.-:18                
                
                  If=%#50!=0
                    RecognizeWriteDocument=%F2\%.-:18\%F4,Adobe PDF image only
                  Else=
                    FileClose=7                  
                    WinExecWait=%IP\PDFCreator\BScanPDFBatchConverter.exe "%IP\PDFCreator\ImageToPDF.txt" "%F2\%.-:18\%F4" 75                  
                  EndIf=
                EndIf=            
              EndIf=  
            EndIf=
            
            FileClose1=1
            
            ;// Check to see if there was and error when we were saving the file to disk.                        
            
            If=%5:25!=ERROR              
                ; if there is something for ftp - do it
                ;;;;;Call=Process74
                                                
                ;// //////////////////////////////
                ;// MODULE: Reporting
                    ReadINI14=@%F0\Lib\Modules\ModuleState.bsi,MODULES,Reporting,:65
                    If6=%:65==Enabled
                        FileClose2=2
                    EndIf6=
                    :65b=
                    
                    ;ReadINI=@%F0\Lib\control.lst,MAIN,SendUsing,:65
                    :65=%:97
        
                    #85=0
                    If15=%#76==3
                      ;Odyssey
                      #85=1
                    EndIf15=
                    If15=%#76==4
                      ;ILLiad
                      #85=1
                    EndIf15=        
        
                    ;At least one document was sent to ariel
                    If=%#31==1
                    ;If=%:65==Ariel
                    ;;;If=%#85==0 
                      ReadINI66=@%AP\..\Lib\Control.lst,ARIEL,Path,:89
                      If66=%-.-:89!=
                        ;Ariel path specified - take care of logs
          
                        ;// Delete Ariel Log
                        If=%:87==3
                            FileExists=C:\program files\RLG\Ariel\ARIEL.LOG
                            If=%1PF==P                                        
                              FileDelete5=C:\program files\RLG\Ariel\ARIEL.LOG
                            EndIf=
                            
                            ;// Recreate Ariel Log
                            FileMkDir=C:\program files\RLG\Ariel
                            FileOpen4=4,C:\program files\RLG\Ariel\ARIEL.LOG
                            FileClose4=4
                        Else=
                            If=%:87==4
                                FileExists=C:\program files\Ariel\ARIEL.LOG
                                If=%1PF==P                                                                 
                                   FileDelete5=C:\program files\Ariel\ARIEL.LOG
                                EndIf=
                                
                                ;// Recreate Ariel Log
                                FileMkDir=C:\program files\Ariel
                                FileOpen4=4,C:\program files\Ariel\ARIEL.LOG
                                FileClose4=4
                            EndIf=
                        EndIf=
                      EndIf66=
                    EndIf=                                                
                        
                    ;;;EndIf=
                ;// END        
                ;// //////////////////////////////           
    
                :10=%..JN
                ;;If7=%:80!=1
                    DeleteLogEntries=All
                ;;EndIf7=
                NewLogFile=New.bsj
                
                ;// Reset module trigger.
                :67z=
                
                ;;If8=%:80!=1
                    FileExists=%F0\Apps\%..AN\%:10
                    If=%1PF==P
                      DirectoryDelete=%F0\Apps\%..AN\%:10,recurse,nomessage
                    EndIf=
                ;;EndIf8=
    

                
                  ;// reset trigger that is used for when the image file is not saved to disk properly.
                  :25=
                    
                  ;// reset trigger that handles exporting only once per batch.
                  :26=
                  
                  ;// Determine ImageFormat settings
                  ; could break something after adding ftp support to all delivery methods except ariel
                 ;;;;;;;;;;;;;;; ReadINI21=@%AP\..\Lib\Control.lst,MAIN,ImageFormat,:51
                
                #85=0
                ;If15=%#76==1
                ;  ;email
                ;  #85=1
                ;EndIf15=
                ;If15=%#76==2
                ;  ;ftp
                ;  #85=1
                ;EndIf15=
                ;If15=%#76==5
                  ;save on disk
                ;  #85=1
                ;EndIf15=
                
                ;If=%#76==0
                If=%#85==0
                  ; ariel export
                  HourGlass=Off
                  OnInterVal=1,Process9
                  ;Command=Process9
                Else=
                  ; done with email/ftp export - below script from process20
                  EditBox3=Close
                  :00=
                  :01=
                  :02=
                  :04=
                  :05=
                  :20=
                  :21=
                  :30=
                  
                  Wait=2000
                  
           ;         ReadINI=@%F0\Lib\control.lst,MAIN,SendUsing,:65
           ;         #85=0
           ;         If15=%#76==3
           ;           ;Odyssey
           ;           #85=1
           ;         EndIf15=
           ;         If15=%#76==4
           ;           ;ILLiad
           ;           #85=1
           ;         EndIf15= 
                            
                    ; why here is this condition???
                    ;If=%:65==Ariel
          ;          If=%#85==0
                    
                        ;// /////////////////////////////////////////////////////////////////////
                        ;// MODULE: Reporting
           ;             ReadINI13=@%F0\Lib\Modules\ModuleState.bsi,MODULES,Reporting,:65
           ;             If3=%:65==Enabled
           ;               Call1=Process23,%F0\Lib\Modules\Reporting.bsa
           ;             EndIf3=
                        :65a=
                        ;// END
                        ;// ////////////////////////////////////////////////////////////////////
                        HourGlass=Off
                        Command=Config1
                        
          ;          EndIf=
                  
                EndIf=
            Else=
                MessageOK=There was a problem saving the image to disk. Close BSCAN ILL and try to send again. If you still get this error make sure your have read/write access to the c:\BSCAN and c:\BSCANILL folders.
            EndIf=
        
      HourGlass=Off  

        
[PROCESS70] ;KIC import F key pressed
ReadINI1=@%AP\..\Lib\Control.lst,PATHS,KICDropPoint,F1
If0=%-.-F1!=
:98=
EditBox9=OpenLive
FileExists=Close
EditFieldClearLST=9,1
:19=1
While=%-.-:19!=
:19=
FileExists=Dir,NEXT,%F1\*.*,:19
If1=%-.-:19!=
EditFieldAddItemInLST=9,1,%:19
EndIf1=
EndWhile1=
FileExists=Close
Else0=
MessageOK=KIC Droppoint Path Not Defined!
EndIf0=


[PROCESS71]
EditBox9=Close


[PROCESS101]
While=%#40>0
If=a%(#40).1:52==a.
:52=%(#40):52
#40=1
EndIf=
#40=#40-1
EndWhile=


[PROCESS72] ; continue KIC import
If0=%-.-:98!=
:98=%0-.-:98
; import folder specified %F1\%:98

:56=2
#19=4
FileExists=Close
:19=1
GoTo=End
While=%-.-:19!=
:19=
FileExists=Next,%F1\%:98\*.*,:19
:19=%0-.-:19
If=%-.-:19!=
; is it tiff or jpg?

-------------------------

;delete extension from file name
:52=%:19
#40=%LN(:52)
If=%#40>1
#40=#40-1
Call=Process101
EndIf=

#41=0

#40=%LN(:52)

#40=#40+1

If7=%#40>1
S4=%(#40).:19
S4=%UC(%S4)
If=%S4==TIF
#41=1
EndIf=
If=%S4==JPG
#41=2
EndIf=

EndIf7=

Ifa=%#41>0
Ifb=%#41==2
; convert jpg to tif first
FileMkDir15=%F1\%:98\temp
SaveAs=Source(%F1\%:98\%:19),%F1\%:98\temp\%..:19.tif,unc
ScanFileSetPath3=%F1\%:98\temp\%..:19.tif
Elseb=
; import original tiff
ScanFileSetPath3=%F1\%:98\%:19
EndIfb=
Command=ScanOne
EndIfa=

EndIf=
EndWhile=
ScanFileSetPath2=
FileExists=Close

;DirectoryDelete=%F1\%:98,recurse,nomessage
DirectoryDelete=%F1\%:98,recurse
:56=
EndIf0=

        
[PROCESS33] ;import image
If=%NP>0

#96=0
#97=0
:59=
ReadIni1=@%..AP\Dt02\NS.ini,0000,01,:59
#96=%:59
:59=
ReadIni2=@%..AP\Dt02\NS.ini,0000,02,:59
#97=%:59
If=%#97>0
#97=#97*25
#97=#97/100
EndIf=
If=%#97<200
#97=200
EndIf=

;if scan from disk counter is lower then limit
Ifyy=%#96<%#97
:98a=Import folder
EditBox8=OpenLive
Elseyy=
MessageOK=Amount of Imported Images Exceeded Limit!
EndIfyy=
Else=
MessageOK=Please scan a pullslip first!
EndIf=

        
[**RESERVED_PROCESSES**]

;Process21 - Processing Module
;Process22 - Processing Module
;Process23 - Reporting Module
;Process24 - Reporting Module
;Process25 - Reporting Module
;Process32 - ResendArticle Module
;Process33 - ResendArticle Module  // I am using it in this script - not reserved...
;Process34 - ImageTreatment Module
;Process35 - ImageTreatment Module
;Process36 - ImageTreatment Module
;Process37 - ImageTreatment Module
;Process54 - ImageTreatmentPLUS module
;Process55 - ImageTreatmentPLUS module
;Process56 - ImageTreatmentPLUS module
;Process57 - ImageTreatmentPLUS module
;Process60 - AutoCleanup module
;Process61 - AutoCleanup module
;Process62 - AutoCleanup module
;Process65 - RapidILL module
;Process66 - RapidILL module
;Process67 - dummy process for interface toolbars
;Process75 - dummy process for interface toolbars
;Process76 - dummy process for interface toolbars
;Process78 - ImageTreatmentPLUS module
;Process80 - dummy process for interface toolbars


[FILE]
LogFile=c:\bscanill\apps\illscan\10000001.bsj
LogFileAlt=New.bsj
ImageFileDir=
ImageFileName=%4N0.TIF
ImageFileSideChar=1
LogFileEntry=%7PN|%FP|%6C1|%5C2|%4C3|%3C4|%3CF|%D0|%T0|%4FC|%20PS|%12CV|%50:00|%70:01|%120:02|%50:04|%50:05|%2:17|%50:20|%50:21|%10:22|%10:23|%5:39|%4:40|%4:41|%4:42|%4:43|%4:44|%4:45|%4:46|%4:47|%1:50|%1:74|%20:30|
LogEntryProc=NewDirEvery1000000
FileFormat=TIFF-G4



[EDITBOX1] Index
EditTitle=BSCAN ILL:Information

EditWindow=0,535,383,SY-569

;EditFaceLiftOffset=0,557
EditFaceLiftOffset=0,387

;Stats1=22,15,Page: %PO of %NP
;Stats2=190,15,Article: %C2 of %ND
Stats1=22,34,Page: %PO of %NP
Stats2=190,34,Article: %C2 of %ND

;Graph1=HorizontalBar,115,120,10,25,1,#81,255,0,0
;Graph2=HorizontalBar,115,150,10,25,1,#82,255,0,0

Graph1=HorizontalBar,115,80,10,25,1,#81,255,0,0
Graph2=HorizontalBar,115,110,10,25,1,#82,255,0,0
Graph3=HorizontalBar,115,140,10,25,1,#83,255,0,0

Field1=Edit,22,53,235,22,:00,Patron  :  ,50,AfterChar=Process97
Field2=Edit,22,83,235,22,:01,IP/email:  ,70,AfterChar=Process97
;Field3=Edit,22,113,235,22,:02,DocID   :  ,120,AfterChar=Process97
Field3=Edit,22,113,235,22,:04,ILL Number:,50,AfterChar=Process97
Field4=Edit,22,143,235,22,:05,TN :       ,50,AfterChar=Process97
;Field4=Edit,22,180,:20,Notes   :  ,20
;Field5=Edit,22,210,:21,Desc.   :  ,20
;Stats3=22,142,Delivery   :
Stats3=22,172,Delivery   :
;Field4=ListBox,109,142,140,60,:30,,20,ListFile(C:\dummy.lst|EMPTYITEM,1,20,1),AfterChange=Process97
Field5=ListBox,109,172,140,60,:30,,20,ListFile(C:\dummy.lst|EMPTYITEM,1,20,1),AfterChange=Process97
;Field5=Button,245,167,115,28,:99,Lookup TN,6,AfterChange=Process26,Tooltip(Lookup Transaction Number)
Field6=Button,245,197,115,28,:99,Lookup TN,6,AfterChange=Process26,Tooltip(Lookup Transaction Number)

EditOnOpen=Process86



[PROCESS86]
EditFieldClearLST=1,5
EditFieldAddItemInLST=1,5,Ariel
EditFieldAddItemInLST=1,5,ILLiad
EditFieldAddItemInLST=1,5,Odyssey
EditFieldAddItemInLST=1,5,Email
EditFieldAddItemInLST=1,5,Email+Ftp
EditFieldAddItemInLST=1,5,Save on Disk

EditFieldSetActive=1,111110



[EDITBOX17] ;Notes to editbox1
EditTitle=BSCAN ILL:Notes
EditWindow=0,528,383,SY-556

;EditFaceLiftOffset=0,740
EditFaceLiftOffset=0,600

Stats1=22,15,Function Key Definition:
Stats2=22,45,F1: Scan Pullslip
Stats3=22,65,F2: Multi Scan
Stats4=22,85,F3: Single Scan
Stats5=22,105,F4: Undo Image Change
Stats6=22,125,F5: Send Article(s)
Stats7=22,145,F6: Rotate 1 degree cw
Stats8=22,165,F7: Rotate 1 degree ccw
Stats9=22,185,F8: Save Image Changes
Stats10=22,205,F9: KIC Import
Stats11=22,225,F11: Import Images From Disk
Stats12=22,245,F12: Exit Bscan


[EDITBOX2] Splash #2
EditTitle=BSCAN ILL version 1.7

;EditWindow=0,0,383,199
EditWindow=0,0,382,199
Background=@c:\bscanill\Lib\illscreen2.jpg
;Background=DoNotFit,@C:\BSCANILL\Lib\illscreen2.jpg

[EDITBOX3] Intro Splash
EditTitle=Welcome to BSCAN ILL
EditOnTopFaceLift=Yes
EditWindow=SX-1024/2,SY-470/2,1024,470
EditField1=80,600,:99,User Name :,10
Background=DoNotFit,@c:\bscanill\Lib\illscreen1.jpg


[EDITBOX6] ;ImageTreatmentPLUS
EditTitle=PROCESSING... Please wait.
EditWindow=SX/2-200,SY/2-100,400,1
;EditTopMost=Yes
EditOnTopFaceLift=Yes


[EDITBOX8] ;Import
EditTitle=Import
EditWindow=SX-160/2,SY-210/2,160,210
EditOnTopFaceLift=Yes

;; afterchar points to junk process - no action...
Field1=Radio,10,10,100,101,:98,,15,AfterChange=Process80,ValidValue(Import folder,Import file)
Field2=Button,45,135,:99,OK,4,AfterChange=Process17

EditOnClose=Process7


[EDITBOX9] ;KIC Import
EditTitle=KIC Import
EditWindow=SX-350/2,SY-300/2,350,150
EditOnTopFaceLift=Yes

;; afterchar points to junk process - no action...
Stats1=20,25,Articles in import queue:
Field1=ListBox,5,45,300,190,:98,,20,ListFile(C:\dummy.lst|EMPTYITEM,1,20,1)
Field2=Button,240,80,82,27,:99,OK,4,AfterChange=Process71

EditOnClose=Process72

[EDITBOX10] ;Printing...
EditTitle=Printing...
EditWindow=SX-260/2,SY-780/2,260,390
EditOnTopFaceLift=Yes

Stats1=20,25,------ Select Images ------
Field1=VRadio,5,45,125,101,:98,,15,AfterChange=Process107,ValidValue(Current Image,Current Article,All,Range)
Field2=Edit,130,124,90,22,:90,,50
Stats2=20,165,--------- Options ---------
;Field3=Check,5,185,20,20,:96,,15,ValidValue(DoNotRotate,Rotate)
;Stats3=40,188,Rotate To Fit

Field3=Check,5,185,20,20,:95,,15,ValidValue(DoNotSkip,Skip)
Stats3=40,188,Skip Pull Slips

Stats4=20,229,--------- Copies ----------
Field4=ListBox,5,249,100,100,:80,,20,ListFile(C:\dummy.lst|,1,20,1)

Field5=Button,20,298,82,27,:99,OK,4,AfterChange=Process105
Field6=Button,152,298,82,27,:99,Cancel,4,AfterChange=Process106

EditOnOpen=Process68
EditOnClose=Process40


[PAPERSIZES]
Portrait1=A4,460,0,2129,2997
Portrait2=B5,767,0,1511,2128
Portrait3=Letter,432,0,2184,2819
Portrait4=Legal,432,0,2184,3581
Portrait5=A5,767,0,1511,2128
Portrait6=B4,460,0,2129,2997
Portrait7=B6,998,0,1077,1511


[BOOKEYE]
docsize=auto
user_x=
user_y=
user_w=
user_h=
user_unit=
splitting=off
autoformat_extra=0
autoformat_density=70
bright=128
dyn_bright=on
contr=128
gamma=15
dpi=300
docmode=0
colormode=lineart
fileformat=tiff
tiff_compr=g4
invert=off
jpeg_quality=80
speed=2
rotation=0
ScanTimeOut=30000,NoMessage

bfc_threshold=47
bfc_topmargin=0
bfc_bottommargin=0
bfc_leftmargin=0
bfc_rightmargin=0
bfc_rightcenter=0
bfc_leftcenter=0
docheight=0
bfc_retouchshadow=man
[EDITBOX4]
EditWindow=SX-394/2,SY-719/2,394,719
Field4=ComboBox,3,198,:07,,,10,ListFile(c:\bscanill\Lib\scanners.lst|1),AfterChange=Process41
Field5=ComboBox,3,318,:08,,,15,ListFile(c:\bscanill\Lib\Modules\ModuleList.bsi|1),AfterChange=Process28
Background=DoNotFit,@c:\bscanill\Lib\illscreen3.jpg

[ScanTwainSettings1]
Name=CONFIG1
TwainFlags=H
TwainTags=c:\bscanill\Twain\illscan-CONFIG1.tdf

[ScanTwainSettings2]
Name=CONFIG10
TwainFlags=H
TwainTags=C:\BSCANILL\Twain\Illscan-CONFIG10.tdf

[ScanTwainSettings3]
Name=CONFIG14
TwainFlags=H
TwainTags=C:\BSCANILL\Twain\Illscan-CONFIG14.tdf
